import{C as j,T as L,D as K,E as G,G as V,H as Y,I as J,J as U,K as _,M as W,N as v,O as X,P as Z,Q as q,R as E,S as ee,U as te,V as ne,X as re,Y as H,Z as se,u as ae,r as I,e as oe,j as m,_ as ce}from"./chunk-DvPZXuhD.js";import{c as ie,B as ue,b as le,g as fe,u as pe,d as de}from"./chunk-BKRo9uZz.js";const ge=new Map,he=new Map;function be(e){const t=(s,a)=>({clear:()=>a.delete(s),get:()=>a.get(s),set:u=>a.set(s,u)}),r=t(e,ge),n=t(e,he);return{clear:()=>{r.clear(),n.clear()},promise:r,response:n}}async function we(e,{cacheKey:t,cacheTime:r=Number.POSITIVE_INFINITY}){const n=be(t),s=n.response.get();if(s&&r>0&&new Date().getTime()-s.created.getTime()<r)return s.data;let a=n.promise.get();a||(a=e(),n.promise.set(a));try{const u=await a;return n.response.set({created:new Date,data:u}),u}finally{n.promise.clear()}}const me=e=>`blockNumber.${e}`;async function ye(e,{cacheTime:t=e.cacheTime}={}){const r=await we(()=>e.request({method:"eth_blockNumber"}),{cacheKey:me(e.uid),cacheTime:t});return BigInt(r)}async function Q(e,{blockHash:t,blockNumber:r,blockTag:n,hash:s,index:a}){var p,o,i;const u=n||"latest",l=r!==void 0?j(r):void 0;let c=null;if(s?c=await e.request({method:"eth_getTransactionByHash",params:[s]},{dedupe:!0}):t?c=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[t,j(a)]},{dedupe:!0}):c=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[l||u,j(a)]},{dedupe:!!l}),!c)throw new L({blockHash:t,blockNumber:r,blockTag:u,hash:s,index:a});return(((i=(o=(p=e.chain)==null?void 0:p.formatters)==null?void 0:o.transaction)==null?void 0:i.format)||K)(c)}async function A(e,{hash:t}){var s,a,u;const r=await e.request({method:"eth_getTransactionReceipt",params:[t]},{dedupe:!0});if(!r)throw new G({hash:t});return(((u=(a=(s=e.chain)==null?void 0:s.formatters)==null?void 0:a.transactionReceipt)==null?void 0:u.format)||V)(r)}class Ne extends Y{constructor({value:t}){super(`Number \`${t}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function ke(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new Ne({value:e});let[r,n="0"]=e.split(".");const s=r.startsWith("-");if(s&&(r=r.slice(1)),n=n.replace(/(0+)$/,""),t===0)Math.round(+`.${n}`)===1&&(r=`${BigInt(r)+1n}`),n="";else if(n.length>t){const[a,u,l]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],c=Math.round(+`${u}.${l}`);c>9?n=`${BigInt(a)+BigInt(1)}0`.padStart(a.length+1,"0"):n=`${a}${c}`,n.length>t&&(n=n.slice(1),r=`${BigInt(r)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${s?"-":""}${r}${n}`)}function Te(e,t="wei"){return ke(e,J[t])}const P=new Map,D=new Map;let Be=0;function M(e,t,r){const n=++Be,s=()=>P.get(e)||[],a=()=>{const p=s();P.set(e,p.filter(o=>o.id!==n))},u=()=>{const p=s();if(!p.some(i=>i.id===n))return;const o=D.get(e);p.length===1&&o&&o(),a()},l=s();if(P.set(e,[...l,{id:n,fns:t}]),l&&l.length>0)return u;const c={};for(const p in t)c[p]=(...o)=>{var b,d;const i=s();if(i.length!==0)for(const h of i)(d=(b=h.fns)[p])==null||d.call(b,...o)};const f=r(c);return typeof f=="function"&&D.set(e,f),u}function xe(e,{emitOnBegin:t,initialWaitTime:r,interval:n}){let s=!0;const a=()=>s=!1;return(async()=>{let l;t&&(l=await e({unpoll:a}));const c=await(r==null?void 0:r(l))??n;await U(c);const f=async()=>{s&&(await e({unpoll:a}),await U(n),f())};f()})(),a}function Re(e,{emitOnBegin:t=!1,emitMissed:r=!1,onBlockNumber:n,onError:s,poll:a,pollingInterval:u=e.pollingInterval}){const l=typeof a<"u"?a:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket");let c;return l?(()=>{const o=_(["watchBlockNumber",e.uid,t,r,u]);return M(o,{onBlockNumber:n,onError:s},i=>xe(async()=>{var b;try{const d=await v(e,ye,"getBlockNumber")({cacheTime:0});if(c){if(d===c)return;if(d-c>1&&r)for(let h=c+1n;h<d;h++)i.onBlockNumber(h,c),c=h}(!c||d>c)&&(i.onBlockNumber(d,c),c=d)}catch(d){(b=i.onError)==null||b.call(i,d)}},{emitOnBegin:t,interval:u}))})():(()=>{const o=_(["watchBlockNumber",e.uid,t,r]);return M(o,{onBlockNumber:n,onError:s},i=>{let b=!0,d=()=>b=!1;return(async()=>{try{const h=(()=>{if(e.transport.type==="fallback"){const y=e.transport.transports.find(g=>g.config.type==="webSocket");return y?y.value:e.transport}return e.transport})(),{unsubscribe:k}=await h.subscribe({params:["newHeads"],onData(y){var T;if(!b)return;const g=W((T=y.result)==null?void 0:T.number);i.onBlockNumber(g,c),c=g},onError(y){var g;(g=i.onError)==null||g.call(i,y)}});d=k,b||d()}catch(h){s==null||s(h)}})(),()=>d()})})()}async function Ce(e,{confirmations:t=1,hash:r,onReplaced:n,pollingInterval:s=e.pollingInterval,retryCount:a=6,retryDelay:u=({count:c})=>~~(1<<c)*200,timeout:l=18e4}){const c=_(["waitForTransactionReceipt",e.uid,r]);let f,p,o,i=!1;const{promise:b,resolve:d,reject:h}=X(),k=l?setTimeout(()=>h(new Z({hash:r})),l):void 0,y=M(c,{onReplaced:n,resolve:d,reject:h},g=>{const T=v(e,Re,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:s,async onBlockNumber(S){const C=x=>{clearTimeout(k),T(),x(),y()};let B=S;if(!i)try{if(o){if(t>1&&(!o.blockNumber||B-o.blockNumber+1n<t))return;C(()=>g.resolve(o));return}if(f||(i=!0,await q(async()=>{f=await v(e,Q,"getTransaction")({hash:r}),f.blockNumber&&(B=f.blockNumber)},{delay:u,retryCount:a}),i=!1),o=await v(e,A,"getTransactionReceipt")({hash:r}),t>1&&(!o.blockNumber||B-o.blockNumber+1n<t))return;C(()=>g.resolve(o))}catch(x){if(x instanceof L||x instanceof G){if(!f){i=!1;return}try{p=f,i=!0;const $=await q(()=>v(e,ie,"getBlock")({blockNumber:B,includeTransactions:!0}),{delay:u,retryCount:a,shouldRetry:({error:R})=>R instanceof ue});i=!1;const w=$.transactions.find(({from:R,nonce:N})=>R===p.from&&N===p.nonce);if(!w||(o=await v(e,A,"getTransactionReceipt")({hash:w.hash}),t>1&&(!o.blockNumber||B-o.blockNumber+1n<t)))return;let F="replaced";w.to===p.to&&w.value===p.value&&w.input===p.input?F="repriced":w.from===w.to&&w.value===0n&&(F="cancelled"),C(()=>{var R;(R=g.onReplaced)==null||R.call(g,{reason:F,replacedTransaction:p,transaction:w,transactionReceipt:o}),g.resolve(o)})}catch($){C(()=>g.reject($))}}else C(()=>g.reject(x))}}})});return b}async function Ie(e,t){const{chainId:r,timeout:n=0,...s}=t,a=e.getClient({chainId:r}),l=await E(a,Ce,"waitForTransactionReceipt")({...s,timeout:n});if(l.status==="reverted"){const f=await E(a,Q,"getTransaction")({hash:l.transactionHash}),o=await E(a,ee,"call")({...f,data:f.input,gasPrice:f.type!=="eip1559"?f.gasPrice:void 0,maxFeePerGas:f.type==="eip1559"?f.maxFeePerGas:void 0,maxPriorityFeePerGas:f.type==="eip1559"?f.maxPriorityFeePerGas:void 0}),i=o!=null&&o.data?te(`0x${o.data.substring(138)}`):"unknown reason";throw new Error(i)}return{...l,chainId:a.chain.id}}function ve(e,t={}){return{async queryFn({queryKey:r}){const{hash:n,...s}=r[1];if(!n)throw new Error("hash is required");return Ie(e,{...s,onReplaced:t.onReplaced,hash:n})},queryKey:$e(t)}}function $e(e={}){const{onReplaced:t,...r}=e;return["waitForTransactionReceipt",ne(r)]}function Fe(e={}){const{hash:t,query:r={}}=e,n=re(e),s=H({config:n}),a=ve(n,{...e,chainId:e.chainId??s}),u=!!(t&&(r.enabled??!0));return se({...r,...a,enabled:u})}function Se(){const t=ae().urlPathname,[r,n]=I.useState(t),[s,a]=I.useState(!1),[u,l]=I.useState(null),[c,f]=I.useState(!1),{isConnected:p}=oe(),o=H(),i=Te("0.0002"),{writeContract:b,isPending:d,data:h,error:k}=le(),{isLoading:y,isSuccess:g}=Fe({hash:h});I.useEffect(()=>{const O=(window.location.origin+t).replace(/\/+$/,"");n(O)},[t]);const T=fe(),S=de(),C=o===T.id,{data:B,error:x,isPending:$,refetch:w}=pe({...S,functionName:"getLikesForUrl",args:[r],chainId:T.id}),F=async()=>{if(l(null),!r){l("URL ist erforderlich");return}if(!C){l(`Bitte wechsle zum ${T.name} Netzwerk`);return}a(!0),b({...S,functionName:"donate",args:[r],value:i})};I.useEffect(()=>{g&&(a(!1),l(null),setTimeout(()=>{w()},2e3)),k&&(a(!1),l((k==null?void 0:k.message)||"Transaktion fehlgeschlagen"))},[g,k,w]);const R=u||(!C&&p?`Bitte wechsle zum ${T.name} Netzwerk`:null),N=ce,z=()=>$?m.jsx("div",{className:N.readDisplay,children:"Loading..."}):x?m.jsxs("div",{className:N.readDisplay,children:["Error: ",x.shortMessage||x.message]}):m.jsx("div",{className:N.readDisplay,children:(B==null?void 0:B.toString())||"0"});return m.jsx("div",{className:N.container,children:m.jsxs("div",{className:N.buttonGroup,children:[m.jsxs("div",{className:N.tooltipContainer,children:[m.jsx("button",{onClick:F,disabled:!p||s||d||y,className:N.writeButton,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:s||d?"Processing...":g?"Supported!":"Support"}),c&&R&&m.jsx("div",{className:N.tooltip,children:R})]}),z()]})})}const _e=function({title:e}){return m.jsxs("div",{className:"TitleBar",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsx("h1",{children:e}),m.jsx(Se,{})]})};export{_e as T};
