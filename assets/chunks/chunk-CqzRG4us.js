import{n as E,T as A,f as K,e as G,h as V,B as X,k as Y,w as U,s as M,l as J,m as S,p as Z,q as ee,t as z,v as P,x as te,y as ne,z as re,A as oe,C as W,D as ae,u as se,r as v,E as ce,c as I,j as w}from"./chunk-Bh18XQD2.js";import{g as ie,B as ue,u as le,a as de,b as pe,c as fe}from"./chunk-Z0dFSHj9.js";const ge=new Map,be=new Map;function he(e){const t=(o,a)=>({clear:()=>a.delete(o),get:()=>a.get(o),set:i=>a.set(o,i)}),r=t(e,ge),n=t(e,be);return{clear:()=>{r.clear(),n.clear()},promise:r,response:n}}async function me(e,{cacheKey:t,cacheTime:r=Number.POSITIVE_INFINITY}){const n=he(t),o=n.response.get();if(o&&r>0&&new Date().getTime()-o.created.getTime()<r)return o.data;let a=n.promise.get();a||(a=e(),n.promise.set(a));try{const i=await a;return n.response.set({created:new Date,data:i}),i}finally{n.promise.clear()}}const we=e=>`blockNumber.${e}`;async function ye(e,{cacheTime:t=e.cacheTime}={}){const r=await me(()=>e.request({method:"eth_blockNumber"}),{cacheKey:we(e.uid),cacheTime:t});return BigInt(r)}async function H(e,{blockHash:t,blockNumber:r,blockTag:n,hash:o,index:a}){var p,s,u;const i=n||"latest",l=r!==void 0?E(r):void 0;let c=null;if(o?c=await e.request({method:"eth_getTransactionByHash",params:[o]},{dedupe:!0}):t?c=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[t,E(a)]},{dedupe:!0}):c=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[l||i,E(a)]},{dedupe:!!l}),!c)throw new A({blockHash:t,blockNumber:r,blockTag:i,hash:o,index:a});return(((u=(s=(p=e.chain)==null?void 0:p.formatters)==null?void 0:s.transaction)==null?void 0:u.format)||K)(c)}async function D(e,{hash:t}){var o,a,i;const r=await e.request({method:"eth_getTransactionReceipt",params:[t]},{dedupe:!0});if(!r)throw new G({hash:t});return(((i=(a=(o=e.chain)==null?void 0:o.formatters)==null?void 0:a.transactionReceipt)==null?void 0:i.format)||V)(r)}class xe extends X{constructor({value:t}){super(`Number \`${t}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function ke(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new xe({value:e});let[r,n="0"]=e.split(".");const o=r.startsWith("-");if(o&&(r=r.slice(1)),n=n.replace(/(0+)$/,""),t===0)Math.round(+`.${n}`)===1&&(r=`${BigInt(r)+1n}`),n="";else if(n.length>t){const[a,i,l]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],c=Math.round(+`${i}.${l}`);c>9?n=`${BigInt(a)+BigInt(1)}0`.padStart(a.length+1,"0"):n=`${a}${c}`,n.length>t&&(n=n.slice(1),r=`${BigInt(r)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${o?"-":""}${r}${n}`)}function Ne(e,t="wei"){return ke(e,Y[t])}const _=new Map,L=new Map;let Te=0;function q(e,t,r){const n=++Te,o=()=>_.get(e)||[],a=()=>{const p=o();_.set(e,p.filter(s=>s.id!==n))},i=()=>{const p=o();if(!p.some(u=>u.id===n))return;const s=L.get(e);p.length===1&&s&&s(),a()},l=o();if(_.set(e,[...l,{id:n,fns:t}]),l&&l.length>0)return i;const c={};for(const p in t)c[p]=(...s)=>{var h,f;const u=o();if(u.length!==0)for(const b of u)(f=(h=b.fns)[p])==null||f.call(h,...s)};const d=r(c);return typeof d=="function"&&L.set(e,d),i}function Be(e,{emitOnBegin:t,initialWaitTime:r,interval:n}){let o=!0;const a=()=>o=!1;return(async()=>{let l;t&&(l=await e({unpoll:a}));const c=await(r==null?void 0:r(l))??n;await U(c);const d=async()=>{o&&(await e({unpoll:a}),await U(n),d())};d()})(),a}function Ce(e,{emitOnBegin:t=!1,emitMissed:r=!1,onBlockNumber:n,onError:o,poll:a,pollingInterval:i=e.pollingInterval}){const l=typeof a<"u"?a:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket");let c;return l?(()=>{const s=M(["watchBlockNumber",e.uid,t,r,i]);return q(s,{onBlockNumber:n,onError:o},u=>Be(async()=>{var h;try{const f=await S(e,ye,"getBlockNumber")({cacheTime:0});if(c){if(f===c)return;if(f-c>1&&r)for(let b=c+1n;b<f;b++)u.onBlockNumber(b,c),c=b}(!c||f>c)&&(u.onBlockNumber(f,c),c=f)}catch(f){(h=u.onError)==null||h.call(u,f)}},{emitOnBegin:t,interval:i}))})():(()=>{const s=M(["watchBlockNumber",e.uid,t,r]);return q(s,{onBlockNumber:n,onError:o},u=>{let h=!0,f=()=>h=!1;return(async()=>{try{const b=(()=>{if(e.transport.type==="fallback"){const y=e.transport.transports.find(g=>g.config.type==="webSocket");return y?y.value:e.transport}return e.transport})(),{unsubscribe:k}=await b.subscribe({params:["newHeads"],onData(y){var N;if(!h)return;const g=J((N=y.result)==null?void 0:N.number);u.onBlockNumber(g,c),c=g},onError(y){var g;(g=u.onError)==null||g.call(u,y)}});f=k,h||f()}catch(b){o==null||o(b)}})(),()=>f()})})()}async function Re(e,{confirmations:t=1,hash:r,onReplaced:n,pollingInterval:o=e.pollingInterval,retryCount:a=6,retryDelay:i=({count:c})=>~~(1<<c)*200,timeout:l=18e4}){const c=M(["waitForTransactionReceipt",e.uid,r]);let d,p,s,u=!1;const{promise:h,resolve:f,reject:b}=Z(),k=l?setTimeout(()=>b(new ee({hash:r})),l):void 0,y=q(c,{onReplaced:n,resolve:f,reject:b},g=>{const N=S(e,Ce,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:o,async onBlockNumber(j){const R=B=>{clearTimeout(k),N(),B(),y()};let T=j;if(!u)try{if(s){if(t>1&&(!s.blockNumber||T-s.blockNumber+1n<t))return;R(()=>g.resolve(s));return}if(d||(u=!0,await z(async()=>{d=await S(e,H,"getTransaction")({hash:r}),d.blockNumber&&(T=d.blockNumber)},{delay:i,retryCount:a}),u=!1),s=await S(e,D,"getTransactionReceipt")({hash:r}),t>1&&(!s.blockNumber||T-s.blockNumber+1n<t))return;R(()=>g.resolve(s))}catch(B){if(B instanceof A||B instanceof G){if(!d){u=!1;return}try{p=d,u=!0;const $=await z(()=>S(e,ie,"getBlock")({blockNumber:T,includeTransactions:!0}),{delay:i,retryCount:a,shouldRetry:({error:C})=>C instanceof ue});u=!1;const m=$.transactions.find(({from:C,nonce:x})=>C===p.from&&x===p.nonce);if(!m||(s=await S(e,D,"getTransactionReceipt")({hash:m.hash}),t>1&&(!s.blockNumber||T-s.blockNumber+1n<t)))return;let F="replaced";m.to===p.to&&m.value===p.value&&m.input===p.input?F="repriced":m.from===m.to&&m.value===0n&&(F="cancelled"),R(()=>{var C;(C=g.onReplaced)==null||C.call(g,{reason:F,replacedTransaction:p,transaction:m,transactionReceipt:s}),g.resolve(s)})}catch($){R(()=>g.reject($))}}else R(()=>g.reject(B))}}})});return h}async function Ie(e,t){const{chainId:r,timeout:n=0,...o}=t,a=e.getClient({chainId:r}),l=await P(a,Re,"waitForTransactionReceipt")({...o,timeout:n});if(l.status==="reverted"){const d=await P(a,H,"getTransaction")({hash:l.transactionHash}),s=await P(a,te,"call")({...d,data:d.input,gasPrice:d.type!=="eip1559"?d.gasPrice:void 0,maxFeePerGas:d.type==="eip1559"?d.maxFeePerGas:void 0,maxPriorityFeePerGas:d.type==="eip1559"?d.maxPriorityFeePerGas:void 0}),u=s!=null&&s.data?ne(`0x${s.data.substring(138)}`):"unknown reason";throw new Error(u)}return{...l,chainId:a.chain.id}}function ve(e,t={}){return{async queryFn({queryKey:r}){const{hash:n,...o}=r[1];if(!n)throw new Error("hash is required");return Ie(e,{...o,onReplaced:t.onReplaced,hash:n})},queryKey:Se(t)}}function Se(e={}){const{onReplaced:t,...r}=e;return["waitForTransactionReceipt",re(r)]}function $e(e={}){const{hash:t,query:r={}}=e,n=oe(e),o=W({config:n}),a=ve(n,{...e,chainId:e.chainId??o}),i=!!(t&&(r.enabled??!0));return ae({...r,...a,enabled:i})}function Fe(){const t=se().urlPathname,[r,n]=v.useState(t),[o,a]=v.useState(!1),[i,l]=v.useState(null),[c,d]=v.useState(!1),{isConnected:p}=ce(),s=W(),u=Ne("0.0002"),{writeContract:h,isPending:f,data:b,error:k}=le(),{isLoading:y,isSuccess:g}=$e({hash:b});v.useEffect(()=>{const O=(window.location.origin+t).replace(/\/+$/,"");n(O)},[t]);const N=de(),j=fe(),R=s===N.id,{data:T,error:B,isPending:$,refetch:m}=pe({...j,functionName:"getLikesForUrl",args:[r],chainId:N.id}),F=async()=>{if(l(null),!r){l("URL ist erforderlich");return}if(!R){l(`Bitte wechsle zum ${N.name} Netzwerk`);return}a(!0),h({...j,functionName:"donate",args:[r],value:u})};v.useEffect(()=>{g&&(a(!1),l(null),setTimeout(()=>{m()},2e3)),k&&(a(!1),l((k==null?void 0:k.message)||"Transaktion fehlgeschlagen"))},[g,k,m]);const C=i||(!R&&p?`Bitte wechsle zum ${N.name} Netzwerk`:null),x={container:I({display:"flex",alignItems:"center",margin:"md 0"}),buttonGroup:I({display:"flex"}),buttonBase:I({padding:"sm",backgroundColor:"brand",color:"light",fontWeight:"bold",height:"36px",boxSizing:"border-box",display:"flex",alignItems:"center"}),writeButton:I({padding:"sm",backgroundColor:o?"#5a7aac":"brand",color:"light",fontWeight:"bold",height:"36px",borderRadius:"4px 0 0 4px",borderRight:"1px solid white",borderLeft:"none",borderTop:"none",borderBottom:"none",boxSizing:"border-box",display:"flex",alignItems:"center",cursor:o?"not-allowed":"pointer"}),readDisplay:I({padding:"sm",backgroundColor:"brand",color:"light",fontWeight:"bold",height:"36px",borderRadius:"0 4px 4px 0",border:"none",minWidth:"20px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}),tooltipContainer:I({position:"relative"}),tooltip:I({position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"xs",padding:"sm",backgroundColor:"background",border:`1px solid ${i?"red":"orange"}`,borderRadius:"sm",boxShadow:"0 2px 5px rgba(0,0,0,0.2)",color:i?"red":"orange",width:"max-content",maxWidth:"250px",zIndex:"100"})},Q=()=>$?w.jsx("div",{className:x.readDisplay,children:"Loading..."}):B?w.jsxs("div",{className:x.readDisplay,children:["Error: ",B.shortMessage||B.message]}):w.jsx("div",{className:x.readDisplay,children:(T==null?void 0:T.toString())||"0"});return w.jsx("div",{className:x.container,children:w.jsxs("div",{className:x.buttonGroup,children:[w.jsxs("div",{className:x.tooltipContainer,children:[w.jsx("button",{onClick:F,disabled:!p||o||f||y,className:x.writeButton,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:o||f?"Processing...":g?"Supported!":"Support"}),c&&C&&w.jsx("div",{className:x.tooltip,children:C})]}),Q()]})})}const _e=function({title:e}){return w.jsxs("div",{className:"TitleBar",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[w.jsx("h1",{children:e}),w.jsx(Fe,{})]})};export{_e as T};
