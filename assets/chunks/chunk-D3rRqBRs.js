import{O as m,X as s}from"./chunk-DspFOiA9.js";import"./chunk-t-pXVLBL.js";/* empty css              *//* empty css              */var l={TransferWithAuthorization:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"validAfter",type:"uint256"},{name:"validBefore",type:"uint256"},{name:"nonce",type:"bytes32"}]};function y(e){return{base:8453,"base-sepolia":84532,ethereum:1,sepolia:11155111,polygon:137,"polygon-amoy":80002}[e]||1}function d(){const e=(typeof globalThis.crypto<"u",globalThis.crypto);if(!e)throw new Error("Crypto API not available");return m(e.getRandomValues(new Uint8Array(32)))}var c=class{constructor(e){this.signer=e,this.scheme="exact"}async createPaymentPayload(e,t){const a=d(),r=Math.floor(Date.now()/1e3),o={from:this.signer.address,to:s(t.payTo),value:t.amount,validAfter:(r-600).toString(),validBefore:(r+t.maxTimeoutSeconds).toString(),nonce:a},n=await this.signAuthorization(o,t);return{x402Version:e,payload:{authorization:o,signature:n}}}async signAuthorization(e,t){const a=parseInt(t.network.split(":")[1]);if(!t.extra?.name||!t.extra?.version)throw new Error(`EIP-712 domain parameters (name, version) are required in payment requirements for asset ${t.asset}`);const{name:r,version:o}=t.extra,n={name:r,version:o,chainId:a,verifyingContract:s(t.asset)},i={from:s(e.from),to:s(e.to),value:BigInt(e.value),validAfter:BigInt(e.validAfter),validBefore:BigInt(e.validBefore),nonce:e.nonce};return await this.signer.signTypedData({domain:n,types:l,primaryType:"TransferWithAuthorization",message:i})}},g=["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia"],v=class{constructor(e){this.signer=e,this.scheme="exact"}async createPaymentPayload(e,t){const a=t,r=d(),o=Math.floor(Date.now()/1e3),n={from:this.signer.address,to:s(a.payTo),value:a.maxAmountRequired,validAfter:(o-600).toString(),validBefore:(o+a.maxTimeoutSeconds).toString(),nonce:r},i=await this.signAuthorization(n,a),p={authorization:n,signature:i};return{x402Version:e,scheme:a.scheme,network:a.network,payload:p}}async signAuthorization(e,t){const a=y(t.network);if(!t.extra?.name||!t.extra?.version)throw new Error(`EIP-712 domain parameters (name, version) are required in payment requirements for asset ${t.asset}`);const{name:r,version:o}=t.extra,n={name:r,version:o,chainId:a,verifyingContract:s(t.asset)},i={from:s(e.from),to:s(e.to),value:BigInt(e.value),validAfter:BigInt(e.validAfter),validBefore:BigInt(e.validBefore),nonce:e.nonce};return await this.signer.signTypedData({domain:n,types:l,primaryType:"TransferWithAuthorization",message:i})}};function A(e,t){return t.networks&&t.networks.length>0?t.networks.forEach(a=>{e.register(a,new c(t.signer))}):e.register("eip155:*",new c(t.signer)),g.forEach(a=>{e.registerV1(a,new v(t.signer))}),t.policies&&t.policies.forEach(a=>{e.registerPolicy(a)}),e}export{c as ExactEvmScheme,A as registerExactEvmScheme};
