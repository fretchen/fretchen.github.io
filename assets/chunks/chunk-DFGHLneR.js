import{n as E,T as H,f as X,d as G,e as Y,B as J,h as Z,w as L,s as M,k as ee,l as I,m as te,p as ne,q as A,t as P,v as re,x as oe,y as ae,z as se,A as Q,C as ce,u as ie,r as C,D as ue,j as m}from"./chunk-Y1mneeJi.js";import{g as le,B as de,u as pe,a as fe,b as ge,c as be}from"./chunk-LwBKYpEJ.js";const he=new Map,we=new Map;function me(e){const t=(o,a)=>({clear:()=>a.delete(o),get:()=>a.get(o),set:i=>a.set(o,i)}),r=t(e,he),n=t(e,we);return{clear:()=>{r.clear(),n.clear()},promise:r,response:n}}async function ye(e,{cacheKey:t,cacheTime:r=Number.POSITIVE_INFINITY}){const n=me(t),o=n.response.get();if(o&&r>0&&new Date().getTime()-o.created.getTime()<r)return o.data;let a=n.promise.get();a||(a=e(),n.promise.set(a));try{const i=await a;return n.response.set({created:new Date,data:i}),i}finally{n.promise.clear()}}const xe=e=>`blockNumber.${e}`;async function ke(e,{cacheTime:t=e.cacheTime}={}){const r=await ye(()=>e.request({method:"eth_blockNumber"}),{cacheKey:xe(e.uid),cacheTime:t});return BigInt(r)}async function W(e,{blockHash:t,blockNumber:r,blockTag:n,hash:o,index:a}){var p,s,u;const i=n||"latest",l=r!==void 0?E(r):void 0;let c=null;if(o?c=await e.request({method:"eth_getTransactionByHash",params:[o]},{dedupe:!0}):t?c=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[t,E(a)]},{dedupe:!0}):c=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[l||i,E(a)]},{dedupe:!!l}),!c)throw new H({blockHash:t,blockNumber:r,blockTag:i,hash:o,index:a});return(((u=(s=(p=e.chain)==null?void 0:p.formatters)==null?void 0:s.transaction)==null?void 0:u.format)||X)(c)}async function z(e,{hash:t}){var o,a,i;const r=await e.request({method:"eth_getTransactionReceipt",params:[t]},{dedupe:!0});if(!r)throw new G({hash:t});return(((i=(a=(o=e.chain)==null?void 0:o.formatters)==null?void 0:a.transactionReceipt)==null?void 0:i.format)||Y)(r)}class Te extends J{constructor({value:t}){super(`Number \`${t}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function Ne(e,t){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(e))throw new Te({value:e});let[r,n="0"]=e.split(".");const o=r.startsWith("-");if(o&&(r=r.slice(1)),n=n.replace(/(0+)$/,""),t===0)Math.round(+`.${n}`)===1&&(r=`${BigInt(r)+1n}`),n="";else if(n.length>t){const[a,i,l]=[n.slice(0,t-1),n.slice(t-1,t),n.slice(t)],c=Math.round(+`${i}.${l}`);c>9?n=`${BigInt(a)+BigInt(1)}0`.padStart(a.length+1,"0"):n=`${a}${c}`,n.length>t&&(n=n.slice(1),r=`${BigInt(r)+1n}`),n=n.slice(0,t)}else n=n.padEnd(t,"0");return BigInt(`${o?"-":""}${r}${n}`)}function Be(e,t="wei"){return Ne(e,Z[t])}const _=new Map,D=new Map;let Re=0;function q(e,t,r){const n=++Re,o=()=>_.get(e)||[],a=()=>{const p=o();_.set(e,p.filter(s=>s.id!==n))},i=()=>{const p=o();if(!p.some(u=>u.id===n))return;const s=D.get(e);p.length===1&&s&&s(),a()},l=o();if(_.set(e,[...l,{id:n,fns:t}]),l&&l.length>0)return i;const c={};for(const p in t)c[p]=(...s)=>{var h,f;const u=o();if(u.length!==0)for(const b of u)(f=(h=b.fns)[p])==null||f.call(h,...s)};const d=r(c);return typeof d=="function"&&D.set(e,d),i}function Ce(e,{emitOnBegin:t,initialWaitTime:r,interval:n}){let o=!0;const a=()=>o=!1;return(async()=>{let l;t&&(l=await e({unpoll:a}));const c=await(r==null?void 0:r(l))??n;await L(c);const d=async()=>{o&&(await e({unpoll:a}),await L(n),d())};d()})(),a}function Ie(e,{emitOnBegin:t=!1,emitMissed:r=!1,onBlockNumber:n,onError:o,poll:a,pollingInterval:i=e.pollingInterval}){const l=typeof a<"u"?a:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket");let c;return l?(()=>{const s=M(["watchBlockNumber",e.uid,t,r,i]);return q(s,{onBlockNumber:n,onError:o},u=>Ce(async()=>{var h;try{const f=await I(e,ke,"getBlockNumber")({cacheTime:0});if(c){if(f===c)return;if(f-c>1&&r)for(let b=c+1n;b<f;b++)u.onBlockNumber(b,c),c=b}(!c||f>c)&&(u.onBlockNumber(f,c),c=f)}catch(f){(h=u.onError)==null||h.call(u,f)}},{emitOnBegin:t,interval:i}))})():(()=>{const s=M(["watchBlockNumber",e.uid,t,r]);return q(s,{onBlockNumber:n,onError:o},u=>{let h=!0,f=()=>h=!1;return(async()=>{try{const b=(()=>{if(e.transport.type==="fallback"){const y=e.transport.transports.find(g=>g.config.type==="webSocket");return y?y.value:e.transport}return e.transport})(),{unsubscribe:x}=await b.subscribe({params:["newHeads"],onData(y){var k;if(!h)return;const g=ee((k=y.result)==null?void 0:k.number);u.onBlockNumber(g,c),c=g},onError(y){var g;(g=u.onError)==null||g.call(u,y)}});f=x,h||f()}catch(b){o==null||o(b)}})(),()=>f()})})()}async function ve(e,{confirmations:t=1,hash:r,onReplaced:n,pollingInterval:o=e.pollingInterval,retryCount:a=6,retryDelay:i=({count:c})=>~~(1<<c)*200,timeout:l=18e4}){const c=M(["waitForTransactionReceipt",e.uid,r]);let d,p,s,u=!1;const{promise:h,resolve:f,reject:b}=te(),x=l?setTimeout(()=>b(new ne({hash:r})),l):void 0,y=q(c,{onReplaced:n,resolve:f,reject:b},g=>{const k=I(e,Ie,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:o,async onBlockNumber($){const R=N=>{clearTimeout(x),k(),N(),y()};let T=$;if(!u)try{if(s){if(t>1&&(!s.blockNumber||T-s.blockNumber+1n<t))return;R(()=>g.resolve(s));return}if(d||(u=!0,await A(async()=>{d=await I(e,W,"getTransaction")({hash:r}),d.blockNumber&&(T=d.blockNumber)},{delay:i,retryCount:a}),u=!1),s=await I(e,z,"getTransactionReceipt")({hash:r}),t>1&&(!s.blockNumber||T-s.blockNumber+1n<t))return;R(()=>g.resolve(s))}catch(N){if(N instanceof H||N instanceof G){if(!d){u=!1;return}try{p=d,u=!0;const v=await A(()=>I(e,le,"getBlock")({blockNumber:T,includeTransactions:!0}),{delay:i,retryCount:a,shouldRetry:({error:B})=>B instanceof de});u=!1;const w=v.transactions.find(({from:B,nonce:F})=>B===p.from&&F===p.nonce);if(!w||(s=await I(e,z,"getTransactionReceipt")({hash:w.hash}),t>1&&(!s.blockNumber||T-s.blockNumber+1n<t)))return;let S="replaced";w.to===p.to&&w.value===p.value&&w.input===p.input?S="repriced":w.from===w.to&&w.value===0n&&(S="cancelled"),R(()=>{var B;(B=g.onReplaced)==null||B.call(g,{reason:S,replacedTransaction:p,transaction:w,transactionReceipt:s}),g.resolve(s)})}catch(v){R(()=>g.reject(v))}}else R(()=>g.reject(N))}}})});return h}async function Se(e,t){const{chainId:r,timeout:n=0,...o}=t,a=e.getClient({chainId:r}),l=await P(a,ve,"waitForTransactionReceipt")({...o,timeout:n});if(l.status==="reverted"){const d=await P(a,W,"getTransaction")({hash:l.transactionHash}),s=await P(a,re,"call")({...d,data:d.input,gasPrice:d.type!=="eip1559"?d.gasPrice:void 0,maxFeePerGas:d.type==="eip1559"?d.maxFeePerGas:void 0,maxPriorityFeePerGas:d.type==="eip1559"?d.maxPriorityFeePerGas:void 0}),u=s!=null&&s.data?oe(`0x${s.data.substring(138)}`):"unknown reason";throw new Error(u)}return{...l,chainId:a.chain.id}}function $e(e,t={}){return{async queryFn({queryKey:r}){const{hash:n,...o}=r[1];if(!n)throw new Error("hash is required");return Se(e,{...o,onReplaced:t.onReplaced,hash:n})},queryKey:Fe(t)}}function Fe(e={}){const{onReplaced:t,...r}=e;return["waitForTransactionReceipt",ae(r)]}function je(e={}){const{hash:t,query:r={}}=e,n=se(e),o=Q({config:n}),a=$e(n,{...e,chainId:e.chainId??o}),i=!!(t&&(r.enabled??!0));return ce({...r,...a,enabled:i})}function Ee(){const t=ie().urlPathname,[r,n]=C.useState(t),[o,a]=C.useState(!1),[i,l]=C.useState(null),[c,d]=C.useState(!1),{isConnected:p}=ue(),s=Q(),u=Be("0.0002"),{writeContract:h,isPending:f,data:b,error:x}=pe(),{isLoading:y,isSuccess:g}=je({hash:b});C.useEffect(()=>{const V=(window.location.origin+t).replace(/\/+$/,"");n(V)},[t]);const k=fe(),$=be(),R=s===k.id,{data:T,error:N,isPending:v,refetch:w}=ge({...$,functionName:"getLikesForUrl",args:[r],chainId:k.id}),S=async()=>{if(l(null),!r){l("URL ist erforderlich");return}if(!R){l(`Bitte wechsle zum ${k.name} Netzwerk`);return}a(!0),h({...$,functionName:"donate",args:[r],value:u})};C.useEffect(()=>{g&&(a(!1),l(null),setTimeout(()=>{w()},2e3)),x&&(a(!1),l((x==null?void 0:x.message)||"Transaktion fehlgeschlagen"))},[g,x,w]);const B=i||(!R&&p?`Bitte wechsle zum ${k.name} Netzwerk`:null),F=i?"red":"orange",U={padding:"8px 16px",backgroundColor:"#3a5a8c",color:"white",fontWeight:"bold",height:"36px",boxSizing:"border-box",display:"flex",alignItems:"center"},O={...U,borderRadius:"4px 0 0 4px",borderRight:"1px solid white",borderLeft:"none",borderTop:"none",borderBottom:"none",cursor:o?"not-allowed":"pointer",backgroundColor:o?"#5a7aac":"#3a5a8c"},j={...U,borderRadius:"0 4px 4px 0",border:"none",minWidth:"10px"},K=()=>v?m.jsx("div",{style:j,children:"Loading..."}):N?m.jsxs("div",{style:j,children:["Error: ",N.shortMessage||N.message]}):m.jsx("div",{style:j,children:(T==null?void 0:T.toString())||"0"});return m.jsx("div",{style:{display:"flex",alignItems:"center",margin:"16px 0"},children:m.jsxs("div",{style:{display:"flex"},children:[m.jsxs("div",{style:{position:"relative"},children:[m.jsx("button",{onClick:S,disabled:!p||o||f||y,style:O,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:o||f?"Processing...":g?"Supported!":"Support"}),c&&B&&m.jsx("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"8px",padding:"8px",backgroundColor:"white",border:`1px solid ${F}`,borderRadius:"4px",boxShadow:"0 2px 5px rgba(0,0,0,0.2)",color:F,width:"max-content",maxWidth:"250px",zIndex:100},children:B})]}),K()]})})}const qe=function({title:e}){return m.jsxs("div",{className:"TitleBar",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsx("h1",{children:e}),m.jsx(Ee,{})]})};export{qe as T};
