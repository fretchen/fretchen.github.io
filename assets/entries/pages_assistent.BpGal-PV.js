import{Y as D,Z as B,_ as R,$ as M,a0 as W,a1 as _,r as p,j as e,a2 as A,a3 as F,f as j,X as C,F as H,i as q,W as I,a as $,d as N,e as O,o as V}from"../chunks/chunk-CuEeO_vF.js";import{A as K,g as Y,a as J,u as X,b as Z,c as G}from"../chunks/chunk-DWcQkPg_.js";import{p as Q}from"../chunks/chunk-Dq4EvLqt.js";import"../chunks/chunk-ETYCELfk.js";/* empty css                      *//* empty css                      *//* empty css                      */async function ee(r,{account:o=r.account,message:t}){if(!o)throw new K({docsPath:"/docs/actions/wallet/signMessage"});const i=D(o);if(i.signMessage)return i.signMessage({message:t});const n=typeof t=="string"?B(t):t.raw instanceof Uint8Array?R(t.raw):t.raw;return r.request({method:"personal_sign",params:[n,i.address]},{retryCount:0})}async function te(r,o){const{account:t,connector:i,...n}=o;let l;return typeof t=="object"&&t.type==="local"?l=r.getClient():l=await Y(r,{account:t,connector:i}),M(l,ee,"signMessage")({...n,...t?{account:t}:{}})}function re(r){return{mutationFn(o){return te(r,o)},mutationKey:["signMessage"]}}function oe(r={}){const{mutation:o}=r,t=W(r),i=re(t),{mutate:n,mutateAsync:l,...c}=_({...o,...i});return{...c,signMessage:n,signMessageAsync:l}}function ne({address:r,isOpen:o,onClose:t}){const[i,n]=p.useState([]),[l,c]=p.useState(!1),u=async()=>{if(r){c(!0);try{const d=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${r}`)).json();n(d.leaves||[])}catch(s){console.error("Failed to fetch leaf history:",s)}finally{c(!1)}}};return p.useEffect(()=>{o&&r&&u()},[o,r]),o?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),l?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",i.length," requests"]}),i.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):i.slice(0,10).map(s=>{const d=(x=>x?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(s.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${d.borderColor}`,borderLeft:`${d.borderLeftWidth} solid ${d.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:d.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:d.textColor,fontWeight:"bold"},children:[d.icon," ",d.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(s.timestamp).toLocaleDateString()," ",new Date(s.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",s.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",A(BigInt(s.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",s.treeIndex,", Leaf ",s.id]})]},`${s.treeIndex}-${s.id}`)}),i.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",i.length," requests"]})]})]}):null}function ae({address:r,onRefetchBalance:o}){const t=J(),{data:i,refetch:n}=X({address:t.address,abi:t.abi,functionName:"checkBalance",args:r?[r]:void 0,query:{enabled:!!r}}),{writeContract:l,data:c}=Z(),{isLoading:u,isSuccess:s}=G({hash:c}),y=()=>{r&&l({address:t.address,abi:t.abi,functionName:"depositForLLM",value:Q("0.01")})};return C.useEffect(()=>{s&&n()},[s,n]),C.useEffect(()=>{o&&o(n)},[n,o]),r?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{children:["Balance: ",i?A(i):"0"," ETH"]}),e.jsx("button",{onClick:y,disabled:u,style:{padding:"0.25rem 0.5rem",background:u?"#ccc":"#4CAF50",color:"white",border:"none",borderRadius:"3px",cursor:u?"not-allowed":"pointer",fontSize:"0.8rem"},title:u?"Transaction pending...":"Top up with 0.01 ETH",children:u?"...":"+"})]}):null}function ie(){const[r,o]=p.useState([]),[t,i]=p.useState(""),[n,l]=p.useState(!1),[c,u]=p.useState(null),[s,y]=p.useState(null),[d,x]=p.useState(!1),{address:f,isConnected:b}=F(),{signMessageAsync:E}=oe(),z=a=>{y(()=>a)},P=async()=>{if(!f||!b)throw new Error("Wallet not connected");if(c)return c;const a=`Authenticate wallet: ${f}`,h=await E({message:a});return u(h),h},w=async a=>{if(!a.trim()||n)return;l(!0);const h={role:"user",content:a.trim(),timestamp:Date.now()};o(g=>[...g,h]),i("");try{const g=await P(),S=[{role:"system",content:"You are a helpful assistant."},...r.map(m=>({role:m.role,content:m.content})),{role:"user",content:a.trim()}],v=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:f,signature:g,message:`Authenticate wallet: ${f}`},data:{prompt:S}})});if(!v.ok){const m=await v.json();throw new Error(m.error||"Failed to get response")}const U={role:"assistant",content:(await v.json()).content||"No response received",timestamp:Date.now()};o(m=>[...m,U]),s&&s()}catch(g){const S={role:"assistant",content:`Error: ${g instanceof Error?g.message:"Unknown error"}`,timestamp:Date.now()};o(T=>[...T,S])}finally{l(!1)}},k=()=>{o([]),u(null)},L=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),w(t))};return b?e.jsxs("div",{className:j,children:[e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",height:"80vh",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 0"},children:[e.jsx("h2",{children:"Chat Assistant"}),e.jsx(ae,{address:f,onRefetchBalance:z}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>x(!0),style:{padding:"0.5rem 1rem",background:"transparent",color:"#333",border:"1px solid #ddd",borderRadius:"2px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},title:"View request history",children:"History"}),e.jsx("button",{onClick:k,style:{padding:"0.5rem 1rem",background:"transparent",color:"#666",border:"1px solid #ddd",borderRadius:"2px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},children:"Clear Chat"})]})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"1rem",backgroundColor:"#ffffff"},children:[r.length===0?e.jsx("div",{style:{textAlign:"center",color:"#888",padding:"2rem",fontSize:"0.9rem"},children:"Start a conversation by typing a message below."}):r.map((a,h)=>e.jsx("div",{style:{margin:"1rem 0",display:"flex",justifyContent:a.role==="user"?"flex-end":"flex-start"},children:e.jsxs("div",{style:{maxWidth:a.role==="user"?"70%":"80%",padding:"0.75rem 1rem",borderRadius:"8px",backgroundColor:a.role==="user"?"#2d3748":"#f8f9fa",color:a.role==="user"?"white":"#333",border:a.role==="user"?"none":"1px solid #e2e8f0"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"0.5rem",fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.8},children:a.role==="user"?"You":"Assistant"}),e.jsx("div",{style:{whiteSpace:"pre-wrap",lineHeight:"1.5"},children:a.content})]})},h)),n&&e.jsx("div",{style:{margin:"1rem 0",display:"flex",justifyContent:"flex-start"},children:e.jsx("div",{style:{maxWidth:"80%",padding:"0.75rem 1rem",borderRadius:"8px",backgroundColor:"#f8f9fa",color:"#333",border:"1px solid #e2e8f0",fontStyle:"italic"},children:"Assistant is typing..."})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",padding:"1rem 0"},children:[e.jsx("textarea",{value:t,onChange:a=>i(a.target.value),onKeyPress:L,placeholder:"Type your message here...",disabled:n,style:{flex:1,padding:"1rem",border:"1px solid #e0e0e0",borderRadius:"2px",resize:"vertical",minHeight:"60px",maxHeight:"120px",fontSize:"0.9rem",lineHeight:"1.5",outline:"none",backgroundColor:"#ffffff"}}),e.jsx("button",{onClick:()=>w(t),disabled:n||!t.trim(),style:{padding:"0.75rem 1.5rem",background:n||!t.trim()?"#f5f5f5":"#333",color:n||!t.trim()?"#999":"white",border:"1px solid #ddd",borderRadius:"2px",cursor:n||!t.trim()?"not-allowed":"pointer",whiteSpace:"nowrap",fontSize:"0.9rem",fontWeight:"500"},children:n?"Sending...":"Send"})]})]}),e.jsx(ne,{address:f,isOpen:d,onClose:()=>x(!1)})]}):e.jsx("div",{className:j,children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("h2",{children:"Chat Assistant"}),e.jsx("p",{children:"Please connect your wallet to use the chat assistant."})]})})}const se=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),me={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:V}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:O}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:N}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:se}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:$}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:I}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:q}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:H}}};export{me as configValuesSerialized};
