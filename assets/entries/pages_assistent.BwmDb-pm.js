import{Y as D,Z as B,_ as R,$ as M,a0 as W,a1 as _,r as u,j as e,a2 as A,a3 as I,f as C,X as j,F,i as H,W as $,a as q,d as N,e as O,o as V}from"../chunks/chunk-CuEeO_vF.js";import{A as K,g as Y,a as J,b as X,u as Z,c as G,d as Q}from"../chunks/chunk-CUqSW1V6.js";import{p as ee}from"../chunks/chunk-Dq4EvLqt.js";import"../chunks/chunk-ETYCELfk.js";/* empty css                      *//* empty css                      *//* empty css                      */async function te(r,{account:o=r.account,message:t}){if(!o)throw new K({docsPath:"/docs/actions/wallet/signMessage"});const n=D(o);if(n.signMessage)return n.signMessage({message:t});const s=typeof t=="string"?B(t):t.raw instanceof Uint8Array?R(t.raw):t.raw;return r.request({method:"personal_sign",params:[s,n.address]},{retryCount:0})}async function re(r,o){const{account:t,connector:n,...s}=o;let l;return typeof t=="object"&&t.type==="local"?l=r.getClient():l=await Y(r,{account:t,connector:n}),M(l,te,"signMessage")({...s,...t?{account:t}:{}})}function oe(r){return{mutationFn(o){return re(r,o)},mutationKey:["signMessage"]}}function ne(r={}){const{mutation:o}=r,t=W(r),n=oe(t),{mutate:s,mutateAsync:l,...c}=_({...o,...n});return{...c,signMessage:s,signMessageAsync:l}}function ae({address:r,isOpen:o,onClose:t}){const[n,s]=u.useState([]),[l,c]=u.useState(!1),p=async()=>{if(r){c(!0);try{const d=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${r}`)).json();s(d.leaves||[])}catch(a){console.error("Failed to fetch leaf history:",a)}finally{c(!1)}}};return u.useEffect(()=>{o&&r&&p()},[o,r]),o?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),l?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",n.length," requests"]}),n.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):n.slice(0,10).map(a=>{const d=(x=>x?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(a.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${d.borderColor}`,borderLeft:`${d.borderLeftWidth} solid ${d.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:d.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:d.textColor,fontWeight:"bold"},children:[d.icon," ",d.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(a.timestamp).toLocaleDateString()," ",new Date(a.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",a.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",A(BigInt(a.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",a.treeIndex,", Leaf ",a.id]})]},`${a.treeIndex}-${a.id}`)}),n.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",n.length," requests"]})]})]}):null}function ie({address:r,onRefetchBalance:o}){const t=J(),n=X(),{data:s,refetch:l}=Z({...t,functionName:"checkBalance",args:r?[r]:void 0,...n?.id&&{chainId:n.id}}),{writeContract:c,data:p}=G(),{isLoading:a,isSuccess:f}=Q({hash:p}),d=()=>{r&&c({...t,functionName:"depositForLLM",value:ee("0.01"),...n?.id&&{chainId:n.id}})};return j.useEffect(()=>{f&&l()},[f,l]),j.useEffect(()=>{o&&o(l)},[l,o]),r?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{children:["Balance: ",s?A(s):"0"," ETH"]}),e.jsx("button",{onClick:d,disabled:a,style:{padding:"0.25rem 0.5rem",background:a?"#ccc":"#4CAF50",color:"white",border:"none",borderRadius:"3px",cursor:a?"not-allowed":"pointer",fontSize:"0.8rem"},title:a?"Transaction pending...":"Top up with 0.01 ETH",children:a?"...":"+"})]}):null}function se(){const[r,o]=u.useState([]),[t,n]=u.useState(""),[s,l]=u.useState(!1),[c,p]=u.useState(null),[a,f]=u.useState(null),[d,x]=u.useState(!1),{address:h,isConnected:b}=I(),{signMessageAsync:E}=ne(),z=i=>{f(()=>i)},P=async()=>{if(!h||!b)throw new Error("Wallet not connected");if(c)return c;const i=`Authenticate wallet: ${h}`,g=await E({message:i});return p(g),g},w=async i=>{if(!i.trim()||s)return;l(!0);const g={role:"user",content:i.trim(),timestamp:Date.now()};o(m=>[...m,g]),n("");try{const m=await P(),S=[{role:"system",content:"You are a helpful assistant."},...r.map(y=>({role:y.role,content:y.content})),{role:"user",content:i.trim()}],v=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:h,signature:m,message:`Authenticate wallet: ${h}`},data:{prompt:S}})});if(!v.ok){const y=await v.json();throw new Error(y.error||"Failed to get response")}const U={role:"assistant",content:(await v.json()).content||"No response received",timestamp:Date.now()};o(y=>[...y,U]),a&&a()}catch(m){const S={role:"assistant",content:`Error: ${m instanceof Error?m.message:"Unknown error"}`,timestamp:Date.now()};o(T=>[...T,S])}finally{l(!1)}},k=()=>{o([]),p(null)},L=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),w(t))};return b?e.jsxs("div",{className:C,children:[e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",height:"80vh",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 0"},children:[e.jsx("h2",{children:"Chat Assistant"}),e.jsx(ie,{address:h,onRefetchBalance:z}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>x(!0),style:{padding:"0.5rem 1rem",background:"transparent",color:"#333",border:"1px solid #ddd",borderRadius:"2px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},title:"View request history",children:"History"}),e.jsx("button",{onClick:k,style:{padding:"0.5rem 1rem",background:"transparent",color:"#666",border:"1px solid #ddd",borderRadius:"2px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},children:"Clear Chat"})]})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"1rem",backgroundColor:"#ffffff"},children:[r.length===0?e.jsx("div",{style:{textAlign:"center",color:"#888",padding:"2rem",fontSize:"0.9rem"},children:"Start a conversation by typing a message below."}):r.map((i,g)=>e.jsx("div",{style:{margin:"1rem 0",display:"flex",justifyContent:i.role==="user"?"flex-end":"flex-start"},children:e.jsxs("div",{style:{maxWidth:i.role==="user"?"70%":"80%",padding:"0.75rem 1rem",borderRadius:"8px",backgroundColor:i.role==="user"?"#2d3748":"#f8f9fa",color:i.role==="user"?"white":"#333",border:i.role==="user"?"none":"1px solid #e2e8f0"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"0.5rem",fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.8},children:i.role==="user"?"You":"Assistant"}),e.jsx("div",{style:{whiteSpace:"pre-wrap",lineHeight:"1.5"},children:i.content})]})},g)),s&&e.jsx("div",{style:{margin:"1rem 0",display:"flex",justifyContent:"flex-start"},children:e.jsx("div",{style:{maxWidth:"80%",padding:"0.75rem 1rem",borderRadius:"8px",backgroundColor:"#f8f9fa",color:"#333",border:"1px solid #e2e8f0",fontStyle:"italic"},children:"Assistant is typing..."})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",padding:"1rem 0"},children:[e.jsx("textarea",{value:t,onChange:i=>n(i.target.value),onKeyPress:L,placeholder:"Type your message here...",disabled:s,style:{flex:1,padding:"1rem",border:"1px solid #e0e0e0",borderRadius:"2px",resize:"vertical",minHeight:"60px",maxHeight:"120px",fontSize:"0.9rem",lineHeight:"1.5",outline:"none",backgroundColor:"#ffffff"}}),e.jsx("button",{onClick:()=>w(t),disabled:s||!t.trim(),style:{padding:"0.75rem 1.5rem",background:s||!t.trim()?"#f5f5f5":"#333",color:s||!t.trim()?"#999":"white",border:"1px solid #ddd",borderRadius:"2px",cursor:s||!t.trim()?"not-allowed":"pointer",whiteSpace:"nowrap",fontSize:"0.9rem",fontWeight:"500"},children:s?"Sending...":"Send"})]})]}),e.jsx(ae,{address:h,isOpen:d,onClose:()=>x(!1)})]}):e.jsx("div",{className:C,children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("h2",{children:"Chat Assistant"}),e.jsx("p",{children:"Please connect your wallet to use the chat assistant."})]})})}const le=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"})),ye={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:V}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:O}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:N}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:le}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:q}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:$}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:H}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:F}}};export{ye as configValuesSerialized};
