import{Y as de,Z as ue,_ as me,$ as pe,a0 as he,a1 as fe,r as d,j as e,a2 as ee,a3 as ge,a4 as t,a5 as te,a6 as be,a7 as ye,a8 as xe,a9 as ve,aa as Se,ab as je,ac as Ce,ad as V,ae as K,af as Te,ag as G,ah as we,ai as Le,aj as Ae,ak as Ne,al as Ee,am as J,an as ke,ao as Pe,ap as Be,aq as Me,ar as Ue,as as ze,at as De,au as $e,av as _e,aw as Fe,ax as Ie,ay as He,az as Re,aA as We,aB as Oe,aC as qe,aD as Ve,aE as Ke,aF as Ge,aG as Je,aH as Ye,aI as I,aJ as Y,aK as Q,aL as Qe,aM as Ze,aN as Xe,aO as et,aP as tt,aQ as st,aR as at,F as nt,a as ot,W as rt,c as it,d as lt,e as ct,o as dt}from"../chunks/chunk-D3pNghsZ.js";import{a as ut,l as Z}from"../chunks/chunk-DgwFTEmc.js";import{A as mt,g as pt,u as ht,a as ft,b as gt}from"../chunks/chunk-BMMEGLle.js";import{p as bt}from"../chunks/chunk-BPM6Dig5.js";import"../chunks/chunk-CFk4IfcH.js";/* empty css                      *//* empty css                      */async function yt(s,{account:r=s.account,message:a}){if(!r)throw new mt({docsPath:"/docs/actions/wallet/signMessage"});const n=de(r);if(n.signMessage)return n.signMessage({message:a});const p=typeof a=="string"?ue(a):a.raw instanceof Uint8Array?me(a.raw):a.raw;return s.request({method:"personal_sign",params:[p,n.address]},{retryCount:0})}async function xt(s,r){const{account:a,connector:n,...p}=r;let u;return typeof a=="object"&&a.type==="local"?u=s.getClient():u=await pt(s,{account:a,connector:n}),pe(u,yt,"signMessage")({...p,...a?{account:a}:{}})}function vt(s){return{mutationFn(r){return xt(s,r)},mutationKey:["signMessage"]}}function St(s={}){const{mutation:r}=s,a=he(s),n=vt(a),{mutate:p,mutateAsync:u,...f}=fe({...r,...n});return{...f,signMessage:p,signMessageAsync:u}}function jt({address:s,isOpen:r,onClose:a}){const[n,p]=d.useState([]),[u,f]=d.useState(!1),h=d.useCallback(async()=>{if(s){f(!0);try{const m=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${s}`)).json();p(m.leaves||[])}catch(c){console.error("Failed to fetch leaf history:",c)}finally{f(!1)}}},[s]);return d.useEffect(()=>{r&&s&&h()},[r,s,h]),r?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),u?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",n.length," requests"]}),n.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):n.slice(0,10).map(c=>{const m=(y=>y?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(c.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${m.borderColor}`,borderLeft:`${m.borderLeftWidth} solid ${m.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:m.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:m.textColor,fontWeight:"bold"},children:[m.icon," ",m.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(c.timestamp).toLocaleDateString()," ",new Date(c.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",c.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",ee(BigInt(c.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",c.treeIndex,", Leaf ",c.id]})]},`${c.treeIndex}-${c.id}`)}),n.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",n.length," requests"]})]})]}):null}function X({address:s}){const r=ut(),a=t({label:"assistent.invalidAmount"}),n=t({label:"assistent.invalidAmountFormat"}),p=t({label:"assistent.topUp"}),u=t({label:"assistent.topUpBalance"}),f=t({label:"assistent.currentBalance"}),h=t({label:"assistent.quickAmounts"}),c=t({label:"assistent.customAmount"}),b=t({label:"assistent.amountHint"}),m=t({label:"assistent.cancel"}),y=t({label:"assistent.processing"}),x=t({label:"assistent.topUpAmount"}),{data:v,refetch:E}=ht({...Z,functionName:"checkBalance",args:s?[s]:void 0,...r?.id&&{chainId:r.id}}),{writeContract:B,data:M}=ft(),{isLoading:S,isSuccess:j}=gt({hash:M}),[U,C]=d.useState(!1),[T,z]=d.useState("0.01"),[g,k]=d.useState(""),N=d.useMemo(()=>g.trim()||T,[g,T]),D=d.useMemo(()=>S?y:x.replace("{amount}",N),[S,y,x,N]),$=async()=>{if(s)try{const l=bt(N);if(!l||l<=0n){alert(a);return}B({...Z,functionName:"depositForLLM",value:l,...r?.id&&{chainId:r.id}}),C(!1)}catch(i){console.error("Top-up failed",i),alert(n)}};te.useEffect(()=>{j&&E()},[j,E]);const P=i=>{const l=parseFloat(ee(i));return l===0?"0":l>=1?l.toFixed(3):l>=.1?l.toFixed(4):l>=.001?l.toFixed(5):l.toFixed(6)};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:qe,children:[e.jsxs("span",{className:Ve,children:[v?P(v):"0"," ETH"]}),e.jsx("button",{onClick:()=>C(!0),disabled:S,className:Ke,children:p})]}),U&&e.jsx("div",{className:Ge,onClick:()=>C(!1),children:e.jsxs("div",{className:Je,onClick:i=>i.stopPropagation(),children:[e.jsx("h3",{className:Ye,children:u}),e.jsx("div",{className:I,children:e.jsxs("div",{className:Y,children:[f," ",v?P(v):"0"," ETH"]})}),e.jsxs("div",{className:I,children:[e.jsx("div",{className:Q,children:h}),e.jsx("div",{className:Qe,children:["0.001","0.005","0.01"].map(i=>e.jsxs("button",{onClick:()=>{z(i),k("")},className:`${Ze} ${T===i&&!g?Xe:""}`,children:[i," ETH"]},i))})]}),e.jsxs("div",{className:I,children:[e.jsx("div",{className:Q,children:c}),e.jsx("input",{type:"text",value:g,onChange:i=>k(i.target.value),placeholder:"0.0",className:et}),e.jsx("div",{className:Y,children:b})]}),e.jsxs("div",{className:tt,children:[e.jsx("button",{onClick:()=>C(!1),className:st,children:m}),e.jsx("button",{onClick:$,disabled:S||!g&&!T,className:at,children:D})]})]})})]}):null}function Ct(){const{trackEvent:s}=ge(),[r,a]=d.useState([]),[n,p]=d.useState(""),[u,f]=d.useState(!1),[h,c]=d.useState(!1),[b,m]=d.useState(null),[y,x]=d.useState(!1),v=t({label:"assistent.systemPrompt"}),E=t({label:"assistent.noResponse"}),B=t({label:"assistent.errorPrefix"}),M=t({label:"assistent.connectWalletMessage"}),S=t({label:"assistent.loading"}),j=t({label:"assistent.send"}),U=t({label:"assistent.unknownError"}),C=t({label:"assistent.balance"}),T=t({label:"assistent.typing"}),z=t({label:"assistent.actions"}),g=t({label:"assistent.history"}),k=t({label:"assistent.clearChat"}),N=t({label:"assistent.mobileTitle"}),D=t({label:"assistent.emptyState"}),$=t({label:"assistent.you"}),P=t({label:"assistent.assistant"});te.useEffect(()=>{const o=()=>{f(window.innerWidth<=768)};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const{address:i,isConnected:l}=be(),{signMessageAsync:se}=St(),{connectors:H,connect:ae}=ye(),ne=()=>{H.length>0&&ae({connector:H[0]})},R=d.useMemo(()=>l?h?"loading":n.trim()?"ready":"empty":"connect",[l,h,n]),oe=o=>{switch(o){case"connect":return M;case"loading":return S;case"empty":return j;case"ready":return j;default:return j}},re=async()=>{if(!i||!l)throw new Error("Wallet not connected");if(b)return b;const o=`Authenticate wallet: ${i}`,w=await se({message:o});return m(w),w},W=async o=>{if(!o.trim()||h)return;c(!0),r.length===0&&s("assistant-first-message-sent",{messageLength:o.trim().length,isMobile:u});const w={role:"user",content:o.trim(),timestamp:Date.now()};a(L=>[...L,w]),p("");try{const L=await re(),_=[{role:"system",content:v},...r.map(A=>({role:A.role,content:A.content})),{role:"user",content:o.trim()}],F=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:i,signature:L,message:`Authenticate wallet: ${i}`},data:{prompt:_}})});if(!F.ok){const A=await F.json();throw new Error(A.error||"Failed to get response")}const ce={role:"assistant",content:(await F.json()).content||E,timestamp:Date.now()};a(A=>[...A,ce])}catch(L){const _={role:"assistant",content:`${B} ${L instanceof Error?L.message:U}`,timestamp:Date.now()};a(q=>[...q,_])}finally{c(!1)}},O=()=>{a([]),m(null)},ie=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),l&&W(n))},le=()=>{if(!l){s("assistant-connect-button-click",{hasInput:n.trim().length>0}),ne();return}W(n)};return e.jsxs("div",{className:xe,children:[e.jsxs("div",{className:`${ve} ${u?Se:je}`,children:[!u&&e.jsxs("div",{className:Ce,children:[e.jsxs("div",{className:V,children:[e.jsx("h4",{className:K,children:C}),e.jsx(X,{address:i})]}),e.jsxs("div",{className:V,children:[e.jsx("h4",{className:K,children:z}),e.jsxs("div",{className:Te,children:[e.jsx("button",{onClick:()=>x(!0),className:G,title:"View request history",children:g}),e.jsx("button",{onClick:O,className:`${G} ${we}`,children:k})]})]})]}),e.jsxs("div",{className:Le,children:[u&&e.jsxs("div",{className:Ae,children:[e.jsx("h2",{className:Ne,children:N}),e.jsxs("div",{className:Ee,children:[e.jsx(X,{address:i}),e.jsx("button",{onClick:()=>x(!0),className:J,title:"History",children:"ðŸ“œ"}),e.jsx("button",{onClick:O,className:J,title:"Clear Chat",children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:ke,children:[r.length===0?e.jsx("div",{className:Pe,children:D}):r.map((o,w)=>e.jsx("div",{className:`${Be} ${o.role==="user"?Me:Ue}`,children:e.jsxs("div",{className:`${ze} ${o.role==="user"?De:$e}`,children:[e.jsx("div",{className:_e,children:o.role==="user"?$:P}),e.jsx("div",{className:Fe,children:o.content})]})},w)),h&&e.jsx("div",{className:Ie,children:e.jsx("div",{className:He,children:T})})]}),e.jsxs("div",{className:Re,children:[e.jsx("textarea",{value:n,onChange:o=>p(o.target.value),onKeyPress:ie,placeholder:t({label:"assistent.placeholder"}),disabled:h,className:We}),e.jsxs("button",{onClick:le,onMouseEnter:()=>{l||s("assistant-connect-button-hover")},disabled:h||(l?!n.trim():!1),className:Oe,children:[R==="connect"?"ðŸ”— ":"",oe(R)]})]})]})]}),e.jsx(jt,{address:i,isOpen:y,onClose:()=>x(!1)})]})}const Tt=Object.freeze(Object.defineProperty({__proto__:null,default:Ct},Symbol.toStringTag,{value:"Module"}));function wt(){return"AI Assistant with ETH Payments | fretchen.eu"}const Lt=Object.freeze(Object.defineProperty({__proto__:null,title:wt},Symbol.toStringTag,{value:"Module"})),zt={hasServerOnlyHook:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:dt}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ct}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:lt}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Tt}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:it}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Lt}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:rt}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ot}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:nt}}};export{zt as configValuesSerialized};
