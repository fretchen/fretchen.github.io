import{T as ue,U as me,V as pe,r as d,j as e,X as te,Y as he,C as t,Z as se,_ as fe,$ as ge,a0 as be,a1 as xe,a2 as ye,a3 as ve,a4 as Se,a5 as I,a6 as W,a7 as je,a8 as K,a9 as Ce,aa as Te,ab as we,ac as Le,ad as Ae,ae as J,af as Ne,ag as Ee,ah as ke,ai as Pe,aj as Be,ak as Ue,al as Me,am as ze,an as De,ao as $e,ap as _e,aq as Fe,ar as Ie,as as We,at as Re,au as He,av as Oe,aw as qe,ax as Ve,ay as Ge,az as Ke,aA as R,aB as Y,aC as X,aD as Je,aE as Ye,aF as Xe,aG as Ze,aH as Qe,aI as et,aJ as tt,F as st,a as at,W as nt,c as ot,d as it,e as rt,o as lt}from"../chunks/chunk-DmvswTr-.js";import{a as ct,l as Z}from"../chunks/chunk-CNgOLzuP.js";import{s as dt,A as Q}from"../chunks/chunk-BjhSYwU4.js";import{g as ut,u as mt,a as pt,b as ht}from"../chunks/chunk-B606wt9R.js";import{p as ft}from"../chunks/chunk-DNISneUn.js";import"../chunks/chunk-t-pXVLBL.js";/* empty css                      *//* empty css                      */async function gt(a,i){const{account:c,connector:r,...h}=i;let u;return typeof c=="object"&&c.type==="local"?u=a.getClient():u=await ut(a,{account:c,connector:r}),ue(u,dt,"signMessage")({...h,...c?{account:c}:{}})}function bt(a){return{mutationFn(i){return gt(a,i)},mutationKey:["signMessage"]}}function xt(a={}){const{mutation:i}=a,c=me(a),r=bt(c),{mutate:h,mutateAsync:u,...f}=pe({...i,...r});return{...f,signMessage:h,signMessageAsync:u}}function yt({address:a,isOpen:i,onClose:c}){const[r,h]=d.useState([]),[u,f]=d.useState(!1),p=d.useCallback(async()=>{if(a){f(!0);try{const m=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${a}`)).json();h(m.leaves||[])}catch(l){console.error("Failed to fetch leaf history:",l)}finally{f(!1)}}},[a]);return d.useEffect(()=>{i&&a&&p()},[i,a,p]),i?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:c,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),u?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",r.length," requests"]}),r.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):r.slice(0,10).map(l=>{const m=(x=>x?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(l.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${m.borderColor}`,borderLeft:`${m.borderLeftWidth} solid ${m.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:m.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:m.textColor,fontWeight:"bold"},children:[m.icon," ",m.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(l.timestamp).toLocaleDateString()," ",new Date(l.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",l.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",te(BigInt(l.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",l.treeIndex,", Leaf ",l.id]})]},`${l.treeIndex}-${l.id}`)}),r.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",r.length," requests"]})]})]}):null}function ee({address:a}){const i=ct(),c=t({label:"assistent.invalidAmount"}),r=t({label:"assistent.invalidAmountFormat"}),h=t({label:"assistent.topUp"}),u=t({label:"assistent.topUpBalance"}),f=t({label:"assistent.currentBalance"}),p=t({label:"assistent.quickAmounts"}),l=t({label:"assistent.customAmount"}),b=t({label:"assistent.amountHint"}),m=t({label:"assistent.cancel"}),x=t({label:"assistent.processing"}),y=t({label:"assistent.topUpAmount"}),{data:v,refetch:E}=mt({...Z,functionName:"checkBalance",args:a?[a]:void 0,...i?.id&&{chainId:i.id}}),{writeContract:B,data:U}=pt(),{isLoading:S,isSuccess:j}=ht({hash:U}),[M,C]=d.useState(!1),[T,z]=d.useState("0.01"),[g,k]=d.useState(""),N=d.useMemo(()=>g.trim()||T,[g,T]),D=d.useMemo(()=>S?x:y.replace("{amount}",N),[S,x,y,N]),$=async()=>{if(a)try{const o=ft(N);if(!o||o<=0n){alert(c);return}B({...Z,functionName:"depositForLLM",value:o,...i?.id&&{chainId:i.id}}),C(!1)}catch(n){console.error("Top-up failed",n),alert(r)}};se.useEffect(()=>{j&&E()},[j,E]);const P=n=>{const o=parseFloat(te(n));return o===0?"0":o>=1?o.toFixed(3):o>=.1?o.toFixed(4):o>=.001?o.toFixed(5):o.toFixed(6)};return a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:He,children:[e.jsxs("span",{className:Oe,children:[v?P(v):"0"," ETH"]}),e.jsx("button",{onClick:()=>C(!0),disabled:S,className:qe,children:h})]}),M&&e.jsx("div",{className:Ve,onClick:()=>C(!1),children:e.jsxs("div",{className:Ge,onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{className:Ke,children:u}),e.jsx("div",{className:R,children:e.jsxs("div",{className:Y,children:[f," ",v?P(v):"0"," ETH"]})}),e.jsxs("div",{className:R,children:[e.jsx("div",{className:X,children:p}),e.jsx("div",{className:Je,children:["0.001","0.005","0.01"].map(n=>e.jsxs("button",{onClick:()=>{z(n),k("")},className:`${Ye} ${T===n&&!g?Xe:""}`,children:[n," ETH"]},n))})]}),e.jsxs("div",{className:R,children:[e.jsx("div",{className:X,children:l}),e.jsx("input",{type:"text",value:g,onChange:n=>k(n.target.value),placeholder:"0.0",className:Ze}),e.jsx("div",{className:Y,children:b})]}),e.jsxs("div",{className:Qe,children:[e.jsx("button",{onClick:()=>C(!1),className:et,children:m}),e.jsx("button",{onClick:$,disabled:S||!g&&!T,className:tt,children:D})]})]})})]}):null}function vt(){const{trackEvent:a}=he(),[i,c]=d.useState([]),[r,h]=d.useState(""),[u,f]=d.useState(!1),[p,l]=d.useState(!1),[b,m]=d.useState(null),[x,y]=d.useState(!1),v=t({label:"assistent.systemPrompt"}),E=t({label:"assistent.noResponse"}),B=t({label:"assistent.errorPrefix"}),U=t({label:"assistent.connectWalletMessage"}),S=t({label:"assistent.loading"}),j=t({label:"assistent.send"}),M=t({label:"assistent.unknownError"}),C=t({label:"assistent.balance"}),T=t({label:"assistent.typing"}),z=t({label:"assistent.actions"}),g=t({label:"assistent.history"}),k=t({label:"assistent.clearChat"}),N=t({label:"assistent.mobileTitle"}),D=t({label:"assistent.emptyState"}),$=t({label:"assistent.you"}),P=t({label:"assistent.assistant"});se.useEffect(()=>{const s=()=>{f(window.innerWidth<=768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const{address:n,isConnected:o}=fe(),{signMessageAsync:ae}=xt(),{connectors:H,connect:ne}=ge(),oe=()=>{H.length>0&&ne({connector:H[0]})},O=d.useMemo(()=>o?p?"loading":r.trim()?"ready":"empty":"connect",[o,p,r]),ie=s=>{switch(s){case"connect":return U;case"loading":return S;case"empty":return j;case"ready":return j;default:return j}},re=async()=>{if(!n||!o)throw new Error("Wallet not connected");if(b)return b;const s=`Authenticate wallet: ${n}`,w=await ae({message:s});return m(w),w},q=async s=>{if(!s.trim()||p)return;l(!0),i.length===0&&a("assistant-first-message-sent",{messageLength:s.trim().length,isMobile:u});const w={role:"user",content:s.trim(),timestamp:Date.now()};c(L=>[...L,w]),h("");try{const L=await re(),_=[{role:"system",content:v},...i.map(A=>({role:A.role,content:A.content})),{role:"user",content:s.trim()}],F=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:n,signature:L,message:`Authenticate wallet: ${n}`},data:{prompt:_}})});if(!F.ok){const A=await F.json();throw new Error(A.error||"Failed to get response")}const de={role:"assistant",content:(await F.json()).content||E,timestamp:Date.now()};c(A=>[...A,de])}catch(L){const _={role:"assistant",content:`${B} ${L instanceof Error?L.message:M}`,timestamp:Date.now()};c(G=>[...G,_])}finally{l(!1)}},V=()=>{c([]),m(null)},le=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),o&&q(r))},ce=()=>{if(!o){a("assistant-connect-button-click",{hasInput:r.trim().length>0}),oe();return}q(r)};return e.jsxs("div",{className:be,children:[e.jsxs("div",{className:`${xe} ${u?ye:ve}`,children:[!u&&e.jsxs("div",{className:Se,children:[e.jsxs("div",{className:I,children:[e.jsx("h4",{className:W,children:C}),e.jsx(ee,{address:n})]}),e.jsxs("div",{className:I,children:[e.jsx("h4",{className:W,children:z}),e.jsxs("div",{className:je,children:[e.jsx("button",{onClick:()=>y(!0),className:K,title:"View request history",children:g}),e.jsx("button",{onClick:V,className:`${K} ${Ce}`,children:k})]})]}),e.jsxs("div",{className:I,children:[e.jsx("h4",{className:W,children:"Agent"}),e.jsx(Q,{service:"llm",variant:"sidebar"})]})]}),e.jsxs("div",{className:Te,children:[u&&e.jsxs("div",{className:we,children:[e.jsx("h2",{className:Le,children:N}),e.jsxs("div",{className:Ae,children:[e.jsx(ee,{address:n}),e.jsx("button",{onClick:()=>y(!0),className:J,title:"History",children:"ðŸ“œ"}),e.jsx("button",{onClick:V,className:J,title:"Clear Chat",children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:Ne,children:[i.length===0?e.jsx("div",{className:Ee,children:D}):i.map((s,w)=>e.jsx("div",{className:`${ke} ${s.role==="user"?Pe:Be}`,children:e.jsxs("div",{className:`${Ue} ${s.role==="user"?Me:ze}`,children:[e.jsx("div",{className:De,children:s.role==="user"?$:P}),e.jsx("div",{className:$e,children:s.content})]})},w)),p&&e.jsx("div",{className:_e,children:e.jsx("div",{className:Fe,children:T})})]}),e.jsxs("div",{className:Ie,children:[e.jsx("textarea",{value:r,onChange:s=>h(s.target.value),onKeyPress:le,placeholder:t({label:"assistent.placeholder"}),disabled:p,className:We}),e.jsxs("button",{onClick:ce,onMouseEnter:()=>{o||a("assistant-connect-button-hover")},disabled:p||(o?!r.trim():!1),className:Re,children:[O==="connect"?"ðŸ”— ":"",ie(O)]})]}),u&&e.jsx(Q,{service:"llm",variant:"sidebar"})]})]}),e.jsx(yt,{address:n,isOpen:x,onClose:()=>y(!1)})]})}const St=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"}));function jt(){return"AI Assistant with ETH Payments | fretchen.eu"}const Ct=Object.freeze(Object.defineProperty({__proto__:null,title:jt},Symbol.toStringTag,{value:"Module"})),Ut={hasServerOnlyHook:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:lt}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:rt}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:it}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:St}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:ot}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Ct}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:nt}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:at}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:st}}};export{Ut as configValuesSerialized};
