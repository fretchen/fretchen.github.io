import{Y as B,Z as R,_ as W,$ as D,a0 as M,a1 as F,r as u,j as e,a2 as L,a3 as _,f as E,X as P,F as I,i as H,W as $,a as q,d as N,e as O,o as V}from"../chunks/chunk-RwPR_Zb9.js";import{A as K,g as Y,a as J,b as Q,u as X,c as Z,d as G}from"../chunks/chunk-Bv2R8qzj.js";import{p as ee}from"../chunks/chunk-DSg_p6oE.js";import"../chunks/chunk-ETYCELfk.js";/* empty css                      *//* empty css                      *//* empty css                      */async function te(o,{account:i=o.account,message:r}){if(!i)throw new K({docsPath:"/docs/actions/wallet/signMessage"});const a=B(i);if(a.signMessage)return a.signMessage({message:r});const s=typeof r=="string"?R(r):r.raw instanceof Uint8Array?W(r.raw):r.raw;return o.request({method:"personal_sign",params:[s,a.address]},{retryCount:0})}async function re(o,i){const{account:r,connector:a,...s}=i;let d;return typeof r=="object"&&r.type==="local"?d=o.getClient():d=await Y(o,{account:r,connector:a}),D(d,te,"signMessage")({...s,...r?{account:r}:{}})}function oe(o){return{mutationFn(i){return re(o,i)},mutationKey:["signMessage"]}}function ne(o={}){const{mutation:i}=o,r=M(o),a=oe(r),{mutate:s,mutateAsync:d,...f}=F({...i,...a});return{...f,signMessage:s,signMessageAsync:d}}function ie({address:o,isOpen:i,onClose:r}){const[a,s]=u.useState([]),[d,f]=u.useState(!1),g=async()=>{if(o){f(!0);try{const c=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${o}`)).json();s(c.leaves||[])}catch(n){console.error("Failed to fetch leaf history:",n)}finally{f(!1)}}};return u.useEffect(()=>{i&&o&&g()},[i,o]),i?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"📊 Request History"}),e.jsx("button",{onClick:r,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"✕"})]}),d?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",a.length," requests"]}),a.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):a.slice(0,10).map(n=>{const c=(h=>h?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"✓",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"⏳",text:"Unprocessed",textColor:"#ef6c00"})(n.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${c.borderColor}`,borderLeft:`${c.borderLeftWidth} solid ${c.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:c.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:c.textColor,fontWeight:"bold"},children:[c.icon," ",c.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(n.timestamp).toLocaleDateString()," ",new Date(n.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",n.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",L(BigInt(n.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",n.treeIndex,", Leaf ",n.id]})]},`${n.treeIndex}-${n.id}`)}),a.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",a.length," requests"]})]})]}):null}function ae({address:o,onRefetchBalance:i}){const r=J(),a=Q(),{data:s,refetch:d}=X({...r,functionName:"checkBalance",args:o?[o]:void 0,...a?.id&&{chainId:a.id}}),{writeContract:f,data:g}=Z(),{isLoading:n,isSuccess:x}=G({hash:g}),[c,h]=u.useState(!1),[p,b]=u.useState("0.01"),[m,j]=u.useState(""),C=()=>m.trim()||p,T=async()=>{if(o)try{const l=C(),t=ee(l);if(!t||t<=0n){alert("Enter a valid amount greater than 0");return}f({...r,functionName:"depositForLLM",value:t,...a?.id&&{chainId:a.id}}),h(!1)}catch(l){console.error("Top-up failed",l),alert("Invalid amount format")}};P.useEffect(()=>{x&&d()},[x,d]),P.useEffect(()=>{i&&i(d)},[d,i]);const w=l=>{const t=parseFloat(L(l));return t===0?"0":t>=1?t.toFixed(3):t>=.1?t.toFixed(4):t>=.001?t.toFixed(5):t.toFixed(6)};return o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"#333"},children:["LLM Chat Credits: ",s?w(s):"0"," ETH"]}),e.jsx("button",{onClick:()=>h(!0),disabled:n,style:{padding:"0.35rem 0.6rem",background:"transparent",color:"#333",border:"1px solid #ddd",borderRadius:"3px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},children:"+ Top up"})]}),c&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>h(!1),children:e.jsxs("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"8px",minWidth:"300px",maxWidth:"400px"},onClick:l=>l.stopPropagation(),children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem"},children:"Top up Balance"}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",color:"#666"},children:["Current balance: ",s?w(s):"0"," ETH"]})}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsx("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:"Quick amounts:"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:["0.001","0.005","0.01"].map(l=>e.jsxs("button",{onClick:()=>{b(l),j("")},style:{padding:"0.5rem 1rem",border:p===l&&!m?"2px solid #333":"1px solid #ddd",background:p===l&&!m?"#f8f9fa":"white",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:[l," ETH"]},l))})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:"Custom amount:"}),e.jsx("input",{type:"text",value:m,onChange:l=>j(l.target.value),placeholder:"0.0",style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"4px",fontSize:"0.9rem"}}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"0.25rem"},children:"Amount in ETH (e.g., 0.025)"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>h(!1),style:{padding:"0.5rem 1rem",background:"transparent",color:"#666",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:"Cancel"}),e.jsx("button",{onClick:T,disabled:n||!m&&!p,style:{padding:"0.5rem 1rem",background:n?"#f5f5f5":"#333",color:n?"#999":"white",border:"none",borderRadius:"4px",cursor:n?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"500"},children:n?"Processing...":`Top up ${C()} ETH`})]})]})})]}):null}function se(){const[o,i]=u.useState([]),[r,a]=u.useState(""),[s,d]=u.useState(!1),[f,g]=u.useState(null),[n,x]=u.useState(null),[c,h]=u.useState(!1),{address:p,isConnected:b}=_(),{signMessageAsync:m}=ne(),j=t=>{x(()=>t)},C=async()=>{if(!p||!b)throw new Error("Wallet not connected");if(f)return f;const t=`Authenticate wallet: ${p}`,y=await m({message:t});return g(y),y},T=async t=>{if(!t.trim()||s)return;d(!0);const y={role:"user",content:t.trim(),timestamp:Date.now()};i(S=>[...S,y]),a("");try{const S=await C(),z=[{role:"system",content:"You are a helpful assistant."},...o.map(v=>({role:v.role,content:v.content})),{role:"user",content:t.trim()}],A=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:p,signature:S,message:`Authenticate wallet: ${p}`},data:{prompt:z}})});if(!A.ok){const v=await A.json();throw new Error(v.error||"Failed to get response")}const U={role:"assistant",content:(await A.json()).content||"No response received",timestamp:Date.now()};i(v=>[...v,U]),n&&n()}catch(S){const z={role:"assistant",content:`Error: ${S instanceof Error?S.message:"Unknown error"}`,timestamp:Date.now()};i(k=>[...k,z])}finally{d(!1)}},w=()=>{i([]),g(null)},l=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),T(r))};return b?e.jsxs("div",{className:E,children:[e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",height:"80vh",display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem 0"},children:[e.jsx(ae,{address:p,onRefetchBalance:j}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>h(!0),style:{padding:"0.5rem 1rem",background:"transparent",color:"#333",border:"1px solid #ddd",borderRadius:"2px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},title:"View request history",children:"History"}),e.jsx("button",{onClick:w,style:{padding:"0.5rem 1rem",background:"transparent",color:"#666",border:"1px solid #ddd",borderRadius:"2px",cursor:"pointer",fontSize:"0.85rem",fontWeight:"500"},children:"Clear Chat"})]})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",border:"1px solid #e0e0e0",borderRadius:"4px",padding:"1rem",backgroundColor:"#ffffff"},children:[o.length===0?e.jsx("div",{style:{textAlign:"center",color:"#888",padding:"2rem",fontSize:"0.9rem"},children:"Start a conversation by typing a message below."}):o.map((t,y)=>e.jsx("div",{style:{margin:"1rem 0",display:"flex",justifyContent:t.role==="user"?"flex-end":"flex-start"},children:e.jsxs("div",{style:{maxWidth:t.role==="user"?"70%":"80%",padding:"0.75rem 1rem",borderRadius:"8px",backgroundColor:t.role==="user"?"#2d3748":"#f8f9fa",color:t.role==="user"?"white":"#333",border:t.role==="user"?"none":"1px solid #e2e8f0"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"0.5rem",fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.8},children:t.role==="user"?"You":"Assistant"}),e.jsx("div",{style:{whiteSpace:"pre-wrap",lineHeight:"1.5"},children:t.content})]})},y)),s&&e.jsx("div",{style:{margin:"1rem 0",display:"flex",justifyContent:"flex-start"},children:e.jsx("div",{style:{maxWidth:"80%",padding:"0.75rem 1rem",borderRadius:"8px",backgroundColor:"#f8f9fa",color:"#333",border:"1px solid #e2e8f0",fontStyle:"italic"},children:"Assistant is typing..."})})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",padding:"1rem 0"},children:[e.jsx("textarea",{value:r,onChange:t=>a(t.target.value),onKeyPress:l,placeholder:"Type your message here...",disabled:s,style:{flex:1,padding:"1rem",border:"1px solid #e0e0e0",borderRadius:"2px",resize:"vertical",minHeight:"60px",maxHeight:"120px",fontSize:"0.9rem",lineHeight:"1.5",outline:"none",backgroundColor:"#ffffff"}}),e.jsx("button",{onClick:()=>T(r),disabled:s||!r.trim(),style:{padding:"0.75rem 1.5rem",background:s||!r.trim()?"#f5f5f5":"#333",color:s||!r.trim()?"#999":"white",border:"1px solid #ddd",borderRadius:"2px",cursor:s||!r.trim()?"not-allowed":"pointer",whiteSpace:"nowrap",fontSize:"0.9rem",fontWeight:"500"},children:s?"Sending...":"Send"})]})]}),e.jsx(ie,{address:p,isOpen:c,onClose:()=>h(!1)})]}):e.jsx("div",{className:E,children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem"},children:[e.jsx("h2",{children:"Chat Assistant"}),e.jsx("p",{children:"Please connect your wallet to use the chat assistant."})]})})}const le=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"})),xe={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:V}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:O}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:N}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:le}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:q}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:$}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:H}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:I}}};export{xe as configValuesSerialized};
