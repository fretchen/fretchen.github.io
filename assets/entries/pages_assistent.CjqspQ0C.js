import{_ as ue,$ as me,a0 as pe,a1 as he,a2 as fe,a3 as ge,r as d,j as e,a4 as te,a5 as be,f as t,a6 as se,a7 as ye,a8 as xe,a9 as ve,aa as Se,ab as je,ac as Ce,ad as Te,ae as I,af as H,ag as we,ah as G,ai as Ae,aj as Le,ak as Ne,al as Ee,am as ke,an as J,ao as Pe,ap as Be,aq as Me,ar as Ue,as as ze,at as De,au as $e,av as _e,aw as Fe,ax as Ie,ay as He,az as Re,aA as We,aB as Oe,aC as qe,aD as Ve,aE as Ke,aF as Ge,aG as Je,aH as Qe,aI as Ye,aJ as R,aK as Q,aL as Y,aM as Xe,aN as Ze,aO as et,aP as tt,aQ as st,aR as at,aS as nt,F as ot,a as rt,W as it,c as lt,d as ct,e as dt,o as ut}from"../chunks/chunk-D99inmG0.js";import{a as mt,l as X}from"../chunks/chunk-B36DBCoT.js";import{A as Z}from"../chunks/chunk-CMJLewve.js";import{A as pt,g as ht,u as ft,a as gt,b as bt}from"../chunks/chunk-BtZP5Ako.js";import{p as yt}from"../chunks/chunk-j9cq7vum.js";import"../chunks/chunk-t-pXVLBL.js";/* empty css                      *//* empty css                      */async function xt(s,{account:r=s.account,message:a}){if(!r)throw new pt({docsPath:"/docs/actions/wallet/signMessage"});const n=ue(r);if(n.signMessage)return n.signMessage({message:a});const p=typeof a=="string"?me(a):a.raw instanceof Uint8Array?pe(a.raw):a.raw;return s.request({method:"personal_sign",params:[p,n.address]},{retryCount:0})}async function vt(s,r){const{account:a,connector:n,...p}=r;let u;return typeof a=="object"&&a.type==="local"?u=s.getClient():u=await ht(s,{account:a,connector:n}),he(u,xt,"signMessage")({...p,...a?{account:a}:{}})}function St(s){return{mutationFn(r){return vt(s,r)},mutationKey:["signMessage"]}}function jt(s={}){const{mutation:r}=s,a=fe(s),n=St(a),{mutate:p,mutateAsync:u,...f}=ge({...r,...n});return{...f,signMessage:p,signMessageAsync:u}}function Ct({address:s,isOpen:r,onClose:a}){const[n,p]=d.useState([]),[u,f]=d.useState(!1),h=d.useCallback(async()=>{if(s){f(!0);try{const m=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${s}`)).json();p(m.leaves||[])}catch(c){console.error("Failed to fetch leaf history:",c)}finally{f(!1)}}},[s]);return d.useEffect(()=>{r&&s&&h()},[r,s,h]),r?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),u?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",n.length," requests"]}),n.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):n.slice(0,10).map(c=>{const m=(y=>y?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(c.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${m.borderColor}`,borderLeft:`${m.borderLeftWidth} solid ${m.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:m.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:m.textColor,fontWeight:"bold"},children:[m.icon," ",m.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(c.timestamp).toLocaleDateString()," ",new Date(c.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",c.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",te(BigInt(c.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",c.treeIndex,", Leaf ",c.id]})]},`${c.treeIndex}-${c.id}`)}),n.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",n.length," requests"]})]})]}):null}function ee({address:s}){const r=mt(),a=t({label:"assistent.invalidAmount"}),n=t({label:"assistent.invalidAmountFormat"}),p=t({label:"assistent.topUp"}),u=t({label:"assistent.topUpBalance"}),f=t({label:"assistent.currentBalance"}),h=t({label:"assistent.quickAmounts"}),c=t({label:"assistent.customAmount"}),b=t({label:"assistent.amountHint"}),m=t({label:"assistent.cancel"}),y=t({label:"assistent.processing"}),x=t({label:"assistent.topUpAmount"}),{data:v,refetch:E}=ft({...X,functionName:"checkBalance",args:s?[s]:void 0,...r?.id&&{chainId:r.id}}),{writeContract:B,data:M}=gt(),{isLoading:S,isSuccess:j}=bt({hash:M}),[U,C]=d.useState(!1),[T,z]=d.useState("0.01"),[g,k]=d.useState(""),N=d.useMemo(()=>g.trim()||T,[g,T]),D=d.useMemo(()=>S?y:x.replace("{amount}",N),[S,y,x,N]),$=async()=>{if(s)try{const l=yt(N);if(!l||l<=0n){alert(a);return}B({...X,functionName:"depositForLLM",value:l,...r?.id&&{chainId:r.id}}),C(!1)}catch(i){console.error("Top-up failed",i),alert(n)}};se.useEffect(()=>{j&&E()},[j,E]);const P=i=>{const l=parseFloat(te(i));return l===0?"0":l>=1?l.toFixed(3):l>=.1?l.toFixed(4):l>=.001?l.toFixed(5):l.toFixed(6)};return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:Ve,children:[e.jsxs("span",{className:Ke,children:[v?P(v):"0"," ETH"]}),e.jsx("button",{onClick:()=>C(!0),disabled:S,className:Ge,children:p})]}),U&&e.jsx("div",{className:Je,onClick:()=>C(!1),children:e.jsxs("div",{className:Qe,onClick:i=>i.stopPropagation(),children:[e.jsx("h3",{className:Ye,children:u}),e.jsx("div",{className:R,children:e.jsxs("div",{className:Q,children:[f," ",v?P(v):"0"," ETH"]})}),e.jsxs("div",{className:R,children:[e.jsx("div",{className:Y,children:h}),e.jsx("div",{className:Xe,children:["0.001","0.005","0.01"].map(i=>e.jsxs("button",{onClick:()=>{z(i),k("")},className:`${Ze} ${T===i&&!g?et:""}`,children:[i," ETH"]},i))})]}),e.jsxs("div",{className:R,children:[e.jsx("div",{className:Y,children:c}),e.jsx("input",{type:"text",value:g,onChange:i=>k(i.target.value),placeholder:"0.0",className:tt}),e.jsx("div",{className:Q,children:b})]}),e.jsxs("div",{className:st,children:[e.jsx("button",{onClick:()=>C(!1),className:at,children:m}),e.jsx("button",{onClick:$,disabled:S||!g&&!T,className:nt,children:D})]})]})})]}):null}function Tt(){const{trackEvent:s}=be(),[r,a]=d.useState([]),[n,p]=d.useState(""),[u,f]=d.useState(!1),[h,c]=d.useState(!1),[b,m]=d.useState(null),[y,x]=d.useState(!1),v=t({label:"assistent.systemPrompt"}),E=t({label:"assistent.noResponse"}),B=t({label:"assistent.errorPrefix"}),M=t({label:"assistent.connectWalletMessage"}),S=t({label:"assistent.loading"}),j=t({label:"assistent.send"}),U=t({label:"assistent.unknownError"}),C=t({label:"assistent.balance"}),T=t({label:"assistent.typing"}),z=t({label:"assistent.actions"}),g=t({label:"assistent.history"}),k=t({label:"assistent.clearChat"}),N=t({label:"assistent.mobileTitle"}),D=t({label:"assistent.emptyState"}),$=t({label:"assistent.you"}),P=t({label:"assistent.assistant"});se.useEffect(()=>{const o=()=>{f(window.innerWidth<=768)};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const{address:i,isConnected:l}=ye(),{signMessageAsync:ae}=jt(),{connectors:W,connect:ne}=xe(),oe=()=>{W.length>0&&ne({connector:W[0]})},O=d.useMemo(()=>l?h?"loading":n.trim()?"ready":"empty":"connect",[l,h,n]),re=o=>{switch(o){case"connect":return M;case"loading":return S;case"empty":return j;case"ready":return j;default:return j}},ie=async()=>{if(!i||!l)throw new Error("Wallet not connected");if(b)return b;const o=`Authenticate wallet: ${i}`,w=await ae({message:o});return m(w),w},q=async o=>{if(!o.trim()||h)return;c(!0),r.length===0&&s("assistant-first-message-sent",{messageLength:o.trim().length,isMobile:u});const w={role:"user",content:o.trim(),timestamp:Date.now()};a(A=>[...A,w]),p("");try{const A=await ie(),_=[{role:"system",content:v},...r.map(L=>({role:L.role,content:L.content})),{role:"user",content:o.trim()}],F=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:i,signature:A,message:`Authenticate wallet: ${i}`},data:{prompt:_}})});if(!F.ok){const L=await F.json();throw new Error(L.error||"Failed to get response")}const de={role:"assistant",content:(await F.json()).content||E,timestamp:Date.now()};a(L=>[...L,de])}catch(A){const _={role:"assistant",content:`${B} ${A instanceof Error?A.message:U}`,timestamp:Date.now()};a(K=>[...K,_])}finally{c(!1)}},V=()=>{a([]),m(null)},le=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),l&&q(n))},ce=()=>{if(!l){s("assistant-connect-button-click",{hasInput:n.trim().length>0}),oe();return}q(n)};return e.jsxs("div",{className:ve,children:[e.jsxs("div",{className:`${Se} ${u?je:Ce}`,children:[!u&&e.jsxs("div",{className:Te,children:[e.jsxs("div",{className:I,children:[e.jsx("h4",{className:H,children:C}),e.jsx(ee,{address:i})]}),e.jsxs("div",{className:I,children:[e.jsx("h4",{className:H,children:z}),e.jsxs("div",{className:we,children:[e.jsx("button",{onClick:()=>x(!0),className:G,title:"View request history",children:g}),e.jsx("button",{onClick:V,className:`${G} ${Ae}`,children:k})]})]}),e.jsxs("div",{className:I,children:[e.jsx("h4",{className:H,children:"Agent"}),e.jsx(Z,{service:"llm",variant:"sidebar"})]})]}),e.jsxs("div",{className:Le,children:[u&&e.jsxs("div",{className:Ne,children:[e.jsx("h2",{className:Ee,children:N}),e.jsxs("div",{className:ke,children:[e.jsx(ee,{address:i}),e.jsx("button",{onClick:()=>x(!0),className:J,title:"History",children:"ðŸ“œ"}),e.jsx("button",{onClick:V,className:J,title:"Clear Chat",children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:Pe,children:[r.length===0?e.jsx("div",{className:Be,children:D}):r.map((o,w)=>e.jsx("div",{className:`${Me} ${o.role==="user"?Ue:ze}`,children:e.jsxs("div",{className:`${De} ${o.role==="user"?$e:_e}`,children:[e.jsx("div",{className:Fe,children:o.role==="user"?$:P}),e.jsx("div",{className:Ie,children:o.content})]})},w)),h&&e.jsx("div",{className:He,children:e.jsx("div",{className:Re,children:T})})]}),e.jsxs("div",{className:We,children:[e.jsx("textarea",{value:n,onChange:o=>p(o.target.value),onKeyPress:le,placeholder:t({label:"assistent.placeholder"}),disabled:h,className:Oe}),e.jsxs("button",{onClick:ce,onMouseEnter:()=>{l||s("assistant-connect-button-hover")},disabled:h||(l?!n.trim():!1),className:qe,children:[O==="connect"?"ðŸ”— ":"",re(O)]})]}),u&&e.jsx(Z,{service:"llm",variant:"sidebar"})]})]}),e.jsx(Ct,{address:i,isOpen:y,onClose:()=>x(!1)})]})}const wt=Object.freeze(Object.defineProperty({__proto__:null,default:Tt},Symbol.toStringTag,{value:"Module"}));function At(){return"AI Assistant with ETH Payments | fretchen.eu"}const Lt=Object.freeze(Object.defineProperty({__proto__:null,title:At},Symbol.toStringTag,{value:"Module"})),$t={hasServerOnlyHook:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ut}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:dt}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ct}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:wt}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:lt}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Lt}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:it}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:rt}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ot}}};export{$t as configValuesSerialized};
