import{J as le,K as ce,M as de,N as ue,O as me,P as pe,r as l,j as e,Q as Z,S as s,R as ee,T as he,U as fe,V as ge,X as be,Y as ye,Z as xe,_ as ve,$ as V,a0 as K,a1 as Se,a2 as G,a3 as je,a4 as Ce,a5 as Te,a6 as we,a7 as Le,a8 as J,a9 as Ae,aa as Ne,ab as Ee,ac as ke,ad as Be,ae as Pe,af as Me,ag as Ue,ah as ze,ai as De,aj as $e,ak as Fe,al as _e,am as Re,an as We,ao as He,ap as Ie,aq as qe,ar as Oe,as as Ve,at as Ke,au as W,av as Y,aw as Q,ax as Ge,ay as Je,az as Ye,aA as Qe,aB as Xe,aC as Ze,aD as et,F as tt,a as st,W as at,d as nt,e as ot,f as rt,o as it}from"../chunks/chunk-opfS9jr-.js";import{A as lt,g as ct,u as dt,a as ut,b as mt,c as pt,d as ht}from"../chunks/chunk-CMaedKqY.js";import{p as ft}from"../chunks/chunk-Cw-rqVDD.js";import"../chunks/chunk-CT5atk_u.js";/* empty css                      *//* empty css                      *//* empty css                      */async function gt(a,{account:o=a.account,message:t}){if(!o)throw new lt({docsPath:"/docs/actions/wallet/signMessage"});const r=le(o);if(r.signMessage)return r.signMessage({message:t});const m=typeof t=="string"?ce(t):t.raw instanceof Uint8Array?de(t.raw):t.raw;return a.request({method:"personal_sign",params:[m,r.address]},{retryCount:0})}async function bt(a,o){const{account:t,connector:r,...m}=o;let h;return typeof t=="object"&&t.type==="local"?h=a.getClient():h=await ct(a,{account:t,connector:r}),ue(h,gt,"signMessage")({...m,...t?{account:t}:{}})}function yt(a){return{mutationFn(o){return bt(a,o)},mutationKey:["signMessage"]}}function xt(a={}){const{mutation:o}=a,t=me(a),r=yt(t),{mutate:m,mutateAsync:h,...u}=pe({...o,...r});return{...u,signMessage:m,signMessageAsync:h}}function vt({address:a,isOpen:o,onClose:t}){const[r,m]=l.useState([]),[h,u]=l.useState(!1),b=l.useCallback(async()=>{if(a){u(!0);try{const p=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${a}`)).json();m(p.leaves||[])}catch(i){console.error("Failed to fetch leaf history:",i)}finally{u(!1)}}},[a]);return l.useEffect(()=>{o&&a&&b()},[o,a,b]),o?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:t,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),h?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",r.length," requests"]}),r.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):r.slice(0,10).map(i=>{const p=(y=>y?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(i.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${p.borderColor}`,borderLeft:`${p.borderLeftWidth} solid ${p.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:p.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:p.textColor,fontWeight:"bold"},children:[p.icon," ",p.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(i.timestamp).toLocaleDateString()," ",new Date(i.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",i.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",Z(BigInt(i.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",i.treeIndex,", Leaf ",i.id]})]},`${i.treeIndex}-${i.id}`)}),r.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",r.length," requests"]})]})]}):null}function X({address:a}){const o=mt(),t=ut(),r=s({label:"assistent.invalidAmount"}),m=s({label:"assistent.invalidAmountFormat"}),h=s({label:"assistent.topUp"}),u=s({label:"assistent.topUpBalance"}),b=s({label:"assistent.currentBalance"}),i=s({label:"assistent.quickAmounts"}),v=s({label:"assistent.customAmount"}),p=s({label:"assistent.amountHint"}),y=s({label:"assistent.cancel"}),k=s({label:"assistent.processing"}),B=s({label:"assistent.topUpAmount"}),{data:S,refetch:P}=dt({...o,functionName:"checkBalance",args:a?[a]:void 0,...t?.id&&{chainId:t.id}}),{writeContract:z,data:N}=pt(),{isLoading:j,isSuccess:M}=ht({hash:N}),[D,C]=l.useState(!1),[T,$]=l.useState("0.01"),[x,U]=l.useState(""),E=l.useMemo(()=>x.trim()||T,[x,T]),F=l.useMemo(()=>j?k:B.replace("{amount}",E),[j,k,B,E]),f=async()=>{if(a)try{const d=ft(E);if(!d||d<=0n){alert(r);return}z({...o,functionName:"depositForLLM",value:d,...t?.id&&{chainId:t.id}}),C(!1)}catch(c){console.error("Top-up failed",c),alert(m)}};ee.useEffect(()=>{M&&P()},[M,P]);const g=c=>{const d=parseFloat(Z(c));return d===0?"0":d>=1?d.toFixed(3):d>=.1?d.toFixed(4):d>=.001?d.toFixed(5):d.toFixed(6)};return a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:He,children:[e.jsxs("span",{className:Ie,children:[S?g(S):"0"," ETH"]}),e.jsx("button",{onClick:()=>C(!0),disabled:j,className:qe,children:h})]}),D&&e.jsx("div",{className:Oe,onClick:()=>C(!1),children:e.jsxs("div",{className:Ve,onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{className:Ke,children:u}),e.jsx("div",{className:W,children:e.jsxs("div",{className:Y,children:[b," ",S?g(S):"0"," ETH"]})}),e.jsxs("div",{className:W,children:[e.jsx("div",{className:Q,children:i}),e.jsx("div",{className:Ge,children:["0.001","0.005","0.01"].map(c=>e.jsxs("button",{onClick:()=>{$(c),U("")},className:`${Je} ${T===c&&!x?Ye:""}`,children:[c," ETH"]},c))})]}),e.jsxs("div",{className:W,children:[e.jsx("div",{className:Q,children:v}),e.jsx("input",{type:"text",value:x,onChange:c=>U(c.target.value),placeholder:"0.0",className:Qe}),e.jsx("div",{className:Y,children:p})]}),e.jsxs("div",{className:Xe,children:[e.jsx("button",{onClick:()=>C(!1),className:Ze,children:y}),e.jsx("button",{onClick:f,disabled:j||!x&&!T,className:et,children:F})]})]})})]}):null}function St(){const[a,o]=l.useState([]),[t,r]=l.useState(""),[m,h]=l.useState(!1),[u,b]=l.useState(!1),[i,v]=l.useState(null),[p,y]=l.useState(!1),k=s({label:"assistent.systemPrompt"}),B=s({label:"assistent.noResponse"}),S=s({label:"assistent.errorPrefix"}),P=s({label:"assistent.connectWalletMessage"}),z=s({label:"assistent.loading"}),N=s({label:"assistent.send"}),j=s({label:"assistent.unknownError"}),M=s({label:"assistent.balance"}),D=s({label:"assistent.typing"}),C=s({label:"assistent.actions"}),T=s({label:"assistent.history"}),$=s({label:"assistent.clearChat"}),x=s({label:"assistent.mobileTitle"}),U=s({label:"assistent.emptyState"}),E=s({label:"assistent.you"}),F=s({label:"assistent.assistant"});ee.useEffect(()=>{const n=()=>{h(window.innerWidth<=768)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const{address:f,isConnected:g}=he(),{signMessageAsync:c}=xt(),{connectors:d,connect:te}=fe(),se=()=>{d.length>0&&te({connector:d[0]})},H=l.useMemo(()=>g?u?"loading":t.trim()?"ready":"empty":"connect",[g,u,t]),ae=n=>{switch(n){case"connect":return P;case"loading":return z;case"empty":return N;case"ready":return N;default:return N}},ne=async()=>{if(!f||!g)throw new Error("Wallet not connected");if(i)return i;const n=`Authenticate wallet: ${f}`,w=await c({message:n});return v(w),w},I=async n=>{if(!n.trim()||u)return;b(!0);const w={role:"user",content:n.trim(),timestamp:Date.now()};o(L=>[...L,w]),r("");try{const L=await ne(),_=[{role:"system",content:k},...a.map(A=>({role:A.role,content:A.content})),{role:"user",content:n.trim()}],R=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:f,signature:L,message:`Authenticate wallet: ${f}`},data:{prompt:_}})});if(!R.ok){const A=await R.json();throw new Error(A.error||"Failed to get response")}const ie={role:"assistant",content:(await R.json()).content||B,timestamp:Date.now()};o(A=>[...A,ie])}catch(L){const _={role:"assistant",content:`${S} ${L instanceof Error?L.message:j}`,timestamp:Date.now()};o(O=>[...O,_])}finally{b(!1)}},q=()=>{o([]),v(null)},oe=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),g&&I(t))},re=()=>{if(!g){se();return}I(t)};return e.jsxs("div",{className:ge,children:[e.jsxs("div",{className:`${be} ${m?ye:xe}`,children:[!m&&e.jsxs("div",{className:ve,children:[e.jsxs("div",{className:V,children:[e.jsx("h4",{className:K,children:M}),e.jsx(X,{address:f})]}),e.jsxs("div",{className:V,children:[e.jsx("h4",{className:K,children:C}),e.jsxs("div",{className:Se,children:[e.jsx("button",{onClick:()=>y(!0),className:G,title:"View request history",children:T}),e.jsx("button",{onClick:q,className:`${G} ${je}`,children:$})]})]})]}),e.jsxs("div",{className:Ce,children:[m&&e.jsxs("div",{className:Te,children:[e.jsx("h2",{className:we,children:x}),e.jsxs("div",{className:Le,children:[e.jsx(X,{address:f}),e.jsx("button",{onClick:()=>y(!0),className:J,title:"History",children:"ðŸ“œ"}),e.jsx("button",{onClick:q,className:J,title:"Clear Chat",children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:Ae,children:[a.length===0?e.jsx("div",{className:Ne,children:U}):a.map((n,w)=>e.jsx("div",{className:`${Ee} ${n.role==="user"?ke:Be}`,children:e.jsxs("div",{className:`${Pe} ${n.role==="user"?Me:Ue}`,children:[e.jsx("div",{className:ze,children:n.role==="user"?E:F}),e.jsx("div",{className:De,children:n.content})]})},w)),u&&e.jsx("div",{className:$e,children:e.jsx("div",{className:Fe,children:D})})]}),e.jsxs("div",{className:_e,children:[e.jsx("textarea",{value:t,onChange:n=>r(n.target.value),onKeyPress:oe,placeholder:s({label:"assistent.placeholder"}),disabled:u,className:Re}),e.jsxs("button",{onClick:re,disabled:u||(g?!t.trim():!1),className:We,children:[H==="connect"?"ðŸ”— ":"",ae(H)]})]})]})]}),e.jsx(vt,{address:f,isOpen:p,onClose:()=>y(!1)})]})}const jt=Object.freeze(Object.defineProperty({__proto__:null,default:St},Symbol.toStringTag,{value:"Module"})),Bt={serverOnlyHooks:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:it}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:rt}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ot}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:jt}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:nt}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:at}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:st}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:tt}}};export{Bt as configValuesSerialized};
