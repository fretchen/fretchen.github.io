import{a3 as me,l as pe,a4 as he,r as c,j as e,a5 as se,a6 as fe,M as t,a7 as ae,a as ge,a8 as be,a9 as xe,aa as ye,ab as ve,ac as Se,ad as je,ae as R,af as W,ag as Ce,ah as J,ai as Te,aj as we,ak as Le,al as Ae,am as Ne,an as Q,ao as Ee,ap as ke,aq as Pe,ar as Be,as as Me,at as Ue,au as ze,av as De,aw as $e,ax as Fe,ay as _e,az as Ie,aA as Re,aB as We,aC as He,aD as Oe,aE as qe,aF as Ve,aG as Ke,aH as Ge,aI as Je,aJ as H,aK as Y,aL as X,aM as Qe,aN as Ye,aO as Xe,aP as Ze,aQ as et,aR as tt,aS as st,F as at,d as nt,W as ot,e as it,f as rt,g as lt,o as ct}from"../chunks/chunk-ncxinpTc.js";import{g as dt,l as Z,p as ut}from"../chunks/chunk-BjzNZIZh.js";import{s as mt,A as ee}from"../chunks/chunk-DjI0iGln.js";import{g as pt,a as ht,b as ft}from"../chunks/chunk-Csm-6Eeu.js";import{u as gt}from"../chunks/chunk-eAcusFae.js";import"../chunks/chunk-t-pXVLBL.js";/* empty css                      *//* empty css                      */import"../chunks/chunk-Dt3pHpiW.js";import"../chunks/chunk-Dy3zjqfR.js";import"../chunks/chunk-dYGadCQ7.js";async function bt(a,o){const{account:l,connector:i,...h}=o;let d;return typeof l=="object"&&l.type==="local"?d=a.getClient():d=await pt(a,{account:l,connector:i}),me(d,mt,"signMessage")({...h,...l?{account:l}:{}})}function xt(a){return{mutationFn(o){return bt(a,o)},mutationKey:["signMessage"]}}function yt(a={}){const{mutation:o}=a,l=pe(a),i=xt(l),{mutate:h,mutateAsync:d,...f}=he({...o,...i});return{...f,signMessage:h,signMessageAsync:d}}function vt({address:a,isOpen:o,onClose:l}){const[i,h]=c.useState([]),[d,f]=c.useState(!1),p=c.useCallback(async()=>{if(a){f(!0);try{const m=await(await fetch(`https://mypersonaljscloudivnad9dy-leafhistory.functions.fnc.fr-par.scw.cloud?address=${a}`)).json();h(m.leaves||[])}catch(r){console.error("Failed to fetch leaf history:",r)}finally{f(!1)}}},[a]);return c.useEffect(()=>{o&&a&&p()},[o,a,p]),o?e.jsxs("div",{style:{position:"fixed",right:0,top:0,height:"100vh",width:"300px",backgroundColor:"white",borderLeft:"1px solid #ddd",padding:"1rem",overflowY:"auto",zIndex:1e3},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ðŸ“Š Request History"}),e.jsx("button",{onClick:l,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer"},children:"âœ•"})]}),d?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#666"},children:["Total: ",i.length," requests"]}),i.length===0?e.jsx("div",{style:{textAlign:"center",color:"#999",marginTop:"2rem"},children:"No requests found"}):i.slice(0,10).map(r=>{const m=(y=>y?{backgroundColor:"#e8f5e8",borderColor:"#4caf50",borderLeftColor:"#4caf50",borderLeftWidth:"4px",icon:"âœ“",text:"Validated",textColor:"#2e7d32"}:{backgroundColor:"#fff3e0",borderColor:"#ff9800",borderLeftColor:"#ff9800",borderLeftWidth:"4px",icon:"â³",text:"Unprocessed",textColor:"#ef6c00"})(r.processed);return e.jsxs("div",{style:{padding:"0.75rem",marginBottom:"0.5rem",border:`1px solid ${m.borderColor}`,borderLeft:`${m.borderLeftWidth} solid ${m.borderLeftColor}`,borderRadius:"4px",fontSize:"0.8rem",backgroundColor:m.backgroundColor},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.25rem"},children:[e.jsxs("span",{style:{color:m.textColor,fontWeight:"bold"},children:[m.icon," ",m.text]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"#666",marginLeft:"auto"},children:[new Date(r.timestamp).toLocaleDateString()," ",new Date(r.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Tokens: ",r.tokenCount]}),e.jsxs("div",{style:{marginBottom:"0.25rem",color:"#333"},children:["Cost: ",se(BigInt(r.cost))," ETH"]}),e.jsxs("div",{style:{fontSize:"0.7rem",color:"#666"},children:["Tree ",r.treeIndex,", Leaf ",r.id]})]},`${r.treeIndex}-${r.id}`)}),i.length>10&&e.jsxs("div",{style:{textAlign:"center",marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:["Showing first 10 of ",i.length," requests"]})]})]}):null}function te({address:a}){const o=dt(),l=t({label:"assistent.invalidAmount"}),i=t({label:"assistent.invalidAmountFormat"}),h=t({label:"assistent.topUp"}),d=t({label:"assistent.topUpBalance"}),f=t({label:"assistent.currentBalance"}),p=t({label:"assistent.quickAmounts"}),r=t({label:"assistent.customAmount"}),x=t({label:"assistent.amountHint"}),m=t({label:"assistent.cancel"}),y=t({label:"assistent.processing"}),v=t({label:"assistent.topUpAmount"}),{data:S,refetch:k}=gt({...Z,functionName:"checkBalance",args:a?[a]:void 0,...o?.id&&{chainId:o.id}}),{writeContract:M,data:U}=ht(),{isLoading:j,isSuccess:C}=ft({hash:U}),[z,T]=c.useState(!1),[w,D]=c.useState("0.01"),[g,P]=c.useState(""),E=c.useMemo(()=>g.trim()||w,[g,w]),$=c.useMemo(()=>j?y:v.replace("{amount}",E),[j,y,v,E]),F=async()=>{if(a)try{const n=ut(E);if(!n||n<=0n){alert(l);return}M({...Z,functionName:"depositForLLM",value:n,...o?.id&&{chainId:o.id}}),T(!1)}catch(u){console.error("Top-up failed",u),alert(i)}};ae.useEffect(()=>{C&&k()},[C,k]);const B=u=>{const n=parseFloat(se(u));return n===0?"0":n>=1?n.toFixed(3):n>=.1?n.toFixed(4):n>=.001?n.toFixed(5):n.toFixed(6)};return a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:Oe,children:[e.jsxs("span",{className:qe,children:[S?B(S):"0"," ETH"]}),e.jsx("button",{onClick:()=>T(!0),disabled:j,className:Ve,children:h})]}),z&&e.jsx("div",{className:Ke,onClick:()=>T(!1),children:e.jsxs("div",{className:Ge,onClick:u=>u.stopPropagation(),children:[e.jsx("h3",{className:Je,children:d}),e.jsx("div",{className:H,children:e.jsxs("div",{className:Y,children:[f," ",S?B(S):"0"," ETH"]})}),e.jsxs("div",{className:H,children:[e.jsx("div",{className:X,children:p}),e.jsx("div",{className:Qe,children:["0.001","0.005","0.01"].map(u=>e.jsxs("button",{onClick:()=>{D(u),P("")},className:`${Ye} ${w===u&&!g?Xe:""}`,children:[u," ETH"]},u))})]}),e.jsxs("div",{className:H,children:[e.jsx("div",{className:X,children:r}),e.jsx("input",{type:"text",value:g,onChange:u=>P(u.target.value),placeholder:"0.0",className:Ze}),e.jsx("div",{className:Y,children:x})]}),e.jsxs("div",{className:et,children:[e.jsx("button",{onClick:()=>T(!1),className:tt,children:m}),e.jsx("button",{onClick:F,disabled:j||!g&&!w,className:st,children:$})]})]})})]}):null}function St(){const{trackEvent:a}=fe(),[o,l]=c.useState([]),[i,h]=c.useState(""),[d,f]=c.useState(!1),[p,r]=c.useState(!1),[x,m]=c.useState(null),[y,v]=c.useState(!1),S=t({label:"assistent.systemPrompt"}),k=t({label:"assistent.noResponse"}),M=t({label:"assistent.errorPrefix"}),U=t({label:"assistent.connectWalletMessage"}),j=t({label:"assistent.loading"}),C=t({label:"assistent.send"}),z=t({label:"assistent.unknownError"}),T=t({label:"assistent.balance"}),w=t({label:"assistent.typing"}),D=t({label:"assistent.actions"}),g=t({label:"assistent.history"}),P=t({label:"assistent.clearChat"}),E=t({label:"assistent.mobileTitle"}),$=t({label:"assistent.emptyState"}),F=t({label:"assistent.you"}),B=t({label:"assistent.assistant"}),u=t({label:"assistent.placeholder"});ae.useEffect(()=>{const s=()=>{f(window.innerWidth<=768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const{address:n,isConnected:b}=ge(),{signMessageAsync:ne}=yt(),{connectors:O,connect:oe}=be(),ie=()=>{O.length>0&&oe({connector:O[0]})},q=c.useMemo(()=>b?p?"loading":i.trim()?"ready":"empty":"connect",[b,p,i]),re=s=>{switch(s){case"connect":return U;case"loading":return j;case"empty":return C;case"ready":return C;default:return C}},le=async()=>{if(!n||!b)throw new Error("Wallet not connected");if(x)return x;const s=`Authenticate wallet: ${n}`,L=await ne({message:s});return m(L),L},V=async s=>{if(!s.trim()||p)return;r(!0),o.length===0&&a("assistant-first-message-sent",{messageLength:s.trim().length,isMobile:d});const L={role:"user",content:s.trim(),timestamp:Date.now()};l(A=>[...A,L]),h("");try{const A=await le(),_=[{role:"system",content:S},...o.map(N=>({role:N.role,content:N.content})),{role:"user",content:s.trim()}],I=await fetch("https://mypersonaljscloudivnad9dy-llm.functions.fnc.fr-par.scw.cloud",{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({auth:{address:n,signature:A,message:`Authenticate wallet: ${n}`},data:{prompt:_}})});if(!I.ok){const N=await I.json();throw new Error(N.error||"Failed to get response")}const ue={role:"assistant",content:(await I.json()).content||k,timestamp:Date.now()};l(N=>[...N,ue])}catch(A){const _={role:"assistant",content:`${M} ${A instanceof Error?A.message:z}`,timestamp:Date.now()};l(G=>[...G,_])}finally{r(!1)}},K=()=>{l([]),m(null)},ce=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),b&&V(i))},de=()=>{if(!b){a("assistant-connect-button-click",{hasInput:i.trim().length>0}),ie();return}V(i)};return e.jsxs("div",{className:xe,children:[e.jsxs("div",{className:`${ye} ${d?ve:Se}`,children:[!d&&e.jsxs("div",{className:je,children:[e.jsxs("div",{className:R,children:[e.jsx("h4",{className:W,children:T}),e.jsx(te,{address:n})]}),e.jsxs("div",{className:R,children:[e.jsx("h4",{className:W,children:D}),e.jsxs("div",{className:Ce,children:[e.jsx("button",{onClick:()=>v(!0),className:J,title:"View request history",children:g}),e.jsx("button",{onClick:K,className:`${J} ${Te}`,children:P})]})]}),e.jsxs("div",{className:R,children:[e.jsx("h4",{className:W,children:"Agent"}),e.jsx(ee,{service:"llm",variant:"sidebar"})]})]}),e.jsxs("div",{className:we,children:[d&&e.jsxs("div",{className:Le,children:[e.jsx("h2",{className:Ae,children:E}),e.jsxs("div",{className:Ne,children:[e.jsx(te,{address:n}),e.jsx("button",{onClick:()=>v(!0),className:Q,title:"History",children:"ðŸ“œ"}),e.jsx("button",{onClick:K,className:Q,title:"Clear Chat",children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:Ee,children:[o.length===0?e.jsx("div",{className:ke,children:$}):o.map((s,L)=>e.jsx("div",{className:`${Pe} ${s.role==="user"?Be:Me}`,children:e.jsxs("div",{className:`${Ue} ${s.role==="user"?ze:De}`,children:[e.jsx("div",{className:$e,children:s.role==="user"?F:B}),e.jsx("div",{className:Fe,children:s.content})]})},L)),p&&e.jsx("div",{className:_e,children:e.jsx("div",{className:Ie,children:w})})]}),e.jsxs("div",{className:Re,children:[e.jsx("textarea",{value:i,onChange:s=>h(s.target.value),onKeyPress:ce,placeholder:u,disabled:p,className:We}),e.jsxs("button",{onClick:de,onMouseEnter:()=>{b||a("assistant-connect-button-hover")},disabled:p||(b?!i.trim():!1),className:He,children:[q==="connect"?"ðŸ”— ":"",re(q)]})]}),d&&e.jsx(ee,{service:"llm",variant:"sidebar"})]})]}),e.jsx(vt,{address:n,isOpen:y,onClose:()=>v(!1)})]})}const jt=Object.freeze(Object.defineProperty({__proto__:null,default:St},Symbol.toStringTag,{value:"Module"}));function Ct(){return"AI Assistant with ETH Payments | fretchen.eu"}const Tt=Object.freeze(Object.defineProperty({__proto__:null,title:Ct},Symbol.toStringTag,{value:"Module"})),$t={hasServerOnlyHook:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ct}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:lt}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:rt}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:jt}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:it}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/assistent/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Tt}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:ot}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:nt}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:at}}};export{$t as configValuesSerialized};
