import{r as p,e as M,j as e,f as h,s as H,g as z,n as L,h as R,k as a,c as W,l as V,F as Y,i as Z,W as J,L as K,a as Q,b as X,o as ee}from"../chunks/chunk-BUHGb1y9.js";import{u as _,g as O,a as B,b as G,r as A,c as te}from"../chunks/chunk-BERE7Z_k.js";/* empty css                      */import"../chunks/chunk-DQ3hQvvF.js";/* empty css                      *//* empty css                      */const ae=async t=>new Promise((l,n)=>{const o=async()=>{try{const u=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});u?l(u):setTimeout(o,2e3)}catch(u){n(u)}};o()});function ne({apiUrl:t="https://mypersonaljscloudivnad9dy-readnftv2.functions.fnc.fr-par.scw.cloud",onSuccess:l,onError:n}){const o=B(),[u,c]=p.useState(),[m,T]=p.useState(),[N,C]=p.useState(""),[k,b]=p.useState(!1),[S,w]=p.useState("idle"),[y,v]=p.useState(null),{address:f,isConnected:d}=M(),g=O(),{data:r}=_({...o,functionName:"mintPrice",args:[],...(g==null?void 0:g.id)&&{chainId:g.id}}),{writeContractAsync:i}=G(),I=async()=>{if(!d||!f){const s="Please connect your wallet first";v(s),n==null||n(s);return}if(!N.trim()){const s="Please enter a prompt";v(s),n==null||n(s);return}if(!r){const s="Could not load mint price from contract";v(s),n==null||n(s);return}b(!0),v(null),w("minting");try{const s=`ipfs://tempURI/${Date.now()}`,U=await i({...o,functionName:"safeMint",args:[s],value:r,...(g==null?void 0:g.id)&&{chainId:g.id}});console.log("Minting transaction sent:",U);const x=await ae(U),j=x==null?void 0:x.logs.find(q=>q.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!j||j.topics.length<4)throw new Error("Could not extract token ID from transaction");const E=j.topics[3],P=BigInt(E);console.log("Minted token ID:",P),T(P),w("generating");const $=await fetch(`${t}?prompt=${encodeURIComponent(N)}&tokenId=${P}`);if(!$.ok)throw new Error(`Error: ${$.status} ${$.statusText}`);const D=await $.json();console.log("Image generation completed",D);const F=D.image_url;c(F),w("idle"),l==null||l(P,F),setTimeout(()=>{C(""),c(void 0),T(void 0),v(null)},3e3)}catch(s){console.error("Error:",s);const U=s instanceof Error?s.message:"An unknown error occurred";v(U),w("error"),n==null||n(U)}finally{b(!1)}};return e.jsx("div",{className:h.compactLayout,children:e.jsxs("div",{className:h.compactContainer,children:[e.jsxs("div",{className:h.compactHeader,children:[e.jsx("h3",{className:h.compactTitle,children:"Create NFT"}),e.jsx("span",{className:h.compactSubtitle,children:"Enter prompt and generate your unique image (~10Â¢ in ETH)"})]}),e.jsxs("div",{className:h.compactForm,children:[e.jsx("textarea",{value:N,onChange:s=>C(s.target.value),placeholder:"Describe your image in detail... (e.g., 'A futuristic city skyline at sunset')",disabled:k||S!=="idle",className:h.compactTextarea}),e.jsx("button",{onClick:I,disabled:k||!N.trim()||!d,className:`${h.compactButton} ${k||!N.trim()||!d?h.compactButtonDisabled:""}`,children:k?S==="minting"?"Creating...":"Generating...":"ðŸŽ¨ Create NFT"})]}),S!=="idle"&&e.jsxs("div",{className:h.compactStatus,children:[e.jsx("div",{className:h.spinner}),e.jsx("span",{children:S==="minting"?"Creating your NFT...":"Generating image..."})]}),!d&&e.jsx("div",{className:h.compactError,children:"Connect your wallet to create an NFT"}),y&&e.jsx("div",{className:h.compactError,children:y}),m&&u&&e.jsxs("div",{className:H,children:[e.jsx("h4",{className:z({margin:0,fontSize:"sm"}),children:"âœ… NFT created successfully!"}),e.jsxs("p",{className:z({margin:"xs 0",fontSize:"sm"}),children:["Token ID: ",m.toString()," - Check your gallery below"]})]})]})})}function oe({newlyCreatedNFT:t,onNewNFTDisplayed:l}={}){const{address:n,isConnected:o}=M(),u=O(),c=B(),[m,T]=p.useState([]),[N,C]=p.useState(!1),[k,b]=p.useState(null),[S,w]=p.useState(null),{data:y,isLoading:v}=_({...c,functionName:"balanceOf",args:n?[n]:void 0,chainId:u.id,query:{enabled:!!n&&o}}),f=async r=>{try{if(r.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",r),null;const i=await fetch(r);if(!i.ok)throw new Error(`Failed to fetch metadata: ${i.status}`);return await i.json()}catch(i){return console.error("Error fetching NFT metadata:",i),null}},d=async()=>{if(!o||!n){T([]);return}C(!0);try{const r=await A(R,{...c,functionName:"balanceOf",args:[n]});if(!r||r===0n){T([]);return}const i=Array.from({length:Number(r)},()=>({tokenId:0n,tokenURI:"",isLoading:!0}));T(i);const I=[];for(let x=0;x<Number(r);x++){const j=(async()=>{try{const P=await A(R,{...c,functionName:"tokenOfOwnerByIndex",args:[n,BigInt(x)]}),D=await A(R,{...c,functionName:"tokenURI",args:[P]}),F=await f(D);return{tokenId:P,tokenURI:D,metadata:F||void 0,imageUrl:F==null?void 0:F.image,isLoading:!1}}catch(E){return console.error(`Error loading NFT at index ${x}:`,E),{tokenId:0n,tokenURI:"",isLoading:!1,error:`Failed to load NFT #${x}: ${E instanceof Error?E.message:"Unknown error"}`}}})();I.push(j)}const U=(await Promise.all(I)).sort((x,j)=>x.error&&!j.error?1:!x.error&&j.error?-1:x.error&&j.error?0:Number(j.tokenId-x.tokenId));T(U)}catch(r){console.error("Error loading NFTs:",r),T([])}finally{C(!1)}};if(p.useEffect(()=>{o&&n&&d()},[n,o,y]),p.useEffect(()=>{if(t){b(t.tokenId);const r={tokenId:t.tokenId,tokenURI:"",imageUrl:t.imageUrl,isLoading:!1};T(i=>{const I=i.findIndex(s=>s.tokenId===t.tokenId);if(I!==-1){const s=[...i];return s[I]={...s[I],imageUrl:t.imageUrl},s}else return[r,...i]}),setTimeout(()=>{b(null),l==null||l()},5e3)}},[t,l]),!o)return e.jsx("div",{className:L.walletPrompt,children:e.jsx("p",{children:"Connect your wallet to view your NFTs"})});const g=v||N;return e.jsxs("div",{className:L.container,children:[e.jsx("div",{className:L.heading,children:e.jsxs("h2",{className:h.columnHeading,children:["Your Generated NFTs (",(y==null?void 0:y.toString())||"0",")"]})}),g&&m.length===0?e.jsxs("div",{className:L.loadingContainer,children:[e.jsx("div",{className:h.spinner}),e.jsx("p",{children:"Loading your NFTs..."})]}):y===0n||!y?e.jsx("div",{className:L.emptyStateContainer,children:e.jsx("p",{className:L.emptyStateText,children:"You haven't created any NFTs yet. Use the generator above to create your first one!"})}):e.jsx("div",{className:L.grid,children:m.map((r,i)=>e.jsx(se,{nft:r,onImageClick:w,onNftBurned:()=>d(),isHighlighted:k===r.tokenId},`${r.tokenId}-${i}`))}),S&&e.jsx(re,{image:S,onClose:()=>w(null)})]})}function se({nft:t,onImageClick:l,onNftBurned:n,isHighlighted:o=!1}){var w,y,v;const{writeContract:u,isPending:c,data:m}=G(),T=B(),{isLoading:N,isSuccess:C}=te({hash:m});p.useEffect(()=>{C&&setTimeout(()=>{n()},1e3)},[C,n]);const k=()=>{var f,d,g;t.imageUrl&&l({src:t.imageUrl,alt:((f=t.metadata)==null?void 0:f.name)||`NFT #${t.tokenId}`,title:(d=t.metadata)==null?void 0:d.name,description:(g=t.metadata)==null?void 0:g.description})},b=async()=>{var f;if(t.imageUrl)try{const g=await(await fetch(t.imageUrl)).blob(),r=window.URL.createObjectURL(g),i=document.createElement("a");i.href=r,i.download=`${((f=t.metadata)==null?void 0:f.name)||`NFT-${t.tokenId}`}.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}catch(d){console.error("Download failed:",d),alert("Download failed. Please try again.")}},S=async()=>{var f;if(confirm(`Are you sure you want to burn NFT "${((f=t.metadata)==null?void 0:f.name)||`#${t.tokenId}`}"? This action cannot be undone.`))try{await u({...T,functionName:"burn",args:[t.tokenId]})}catch(d){console.error("Burn failed:",d),alert("Failed to burn NFT. Please try again.")}};return e.jsx("div",{className:`${a.container} ${o?a.highlighted:""}`,children:t.isLoading?e.jsxs("div",{className:a.loadingContainer,children:[e.jsx("div",{className:h.spinner}),e.jsx("p",{className:a.loadingText,children:"Loading NFT..."})]}):t.error?e.jsxs("div",{className:a.errorContainer,children:[e.jsx("div",{className:a.errorBox,children:e.jsx("p",{className:a.errorText,children:t.error})}),e.jsxs("p",{className:a.tokenIdText,children:["Token ID: ",t.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[t.imageUrl?e.jsxs("div",{className:a.imageContainer,children:[e.jsx("img",{src:t.imageUrl,alt:((w=t.metadata)==null?void 0:w.name)||`NFT #${t.tokenId}`,className:a.image,onClick:k,style:{cursor:"pointer"},onError:f=>{const d=f.target;d.style.display="none",d.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:a.imageError,style:{display:"none"},children:"Image not available"})]}):e.jsx("div",{className:a.imagePlaceholder,children:"No image available"}),e.jsx("h3",{className:a.title,children:((y=t.metadata)==null?void 0:y.name)||`NFT #${t.tokenId}`}),((v=t.metadata)==null?void 0:v.description)&&e.jsx("p",{className:a.description,children:t.metadata.description}),e.jsx("div",{className:a.footer,children:e.jsxs("span",{children:["Token ID: ",t.tokenId.toString()]})}),e.jsxs("div",{className:a.actions,children:[t.imageUrl&&e.jsx("button",{onClick:k,className:`${a.actionButton} ${a.zoomButton}`,title:"View full size",children:"ðŸ” Zoom"}),t.imageUrl&&e.jsx("button",{onClick:b,className:`${a.actionButton} ${a.downloadButton}`,title:"Download image",children:"â¬‡ï¸ Download"}),e.jsx("button",{onClick:S,disabled:c||N,className:`${a.actionButton} ${c||N?a.disabledButton:a.burnButton}`,title:"Burn NFT (permanent)",children:c?"ðŸ”¥ Burning...":N?"â³ Confirming...":"ðŸ”¥ Burn"})]})]})})}function re({image:t,onClose:l}){p.useEffect(()=>{const o=u=>{u.key==="Escape"&&l()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[l]);const n=async()=>{try{const u=await(await fetch(t.src)).blob(),c=window.URL.createObjectURL(u),m=document.createElement("a");m.href=c,m.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(c)}catch(o){console.error("Download failed:",o),alert("Download failed. Please try again.")}};return e.jsx("div",{className:a.modalOverlay,onClick:l,children:e.jsxs("div",{className:a.modalContent,onClick:o=>o.stopPropagation(),children:[e.jsx("button",{className:a.modalClose,onClick:l,children:"âœ•"}),e.jsx("img",{src:t.src,alt:t.alt,className:a.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:a.modalInfo,children:[t.title&&e.jsx("h3",{className:a.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:a.modalDescription,children:t.description}),e.jsx("div",{className:a.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:n,className:`${a.actionButton} ${a.downloadButton}`,children:"â¬‡ï¸ Download Full Size"})})]})]})})}function ie(){const[t,l]=p.useState(null),n=(c,m)=>{console.log("Image generation succeeded:",{tokenId:c,imageUrl:m}),l({tokenId:c,imageUrl:m})},o=c=>{console.error("Image generation failed:",c)},u=()=>{l(null)};return e.jsxs("div",{className:W,children:[e.jsx("h1",{className:V,children:"Decentral AI Image Generator"}),e.jsx(ne,{onSuccess:n,onError:o}),e.jsx(oe,{newlyCreatedNFT:t??void 0,onNewNFTDisplayed:u})]})}const le=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),pe={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ee}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:X}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Q}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:le}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:K}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:J}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Z}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Y}}};export{pe as configValuesSerialized};
