import{bh as Bt,bi as Dt,bj as Mt,a2 as Fe,r as m,a3 as Ot,g as h,j as e,u as _t,bk as Ht,bl as Wt,bm as qt,a5 as Gt,a7 as ae,be as Re,a8 as Kt,f as o,aC as le,bn as O,bo as p,bp as te,bq as Yt,br as Jt,bs as G,a4 as Pe,bt as be,bu as W,x as Qt,F as Vt,a as Xt,W as Zt,c as ea,d as ta,e as aa,o as na}from"../chunks/chunk-D99inmG0.js";import{a as me,g as I,e as Le}from"../chunks/chunk-B36DBCoT.js";import{d as sa}from"../chunks/chunk-t-pXVLBL.js";import{A as ra}from"../chunks/chunk-CMJLewve.js";import{u as ge,a as de,b as ye,r as we}from"../chunks/chunk-BtZP5Ako.js";import{u as ze}from"../chunks/chunk-lTcwQqdM.js";import{u as Be}from"../chunks/chunk-DXjny6GT.js";/* empty css                      *//* empty css                      */import"../chunks/chunk-aln4m1Dg.js";import"../chunks/chunk-5weYrBCZ.js";let xe=[];function Ee(t){const a=t.chains;return Bt(xe,a)?xe:(xe=a,a)}async function oa(t,a){const{addEthereumChainParameter:n,chainId:r}=a,d=t.state.connections.get(a.connector?.uid??t.state.current);if(d){const i=d.connector;if(!i.switchChain)throw new Dt({connector:i});return await i.switchChain({addEthereumChainParameter:n,chainId:r})}const l=t.chains.find(i=>i.id===r);if(!l)throw new Mt;return t.setState(i=>({...i,chainId:r})),l}function ia(t,a){const{onChange:n}=a;return t._internal.chains.subscribe((r,d)=>{n(r,d)})}function ca(t){return{mutationFn(a){return oa(t,a)},mutationKey:["switchChain"]}}function la(t={}){const a=Fe(t);return m.useSyncExternalStore(n=>ia(a,{onChange:n}),()=>Ee(a),()=>Ee(a))}function da(t={}){const{mutation:a}=t,n=Fe(t),r=ca(n),{mutate:d,mutateAsync:l,...i}=Ot({...a,...r});return{...i,chains:la({config:n}),switchChain:d,switchChainAsync:l}}function Ae({size:t="sm",className:a}){const n={xs:h({fontSize:"xs",lineHeight:"1"}),sm:h({fontSize:"sm",lineHeight:"1"}),md:h({fontSize:"md",lineHeight:"1"})},r=h({display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1em",height:"1em",borderRadius:"50%",backgroundColor:"blue.100",color:"blue.600",fontWeight:"bold",cursor:"help"});return e.jsx("span",{className:`${r} ${n[t]} ${a||""}`,role:"img","aria-label":"Information",children:"i"})}function $e({label:t,locale:a}){const r=_t(),d=a??r.locale??sa,i=Ht(d==="de"?Wt:qt,t);return e.jsx("span",{"data-locale":d,children:i})}const ma="https://mypersonaljscloudivnad9dy-genimgbfl.functions.fnc.fr-par.scw.cloud",ga=(t,a,n=1920)=>{const r=t/a;return t<=n&&a<=n?{width:t,height:a}:t>a?{width:n,height:Math.round(n/r)}:{width:Math.round(n*r),height:n}},ua=(t,a=1024)=>new Promise((n,r)=>{const d=document.createElement("canvas"),l=d.getContext("2d"),i=new Image;i.onload=()=>{const{width:y,height:u}=ga(i.width,i.height);if(d.width=y,d.height=u,!l){r(new Error("Could not get canvas context"));return}l.fillStyle="white",l.fillRect(0,0,y,u),l.drawImage(i,0,0,y,u);let f=.9;const v=()=>{const x=d.toDataURL("image/jpeg",f);x.length*.75/1024<=a||f<=.1?n({base64:x.split(",")[1],mimeType:"image/jpeg"}):(f-=.1,setTimeout(v,0))};v()},i.onerror=()=>r(new Error("Failed to load image")),i.src=URL.createObjectURL(t)}),ha=async t=>new Promise((a,n)=>{const r=async()=>{try{const d=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});d?a(d):setTimeout(r,2e3)}catch(d){n(d)}};r()});function pa({apiUrl:t=ma,onSuccess:a,onError:n}){const{trackEvent:r}=Gt(),[d,l]=m.useState(),[i,y]=m.useState(),[u,f]=m.useState(),[v,x]=m.useState(null),[L,E]=m.useState("image/jpeg"),{address:_,isConnected:U}=ae(),[s,A]=m.useState("empty"),[C,T]=m.useState(""),[w,R]=m.useState("1024x1024"),[B,S]=m.useState(!1),[P,z]=m.useState(!1),[D,M]=m.useState("idle"),[K,k]=m.useState(null),q=me(),J=Re(),{switchChain:ue,isPending:Y}=da(),{connectors:ne,connect:he}=Kt(),{data:b}=ge({...I,functionName:"mintPrice",args:[],...q?.id&&{chainId:q.id}}),{writeContractAsync:j}=de(),$=async c=>new Promise((g,N)=>{const X=()=>{J===c?g():setTimeout(X,100)};setTimeout(()=>{N(new Error(Ye))},1e4),X()}),H=()=>{ne.length>0&&he({connector:ne[0]})},Q=o({label:"imagegen.connectWalletButton"}),se=o({label:"imagegen.enterPrompt"}),re=o({label:"imagegen.switchingNetwork"}),F=o({label:"imagegen.creating"}),Oe=o({label:"imagegen.generating"}),Te=o({label:"imagegen.createArtwork"}),_e=o({label:"imagegen.promptPlaceholder"}),He=o({label:"imagegen.editPromptPlaceholder"}),ve=o({label:"imagegen.editImage"}),We=o({label:"imagegen.connectAccountFirst"}),qe=o({label:"imagegen.switchToOptimism"}),Ge=o({label:"imagegen.enterPromptError"}),Ke=o({label:"imagegen.loadMintPrice"}),Ye=o({label:"imagegen.chainSwitchTimeout"}),Je=o({label:"imagegen.extractTokenId"}),Qe=o({label:"imagegen.unknownError"}),Ve=o({label:"imagegen.uploadReferenceImage"}),Xe=o({label:"imagegen.dragDropHere"}),Ze=o({label:"imagegen.supportedFormats"}),et=o({label:"imagegen.referenceImageTitle"}),tt=o({label:"imagegen.generatedArtworkTitle"}),je=o({label:"imagegen.remove"}),at=o({label:"imagegen.referenceImageAlt"}),nt=o({label:"imagegen.generatedArtworkAlt"}),st=o({label:"imagegen.referenceImageHint"}),rt=o({label:"imagegen.invalidFileType"}),ot=o({label:"imagegen.fileTooLarge"}),it=o({label:"imagegen.compressionFailed"}),ct=o({label:"imagegen.failedToProcessImage"}),lt=o({label:"imagegen.creatingArtwork"}),dt=o({label:"imagegen.generatingImage"}),mt=o({label:"imagegen.title"}),gt=o({label:"imagegen.collapsedTitle"}),ut=o({label:"imagegen.collapsedDescription"}),ht=o({label:"imagegen.square"}),pt=o({label:"imagegen.wide"}),ft=o({label:"imagegen.mintingInfo"}),xt=o({label:"imagegen.artworkCreated"}),bt=o({label:"imagegen.checkGallery"}),yt=o({label:"imagegen.switchingToOptimism"}),wt=()=>Y?"switching":P?"loading":C.trim()?"ready":"needsPrompt",ke=c=>{switch(c){case"switching":return re;case"loading":return D==="minting"?F:Oe;case"connect":return Q;case"needsPrompt":return se;case"ready":return s!=="empty"?ve:Te;default:return s!=="empty"?ve:Te}},V=wt(),Tt=()=>{const c=V==="needsPrompt",g=V==="loading"||V==="switching",N=()=>{r("imagegen-create-artwork-click",{hasReferenceImage:s!=="empty",promptLength:C.trim().length,isConnected:U,imageSize:w}),vt()};return e.jsx("button",{onClick:N,disabled:c,className:`${le} ${c?Jt:""}`,title:o({label:"imagegen.mintingInfo"}),"aria-describedby":"create-artwork-info",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:te}),ke(V)]}):e.jsxs(e.Fragment,{children:["ðŸŽ¨ ",ke(V),e.jsx(Ae,{size:"xs",className:h({ml:"1",opacity:"0.7"})})]})})},vt=async()=>{if(!U||!_){const g=We;k(g),n?.(g);return}const c=q?.id;if(c&&J!==c)try{k(yt),await ue({chainId:c}),await $(c),k(null)}catch(g){console.error("Failed to switch chain:",g);const N=g instanceof Error?g.message:qe;k(N),n?.(N);return}if(!C.trim()){const g=Ge;k(g),n?.(g);return}if(!b){const g=Ke;k(g),n?.(g);return}z(!0),k(null),M("minting");try{const N=await j({...I,functionName:"safeMint",args:["",B],value:b,...q?.id&&{chainId:q.id}});console.log("Minting transaction sent:",N);const pe=(await ha(N))?.logs.find(ie=>ie.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!pe||pe.topics.length<4)throw new Error(Je);const Et=pe.topics[3],Z=BigInt(Et);console.log("Created artwork ID:",Z),y(Z),M("generating");const Ne=v!==null,At=Ne?"edit":"generate",Ie={prompt:C,tokenId:Z.toString(),size:w,mode:At};Ne&&v&&(Ie.referenceImage=v);const oe=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ie)});if(!oe.ok)throw new Error(`Error: ${oe.status} ${oe.statusText}`);const fe=await oe.json();console.log("Image generation completed",fe);const ee=fe.image_url;l(ee),f(ee),A("generated"),M("idle");try{const Ut=await(await fetch(ee)).blob(),Ft=(await new Promise((Rt,zt)=>{const ce=new FileReader;ce.onload=()=>Rt(ce.result),ce.onerror=zt,ce.readAsDataURL(Ut)})).split(",")[1];x(Ft)}catch(ie){console.warn("Failed to convert generated image to base64:",ie)}const $t={name:`AI Generated Artwork #${Z}`,description:`AI generated artwork based on the prompt: "${C}"`,image:ee,external_url:fe.metadata_url||"",attributes:[{trait_type:"Prompt",value:C},{trait_type:"Generation Method",value:"AI Generated"}]};a?.(Z,ee,$t),setTimeout(()=>{T(""),R("1024x1024"),l(void 0),y(void 0),k(null)},3e3)}catch(g){console.error("Error:",g);const N=g instanceof Error?g.message:Qe;k(N),M("error"),n?.(N)}finally{z(!1)}},jt=o({label:"imagegen.mintingInfo"}),kt=c=>["image/jpeg","image/png"].includes(c.type)?c.size>10485760?(k(ot),!1):!0:(k(rt),!1),Ce=async c=>{if(kt(c)){k(null),z(!0);try{const g=await ua(c,1024);x(g.base64),E(g.mimeType),A("reference");const N=Math.round(c.size/1024),X=Math.round(g.base64.length*.75/1024);console.log(`Image compressed: ${N}KB â†’ ${X}KB (${c.type} â†’ ${g.mimeType})`)}catch(g){console.error("Image compression failed:",g);const N=g instanceof Error?g.message:ct;k(`${it}: ${N}`)}finally{z(!1)}}},Ct=c=>{c.preventDefault(),c.stopPropagation()},St=c=>{c.preventDefault(),c.stopPropagation()},Nt=c=>{c.preventDefault(),c.stopPropagation();const g=Array.from(c.dataTransfer.files);g.length>0&&Ce(g[0])},It=c=>{const g=c.target.files;g&&g.length>0&&Ce(g[0])},Pt=()=>{x(null),E("image/jpeg");const c=document.getElementById("reference-image-input");c&&(c.value=""),A(u?"generated":"empty")},Se=w==="1792x1024"?"wide":"square",Lt=()=>{r("imagegen-connect-click"),H()};return e.jsx("div",{className:h({transition:"all 0.5s ease-in-out",overflow:"hidden"}),children:U?e.jsx("div",{className:O.compactLayout,children:e.jsxs("div",{className:O.compactContainer,children:[e.jsx("div",{className:O.compactHeader,children:e.jsxs("h3",{className:O.compactTitle,children:["ðŸŽ¨",e.jsx($e,{label:"imagegen.title"})]})}),e.jsxs("div",{className:O.compactForm,children:[e.jsxs("div",{"data-testid":"drop-zone",className:h({mb:"4",border:"1px solid",borderColor:s==="empty"?"gray.300":"gray.400",borderRadius:"md",bg:s==="empty"?"gray.50":"white",position:"relative",cursor:s==="empty"?"pointer":"default",overflow:"hidden",width:"100%",_hover:s==="empty"?{borderColor:"gray.400",bg:"gray.100"}:{}}),onDragOver:Ct,onDragEnter:St,onDrop:Nt,onClick:()=>{s==="empty"&&document.getElementById("reference-image-input")?.click()},children:[e.jsx("input",{id:"reference-image-input","data-testid":"reference-image-input",type:"file",accept:"image/*",onChange:It,className:h({position:"absolute",opacity:0,width:0,height:0,pointerEvents:"none"})}),s==="empty"&&e.jsxs("div",{className:h({display:"flex",alignItems:"center",justifyContent:"center",py:"6",px:"4",gap:"3"}),children:[e.jsx("div",{className:h({fontSize:"xl",color:"gray.500"}),children:"ðŸ“¸"}),e.jsxs("div",{className:h({textAlign:"left"}),children:[e.jsx("h4",{className:h({fontSize:"sm",fontWeight:"medium",color:"gray.700",mb:"1"}),children:Ve}),e.jsxs("p",{className:h({fontSize:"xs",color:"gray.500",mb:"0"}),children:[Xe," â€¢ ",Ze]})]})]}),s==="reference"&&v&&e.jsxs("div",{className:h({p:"3"}),children:[e.jsxs("div",{className:h({display:"flex",justifyContent:"space-between",alignItems:"center",mb:"3"}),children:[e.jsx("h4",{className:h({fontSize:"sm",fontWeight:"medium",color:"gray.700",m:0}),children:et}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),Pt()},className:h({px:"2",py:"1",fontSize:"xs",bg:"gray.600",color:"white",border:"none",borderRadius:"sm",cursor:"pointer",_hover:{bg:"gray.700"}}),children:["âœ• ",je]})]}),e.jsx("div",{className:h({position:"relative",width:"100%",height:Se==="wide"?"250px":"200px",overflow:"hidden",borderRadius:"sm",bg:"gray.100"}),children:e.jsx("img",{src:`data:${L};base64,${v}`,alt:at,className:h({width:"100%",height:"100%",objectFit:"contain",borderRadius:"sm"})})}),e.jsx("p",{className:h({fontSize:"xs",color:"gray.500",textAlign:"center",mt:"2",mb:"0"}),children:st})]}),s==="generated"&&u&&e.jsxs("div",{className:h({p:"3"}),children:[e.jsxs("div",{className:h({display:"flex",justifyContent:"space-between",alignItems:"center",mb:"3"}),children:[e.jsx("h4",{className:h({fontSize:"sm",fontWeight:"medium",color:"gray.700",m:0}),children:tt}),e.jsx("div",{className:h({display:"flex",gap:"2"}),children:e.jsxs("button",{onClick:()=>{x(null),E("image/jpeg"),f(void 0),A("empty");const c=document.getElementById("reference-image-input");c&&(c.value="")},className:h({px:"2",py:"1",fontSize:"xs",bg:"gray.600",color:"white",border:"none",borderRadius:"sm",cursor:"pointer",_hover:{bg:"gray.700"}}),disabled:P||D!=="idle",children:["âœ• ",je]})})]}),e.jsx("div",{className:h({position:"relative",width:"100%",height:Se==="wide"?"250px":"200px",overflow:"hidden",borderRadius:"sm",bg:"gray.100"}),children:e.jsx("img",{src:u,alt:nt,className:h({width:"100%",height:"100%",objectFit:"contain",borderRadius:"sm"})})})]})]}),e.jsx("textarea",{value:C,onChange:c=>T(c.target.value),placeholder:s==="reference"?He:_e,disabled:P||D!=="idle"||Y,className:O.compactTextarea}),e.jsxs("div",{className:O.controlBar,children:[e.jsxs("div",{className:O.optionsGroup,children:[e.jsxs("select",{id:"imageSizeSelect",value:w,onChange:c=>R(c.target.value),disabled:P||D!=="idle"||Y,className:O.compactSelect,"aria-label":"Select image format for your artwork",children:[e.jsx("option",{value:"1024x1024",children:ht}),e.jsx("option",{value:"1792x1024",children:pt})]}),e.jsxs("label",{className:p.checkboxLabel,title:B?"NFT will be publicly visible in the 'All Public Artworks' gallery":"NFT will remain unlisted from the 'All Public Artworks' gallery",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:c=>S(c.target.checked),disabled:P||D!=="idle"||Y,className:p.checkbox}),e.jsx($e,{label:"imagegen.listed"})]})]}),e.jsx(Tt,{})]})]}),e.jsx(ra,{service:"genimg"}),e.jsx("span",{id:"create-artwork-info",className:h({position:"absolute",left:"-9999px",top:"auto",width:"1px",height:"1px",overflow:"hidden"}),children:ft}),e.jsxs("div",{className:h({display:{base:"block",md:"none"},mt:"2",fontSize:"xs",color:"gray.600",textAlign:"center"}),children:[e.jsx(Ae,{size:"xs",className:h({mr:"1"})}),jt]}),D!=="idle"&&e.jsxs("div",{className:O.compactStatus,children:[e.jsx("div",{className:te}),e.jsx("span",{children:D==="minting"?lt:dt})]}),K&&e.jsx("div",{className:O.compactError,children:K}),i&&d&&e.jsxs("div",{className:Yt,children:[e.jsx("h4",{className:h({margin:0,fontSize:"sm"}),children:xt}),e.jsxs("p",{className:h({margin:"xs 0",fontSize:"sm"}),children:["ID: ",i.toString()," - ",bt]})]})]})}):e.jsxs("div",{className:h({maxWidth:"500px",margin:"0 auto",textAlign:"center"}),children:[e.jsxs("h3",{className:h({fontSize:"2xl",fontWeight:"semibold",marginBottom:"4",color:"gray.800"}),children:["ðŸŽ¨ ",mt]}),e.jsx("div",{className:h({fontSize:"md",fontWeight:"medium",color:"gray.800",mb:"3",textAlign:"center"}),children:gt}),e.jsx("p",{className:h({fontSize:"sm",color:"gray.600",mb:"lg",lineHeight:"1.5"}),children:ut}),e.jsx("div",{className:h({display:"flex",justifyContent:"center"}),children:e.jsx("button",{onClick:Lt,onMouseEnter:()=>r("imagegen-connect-hover"),className:le,children:Q})})]})})}function Ue({label:t,isActive:a,onClick:n}){return e.jsx("button",{className:`${G.tab} ${a?G.activeTab:""}`,onClick:n,"aria-selected":a,children:t})}function fa({genImTokenId:t}){const{isConnected:a}=ae(),n=Re(),{writeContract:r,isPending:d,data:l}=de(),{isLoading:i,isSuccess:y}=ye({hash:l}),u=me(),f=n===u.id,v=o({label:"imagegen.collect"}),{data:x,error:L,isPending:E,refetch:_}=ge({...Le,functionName:"getMintStats",args:[t],chainId:u.id}),U=async()=>{if(!a||!f||!x||!Array.isArray(x))return;const[,C]=x;r({...Le,functionName:"mintCollectorNFT",args:[t],value:C})};m.useEffect(()=>{y&&setTimeout(()=>{_()},2e3)},[y,_]);const s=()=>{if(E)return"...";if(L||!x||!Array.isArray(x))return"0";const[C]=x;return C.toString()},A=()=>{if(E||L||!x||!Array.isArray(x))return"Price loading...";const[C,T]=x,w=Pe(T),R=K=>{const k=parseFloat(K);return k>=.001?k.toFixed(3):k>=1e-4?k.toFixed(4):k.toFixed(6)},B=R(w),S=Number(C),P=Math.ceil((S+1)/5)*5,D=T/BigInt(2**Math.floor(S/5))*BigInt(2**Math.floor(P/5)),M=R(Pe(D));return`Current price: ${B} ETH | Price after ${P} mints: ${M} ETH`};return e.jsx("button",{onClick:U,disabled:!a||d||i||!f,className:`${p.actionButton} ${le}`,title:`Collect this NFT (${s()} collected) | ${A()}`,children:d?"ðŸ“¦ Collecting...":y?"âœ… Collected!":`ðŸ“¦ ${v} (${s()})`})}function De({tokenId:t,onImageClick:a,onNftBurned:n,onListedStatusChanged:r,isHighlighted:d=!1,isPublicView:l=!1,preloadedImageUrl:i,preloadedMetadata:y}){const{writeContract:u,isPending:f,data:v}=de(),{writeContract:x,isPending:L,data:E}=de(),[_,U]=m.useState(!1),[s,A]=m.useState({tokenId:t,tokenURI:"",imageUrl:i,metadata:y,isLoading:!i}),[C,T]=m.useState(""),{showToast:w,ToastComponent:R}=Be(),B=o({label:"imagegen.listed"}),S=o({label:"imagegen.download"}),P=o({label:"imagegen.delete"}),z=ze(),D=async b=>{try{if(b.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",b),null;const j=await fetch(b);if(!j.ok)throw new Error(`Failed to fetch metadata: ${j.status}`);return await j.json()}catch(j){return console.error("Error fetching NFT metadata:",j),null}};m.useEffect(()=>{(async()=>{try{A(F=>({...F,isLoading:!0,error:void 0}));const $=await z.readContract({address:I.address,abi:I.abi,functionName:"tokenURI",args:[t]});if(!$&&(i||y)){A(F=>({...F,tokenURI:"",isLoading:!1}));return}let H="";l&&(H=await z.readContract({address:I.address,abi:I.abi,functionName:"ownerOf",args:[t]}),T(H));let Q;if(!l)try{Q=await we(be,{...I,functionName:"isTokenListed",args:[t]})}catch(F){console.warn("Could not load listing status:",F)}let se=y,re=i;if($){const F=await D($);F&&(se=F,re=F.image)}A({tokenId:t,tokenURI:$,metadata:se,imageUrl:re,isLoading:!1,isListed:Q})}catch(j){console.error(`Error loading NFT ${t}:`,j),A({tokenId:t,tokenURI:"",imageUrl:i,metadata:y,isLoading:!1,error:`Failed to load NFT #${t}: ${j instanceof Error?j.message:"Unknown error"}`})}})()},[t,l,i,y,z]);const{isLoading:M,isSuccess:K}=ye({hash:v}),{isLoading:k,isSuccess:q}=ye({hash:E});m.useEffect(()=>{K&&setTimeout(()=>{n()},1e3)},[K,n]),m.useEffect(()=>{q&&r&&w("Listing status updated successfully!","success")},[q,r,w]);const J=()=>{s.imageUrl&&a({src:s.imageUrl,alt:s.metadata?.name||`Artwork #${s.tokenId}`,title:s.metadata?.name,description:s.metadata?.description})},ue=async()=>{if(s.imageUrl)try{const j=await(await fetch(s.imageUrl)).blob(),$=window.URL.createObjectURL(j),H=document.createElement("a");H.href=$,H.download=`${s.metadata?.name||`Artwork-${s.tokenId}`}.png`,document.body.appendChild(H),H.click(),document.body.removeChild(H),window.URL.revokeObjectURL($)}catch(b){console.error("Download failed:",b),w("Download failed. Please try again.","error")}},Y=async()=>{const j=`https://opensea.io/item/optimism/${I.address}/${s.tokenId}`;try{await navigator.clipboard.writeText(j),w("OpenSea URL copied to clipboard!","success")}catch($){console.error("Failed to copy URL:",$),window.open(j,"_blank","noopener,noreferrer")}},ne=async()=>{if(!_){U(!0),w(`âš ï¸ Click Delete again to permanently remove "${s.metadata?.name||`Artwork #${s.tokenId}`}"`,"warning"),setTimeout(()=>{U(!1)},5e3);return}U(!1);try{await u({...I,functionName:"burn",args:[s.tokenId]})}catch(b){console.error("Delete failed:",b),w("Failed to delete artwork. Please try again.","error")}},he=async()=>{if(!r)return;const b=!s.isListed,j=b?"public":"private";try{r(s.tokenId,b),await x({...I,functionName:"setTokenListed",args:[s.tokenId,b]})}catch($){console.error("Failed to update listing status:",$),r(s.tokenId,!b),w(`Failed to set artwork as ${j}. Please try again.`,"error")}};return e.jsxs("div",{className:`${p.container} ${d?p.highlighted:""} group`,onClick:J,children:[s.isLoading?e.jsxs("div",{className:p.loadingContainer,children:[e.jsx("div",{className:te}),e.jsx("p",{className:p.loadingText,children:"Loading artwork..."})]}):s.error?e.jsxs("div",{className:p.errorContainer,children:[e.jsx("div",{className:p.errorBox,children:e.jsx("p",{className:p.errorText,children:s.error})}),e.jsxs("p",{className:p.tokenIdText,children:["ID: ",s.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[s.imageUrl?e.jsxs("div",{className:p.imageContainer,children:[e.jsx("img",{src:s.imageUrl,alt:s.metadata?.name||`Artwork #${s.tokenId}`,className:p.image,onError:b=>{const j=b.target;j.style.display="none",j.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:p.imageError,style:{display:"none"},children:"ðŸ“· Image not available"})]}):e.jsx("div",{className:p.imagePlaceholder,children:"ðŸ“· No image available"}),e.jsxs("div",{className:p.cornerBadge,children:["#",s.tokenId.toString()]}),!l&&s.isListed&&e.jsxs("div",{className:p.listedBadge,children:["âœ“ ",B]}),l&&C&&e.jsxs("div",{className:p.ownerBadge,children:["ðŸ‘¤ ",C.slice(0,6),"...",C.slice(-4)]}),e.jsx("div",{className:p.actionsOverlay,children:e.jsxs("div",{className:p.actions,children:[s.imageUrl&&e.jsx("button",{onClick:b=>{b.stopPropagation(),ue()},className:p.compactSecondaryButton,title:`${S} image`,children:"â¬‡ï¸"}),s.imageUrl&&e.jsx("button",{onClick:b=>{b.stopPropagation(),J()},className:p.compactSecondaryButton,title:"View full size",children:"ðŸ”"}),e.jsx("button",{onClick:b=>{b.stopPropagation(),Y()},className:p.compactSecondaryButton,title:"Share artwork",children:"ðŸ“¤"}),!l&&r&&s.isListed!==void 0&&e.jsx("button",{onClick:b=>{b.stopPropagation(),he()},disabled:L||k,className:p.compactSecondaryButton,title:`${s.isListed?"Make private":"Make public"}`,children:s.isListed?"ðŸ”“":"ðŸ”’"}),l&&e.jsx(fa,{genImTokenId:s.tokenId}),!l&&e.jsx("button",{onClick:b=>{b.stopPropagation(),ne()},disabled:f||M,className:p.compactSecondaryButton,title:`${P} artwork (permanent)`,style:{backgroundColor:f||M?"rgba(0,0,0,0.3)":"rgba(220, 38, 38, 0.8)",opacity:f||M?.6:1},children:f||M?"â³":"ðŸ—‘ï¸"})]})})]}),R]})}function Me({image:t,onClose:a}){const{showToast:n,ToastComponent:r}=Be();m.useEffect(()=>{const l=i=>{i.key==="Escape"&&a()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[a]);const d=async()=>{try{const i=await(await fetch(t.src)).blob(),y=window.URL.createObjectURL(i),u=document.createElement("a");u.href=y,u.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(y)}catch(l){console.error("Download failed:",l),n("Download failed. Please try again.","error")}};return e.jsxs("div",{className:p.modalOverlay,onClick:a,children:[e.jsxs("div",{className:p.modalContent,onClick:l=>l.stopPropagation(),children:[e.jsx("button",{className:p.modalClose,onClick:a,children:"âœ•"}),e.jsx("img",{src:t.src,alt:t.alt,className:p.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:p.modalInfo,children:[t.title&&e.jsx("h3",{className:p.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:p.modalDescription,children:t.description}),e.jsx("div",{className:p.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:d,className:`${p.actionButton} ${le}`,children:"â¬‡ï¸ Download Full Size"})})]})]}),r]})}function xa({newlyCreatedNFT:t,onNewNFTDisplayed:a}){const{address:n,isConnected:r}=ae(),d=me(),[l,i]=m.useState([]),[y,u]=m.useState(!1),[f,v]=m.useState(null),[x,L]=m.useState(null),{data:E,isLoading:_}=ge({...I,functionName:"balanceOf",args:n?[n]:void 0,chainId:d.id,query:{enabled:!!n&&r}}),U=m.useCallback(async()=>{if(!r||!n){i([]);return}u(!0);try{const T=await we(be,{...I,functionName:"balanceOf",args:[n]});if(!T||T===0n){i([]);return}const w=[];for(let S=0;S<Number(T);S++){const P=(async()=>{try{return await we(be,{...I,functionName:"tokenOfOwnerByIndex",args:[n,BigInt(S)]})}catch(z){return console.error(`Error loading token ID at index ${S}:`,z),0n}})();w.push(P)}const B=(await Promise.all(w)).filter(S=>S>0n).sort((S,P)=>P>S?1:P<S?-1:0);i(B)}catch(T){console.error("Error loading token IDs:",T),i([])}finally{u(!1)}},[r,n]),s=m.useCallback(T=>{v(T),i(w=>w.includes(T)?w:[T,...w]),setTimeout(()=>{v(null),a?.()},5e3)},[a]),A=m.useCallback((T,w)=>{console.log(`NFT ${T} listing status changed to: ${w}`)},[]);m.useEffect(()=>{r&&n&&U()},[n,r,U]),m.useEffect(()=>{t&&s(t.tokenId)},[t,s]);const C=_||y;return r?C&&l.length===0?e.jsxs("div",{className:W.loadingContainer,children:[e.jsx("div",{className:te}),e.jsx("p",{children:"Loading your artworks..."})]}):E===0n||!E?e.jsx("div",{className:W.emptyStateContainer,children:e.jsx("p",{className:W.emptyStateText,children:"You haven't created any artworks yet. Use the generator above to create your first one!"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:W.grid,children:l.map((T,w)=>{const R=t?.tokenId===T,B=R?t.imageUrl:void 0,S=R?t.metadata:void 0;return e.jsx(De,{tokenId:T,onImageClick:L,onNftBurned:()=>U(),onListedStatusChanged:A,isHighlighted:f===T,isPublicView:!1,preloadedImageUrl:B,preloadedMetadata:S},`my-${T}-${w}`)})}),x&&e.jsx(Me,{image:x,onClose:()=>L(null)})]}):e.jsxs("div",{className:W.walletPrompt,children:[e.jsx("h3",{children:"ðŸ”— Connect Your Wallet"}),e.jsx("p",{children:"To view and manage your personal NFT artworks, please connect your wallet using the button above."}),e.jsx("p",{children:"Your artworks are stored on the blockchain and linked to your wallet address."}),e.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9em",opacity:.8},children:"ðŸ’¡ Tip: You can explore public artworks from other users in the â€œAll Public Artworksâ€ tab without connecting your wallet."})]})}function ba(){const[t,a]=m.useState([]),[n,r]=m.useState(!1),[d,l]=m.useState(null),i=ze(),y=m.useCallback(async()=>{r(!0);try{const u=await i.readContract({address:I.address,abi:I.abi,functionName:"getAllPublicTokens"});if(!u||u.length===0){a([]);return}const f=u.sort((v,x)=>x>v?1:x<v?-1:0);a(f)}catch(u){console.error("Error loading public token IDs:",u),a([])}finally{r(!1)}},[i]);return m.useEffect(()=>{y()},[y]),n&&t.length===0?e.jsxs("div",{className:W.loadingContainer,children:[e.jsx("div",{className:te}),e.jsx("p",{children:"Loading public artworks..."})]}):t.length===0?e.jsx("div",{className:W.emptyStateContainer,children:e.jsx("p",{className:W.emptyStateText,children:"No public artworks available yet."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:W.grid,children:t.map((u,f)=>e.jsx(De,{tokenId:u,onImageClick:l,onNftBurned:()=>{},isHighlighted:!1,isPublicView:!0},`public-${u}-${f}`))}),d&&e.jsx(Me,{image:d,onClose:()=>l(null)})]})}function ya({newlyCreatedNFT:t,onNewNFTDisplayed:a,activeTab:n,onTabChange:r}={}){const{address:d,isConnected:l}=ae(),[i,y]=m.useState(()=>l?"my":"public"),u=n??i,f=r??y,v=ge({...I,functionName:"balanceOf",args:d?[d]:void 0,chainId:me().id,query:{enabled:!!d&&l}}),{data:x,refetch:L}=v;m.useEffect(()=>{t&&L&&L()},[t,L]);const E=o({label:"imagegen.myArtworks"}),_=o({label:"imagegen.allPublicArtworks"});return e.jsxs("div",{className:W.container,children:[e.jsx("div",{className:G.container,children:e.jsxs("div",{className:G.tabList,children:[e.jsx(Ue,{label:l?`${E} (${x?.toString()||"0"})`:E,isActive:u==="my",onClick:()=>f("my")}),e.jsx(Ue,{label:_,isActive:u==="public",onClick:()=>f("public")})]})}),e.jsx("div",{className:`${G.tabPanel} ${u==="my"?"":G.hiddenPanel}`,children:e.jsx(xa,{newlyCreatedNFT:t,onNewNFTDisplayed:a})}),e.jsx("div",{className:`${G.tabPanel} ${u==="public"?"":G.hiddenPanel}`,children:e.jsx(ba,{})})]})}function wa(){const{isConnected:t}=ae(),[a,n]=m.useState(null),[r,d]=m.useState(()=>t?"my":"public"),l=(f,v,x)=>{console.log("Image generation succeeded:",{tokenId:f,imageUrl:v,metadata:x}),n({tokenId:f,imageUrl:v,metadata:x}),t&&d("my")},i=f=>{console.error("Image generation failed:",f)},y=()=>{n(null)},u=f=>{d(f)};return e.jsxs("div",{className:Qt,children:[e.jsx(pa,{onSuccess:l,onError:i}),e.jsx(ya,{newlyCreatedNFT:a??void 0,onNewNFTDisplayed:y,activeTab:r,onTabChange:u})]})}const Ta=Object.freeze(Object.defineProperty({__proto__:null,default:wa},Symbol.toStringTag,{value:"Module"}));function va(){return"AI Image Generator | fretchen.eu"}const ja=Object.freeze(Object.defineProperty({__proto__:null,title:va},Symbol.toStringTag,{value:"Module"})),Ra={hasServerOnlyHook:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:na}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:aa}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ta}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Ta}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:ea}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ja}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:Zt}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Xt}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Vt}}};export{Ra as configValuesSerialized};
