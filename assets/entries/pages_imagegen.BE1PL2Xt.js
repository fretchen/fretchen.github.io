import{r as g,e as O,j as e,f as w,s as F,g as Z,h as _,n as L,k as R,l as n,m as M,q as G,t as J,c as K,v as Q,F as X,i as ee,W as te,L as ae,a as ne,b as re,o as oe}from"../chunks/chunk-CoH0I7y2.js";import{u as q,g as W,a as B,b as H,r as z,c as se}from"../chunks/chunk-BqQ6Il-Z.js";/* empty css                      */import"../chunks/chunk-DQ3hQvvF.js";/* empty css                      *//* empty css                      */const ie=async t=>new Promise((l,a)=>{const r=async()=>{try{const u=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});u?l(u):setTimeout(r,2e3)}catch(u){a(u)}};r()});function le({apiUrl:t="https://mypersonaljscloudivnad9dy-readnftv2.functions.fnc.fr-par.scw.cloud",onSuccess:l,onError:a}){const r=B(),[u,c]=g.useState(),[m,p]=g.useState(),[f,C]=g.useState(""),[N,P]=g.useState(!1),[I,j]=g.useState("idle"),[v,k]=g.useState(null),{address:y,isConnected:d}=O(),h=W(),{data:s}=q({...r,functionName:"mintPrice",args:[],...(h==null?void 0:h.id)&&{chainId:h.id}}),{writeContractAsync:i}=H(),S=async()=>{if(!d||!y){const o="Please connect your account first";k(o),a==null||a(o);return}if(!f.trim()){const o="Please enter a prompt";k(o),a==null||a(o);return}if(!s){const o="Could not load creation fee from system";k(o),a==null||a(o);return}P(!0),k(null),j("minting");try{const o=`ipfs://tempURI/${Date.now()}`,A=await i({...r,functionName:"safeMint",args:[o],value:s,...(h==null?void 0:h.id)&&{chainId:h.id}});console.log("Minting transaction sent:",A);const x=await ie(A),T=x==null?void 0:x.logs.find(Y=>Y.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!T||T.topics.length<4)throw new Error("Could not extract artwork ID from transaction");const D=T.topics[3],b=BigInt(D);console.log("Created artwork ID:",b),p(b),j("generating");const E=await fetch(`${t}?prompt=${encodeURIComponent(f)}&tokenId=${b}`);if(!E.ok)throw new Error(`Error: ${E.status} ${E.statusText}`);const $=await E.json();console.log("Image generation completed",$);const U=$.image_url;c(U),j("idle");const V={name:`AI Generated Artwork #${b}`,description:`AI generated artwork based on the prompt: "${f}"`,image:U,external_url:$.metadata_url||"",attributes:[{trait_type:"Prompt",value:f},{trait_type:"Generation Method",value:"AI Generated"}]};l==null||l(b,U,V),setTimeout(()=>{C(""),c(void 0),p(void 0),k(null)},3e3)}catch(o){console.error("Error:",o);const A=o instanceof Error?o.message:"An unknown error occurred";k(A),j("error"),a==null||a(A)}finally{P(!1)}};return e.jsx("div",{className:w.compactLayout,children:e.jsxs("div",{className:w.compactContainer,children:[e.jsxs("div",{className:w.compactHeader,children:[e.jsx("h3",{className:w.compactTitle,children:"Create Your Art"}),e.jsx("span",{className:w.compactSubtitle,children:"Describe what you want and generate your unique digital artwork (~10¢)"})]}),e.jsxs("div",{className:w.compactForm,children:[e.jsx("textarea",{value:f,onChange:o=>C(o.target.value),placeholder:"Describe your image in detail... (e.g., 'A futuristic city skyline at sunset')",disabled:N||I!=="idle",className:w.compactTextarea}),e.jsx("button",{onClick:S,disabled:N||!f.trim()||!d,className:`${w.compactButton} ${N||!f.trim()||!d?w.compactButtonDisabled:""}`,children:N?I==="minting"?"Creating...":"Generating...":"🎨 Create Art"})]}),I!=="idle"&&e.jsxs("div",{className:w.compactStatus,children:[e.jsx("div",{className:F}),e.jsx("span",{children:I==="minting"?"Creating your artwork...":"Generating image..."})]}),!d&&e.jsx("div",{className:w.compactError,children:"Connect your account to create artwork"}),v&&e.jsx("div",{className:w.compactError,children:v}),m&&u&&e.jsxs("div",{className:Z,children:[e.jsx("h4",{className:_({margin:0,fontSize:"sm"}),children:"✅ Artwork created successfully!"}),e.jsxs("p",{className:_({margin:"xs 0",fontSize:"sm"}),children:["ID: ",m.toString()," - Check your gallery below"]})]})]})})}function ce({newlyCreatedNFT:t,onNewNFTDisplayed:l}={}){const{address:a,isConnected:r}=O(),u=W(),c=B(),[m,p]=g.useState([]),[f,C]=g.useState(!1),[N,P]=g.useState(null),[I,j]=g.useState(null),{data:v,isLoading:k}=q({...c,functionName:"balanceOf",args:a?[a]:void 0,chainId:u.id,query:{enabled:!!a&&r}}),y=async s=>{try{if(s.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",s),null;const i=await fetch(s);if(!i.ok)throw new Error(`Failed to fetch metadata: ${i.status}`);return await i.json()}catch(i){return console.error("Error fetching NFT metadata:",i),null}},d=async()=>{if(!r||!a){p([]);return}C(!0);try{const s=await z(R,{...c,functionName:"balanceOf",args:[a]});if(!s||s===0n){p([]);return}const i=Array.from({length:Number(s)},()=>({tokenId:0n,tokenURI:"",isLoading:!0}));p(i);const S=[];for(let x=0;x<Number(s);x++){const T=(async()=>{try{const b=await z(R,{...c,functionName:"tokenOfOwnerByIndex",args:[a,BigInt(x)]}),$=await z(R,{...c,functionName:"tokenURI",args:[b]}),U=await y($);return{tokenId:b,tokenURI:$,metadata:U||void 0,imageUrl:U==null?void 0:U.image,isLoading:!1}}catch(D){return console.error(`Error loading NFT at index ${x}:`,D),{tokenId:0n,tokenURI:"",isLoading:!1,error:`Failed to load NFT #${x}: ${D instanceof Error?D.message:"Unknown error"}`}}})();S.push(T)}const A=(await Promise.all(S)).sort((x,T)=>x.error&&!T.error?1:!x.error&&T.error?-1:x.error&&T.error?0:Number(T.tokenId-x.tokenId));p(A)}catch(s){console.error("Error loading NFTs:",s),p([])}finally{C(!1)}};if(g.useEffect(()=>{r&&a&&d()},[a,r,v]),g.useEffect(()=>{if(t){P(t.tokenId);const s={tokenId:t.tokenId,tokenURI:"",imageUrl:t.imageUrl,metadata:t.metadata,isLoading:!1};p(i=>{const S=i.findIndex(o=>o.tokenId===t.tokenId);if(S!==-1){const o=[...i];return o[S]={...o[S],imageUrl:t.imageUrl,metadata:t.metadata},o}else return[s,...i]}),setTimeout(()=>{P(null),l==null||l()},5e3)}},[t,l]),!r)return e.jsx("div",{className:L.walletPrompt,children:e.jsx("p",{children:"Connect your account to view your artworks"})});const h=k||f;return e.jsxs("div",{className:L.container,children:[e.jsx("div",{className:L.heading,children:e.jsxs("h2",{className:w.columnHeading,children:["Your Digital Artworks (",(v==null?void 0:v.toString())||"0",")"]})}),h&&m.length===0?e.jsxs("div",{className:L.loadingContainer,children:[e.jsx("div",{className:F}),e.jsx("p",{children:"Loading your artworks..."})]}):v===0n||!v?e.jsx("div",{className:L.emptyStateContainer,children:e.jsx("p",{className:L.emptyStateText,children:"You haven't created any artworks yet. Use the generator above to create your first one!"})}):e.jsx("div",{className:L.grid,children:m.map((s,i)=>e.jsx(de,{nft:s,onImageClick:j,onNftBurned:()=>d(),isHighlighted:N===s.tokenId},`${s.tokenId}-${i}`))}),I&&e.jsx(ue,{image:I,onClose:()=>j(null)})]})}function de({nft:t,onImageClick:l,onNftBurned:a,isHighlighted:r=!1}){var j,v,k;const{writeContract:u,isPending:c,data:m}=H(),p=B(),{isLoading:f,isSuccess:C}=se({hash:m});g.useEffect(()=>{C&&setTimeout(()=>{a()},1e3)},[C,a]);const N=()=>{var y,d,h;t.imageUrl&&l({src:t.imageUrl,alt:((y=t.metadata)==null?void 0:y.name)||`Artwork #${t.tokenId}`,title:(d=t.metadata)==null?void 0:d.name,description:(h=t.metadata)==null?void 0:h.description})},P=async()=>{var y;if(t.imageUrl)try{const h=await(await fetch(t.imageUrl)).blob(),s=window.URL.createObjectURL(h),i=document.createElement("a");i.href=s,i.download=`${((y=t.metadata)==null?void 0:y.name)||`Artwork-${t.tokenId}`}.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}catch(d){console.error("Download failed:",d),alert("Download failed. Please try again.")}},I=async()=>{var y;if(confirm(`Are you sure you want to permanently delete "${((y=t.metadata)==null?void 0:y.name)||`Artwork #${t.tokenId}`}"? This action cannot be undone.`))try{await u({...p,functionName:"burn",args:[t.tokenId]})}catch(d){console.error("Delete failed:",d),alert("Failed to delete artwork. Please try again.")}};return e.jsx("div",{className:`${n.container} ${r?n.highlighted:""}`,children:t.isLoading?e.jsxs("div",{className:n.loadingContainer,children:[e.jsx("div",{className:F}),e.jsx("p",{className:n.loadingText,children:"Loading artwork..."})]}):t.error?e.jsxs("div",{className:n.errorContainer,children:[e.jsx("div",{className:n.errorBox,children:e.jsx("p",{className:n.errorText,children:t.error})}),e.jsxs("p",{className:n.tokenIdText,children:["ID: ",t.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[t.imageUrl?e.jsxs("div",{className:n.imageContainer,children:[e.jsx("img",{src:t.imageUrl,alt:((j=t.metadata)==null?void 0:j.name)||`Artwork #${t.tokenId}`,className:n.image,onClick:N,style:{cursor:"pointer"},onError:y=>{const d=y.target;d.style.display="none",d.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:n.imageError,style:{display:"none"},children:"Image not available"})]}):e.jsx("div",{className:n.imagePlaceholder,children:"No image available"}),e.jsx("h3",{className:n.title,children:((v=t.metadata)==null?void 0:v.name)||`Artwork #${t.tokenId}`}),((k=t.metadata)==null?void 0:k.description)&&e.jsx("p",{className:n.description,children:t.metadata.description}),e.jsx("div",{className:n.footer,children:e.jsxs("span",{children:["ID: ",t.tokenId.toString()]})}),e.jsxs("div",{className:n.actions,children:[t.imageUrl&&e.jsx("button",{onClick:N,className:`${n.actionButton} ${M}`,title:"View full size",children:"🔍 Zoom"}),t.imageUrl&&e.jsx("button",{onClick:P,className:`${n.actionButton} ${G}`,title:"Download image",children:"⬇️ Download"}),e.jsx("button",{onClick:I,disabled:c||f,className:`${n.actionButton} ${c||f?M:J}`,title:"Delete artwork (permanent)",style:{opacity:c||f?.6:1},children:c?"🗑️ Deleting...":f?"⏳ Confirming...":"🗑️ Delete"})]})]})})}function ue({image:t,onClose:l}){g.useEffect(()=>{const r=u=>{u.key==="Escape"&&l()};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[l]);const a=async()=>{try{const u=await(await fetch(t.src)).blob(),c=window.URL.createObjectURL(u),m=document.createElement("a");m.href=c,m.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(c)}catch(r){console.error("Download failed:",r),alert("Download failed. Please try again.")}};return e.jsx("div",{className:n.modalOverlay,onClick:l,children:e.jsxs("div",{className:n.modalContent,onClick:r=>r.stopPropagation(),children:[e.jsx("button",{className:n.modalClose,onClick:l,children:"✕"}),e.jsx("img",{src:t.src,alt:t.alt,className:n.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:n.modalInfo,children:[t.title&&e.jsx("h3",{className:n.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:n.modalDescription,children:t.description}),e.jsx("div",{className:n.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:a,className:`${n.actionButton} ${G}`,children:"⬇️ Download Full Size"})})]})]})})}function me(){const[t,l]=g.useState(null),a=(c,m,p)=>{console.log("Image generation succeeded:",{tokenId:c,imageUrl:m,metadata:p}),l({tokenId:c,imageUrl:m,metadata:p})},r=c=>{console.error("Image generation failed:",c)},u=()=>{l(null)};return e.jsxs("div",{className:K,children:[e.jsx("h1",{className:Q,children:"AI Image Creator"}),e.jsx(le,{onSuccess:a,onError:r}),e.jsx(ce,{newlyCreatedNFT:t??void 0,onNewNFTDisplayed:u})]})}const he=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"})),ve={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:oe}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:re}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ne}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:he}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:ae}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:te}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ee}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:X}}};export{ve as configValuesSerialized};
