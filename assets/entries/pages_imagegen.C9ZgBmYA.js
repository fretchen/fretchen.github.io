import{r as i,e as se,j as e,f as S,s as V,g as ce,h as X,n as R,t as z,k as O,R as re,l as o,m as J,q as ne,v as de,w as B,c as ue,F as me,i as he,W as pe,L as ge,a as fe,b as xe,o as ye}from"../chunks/chunk-DDaH2v8y.js";import{u as oe,g as ie,a as Q,b as K,r as q,c as ee}from"../chunks/chunk-p6UXy_sg.js";/* empty css                      */import"../chunks/chunk-DQ3hQvvF.js";/* empty css                      *//* empty css                      */const we=async t=>new Promise((m,r)=>{const c=async()=>{try{const j=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});j?m(j):setTimeout(c,2e3)}catch(j){r(j)}};c()});function ke({apiUrl:t="https://mypersonaljscloudivnad9dy-readnftv2.functions.fnc.fr-par.scw.cloud",onSuccess:m,onError:r}){const c=Q(),[j,h]=i.useState(),[p,U]=i.useState(),[g,b]=i.useState(""),[D,k]=i.useState("1024x1024"),[x,v]=i.useState(!1),[N,P]=i.useState("idle"),[G,L]=i.useState(null),{address:W,isConnected:$}=se(),f=ie(),{data:F}=oe({...c,functionName:"mintPrice",args:[],...(f==null?void 0:f.id)&&{chainId:f.id}}),{writeContractAsync:M}=K(),H=async()=>{if(!$||!W){const d="Please connect your account first";L(d),r==null||r(d);return}if(!g.trim()){const d="Please enter a prompt";L(d),r==null||r(d);return}if(!F){const d="Could not load creation fee from system";L(d),r==null||r(d);return}v(!0),L(null),P("minting");try{const d=`ipfs://tempURI/${Date.now()}`,I=await M({...c,functionName:"safeMint",args:[d],value:F,...(f==null?void 0:f.id)&&{chainId:f.id}});console.log("Minting transaction sent:",I);const E=await we(I),_=E==null?void 0:E.logs.find(a=>a.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!_||_.topics.length<4)throw new Error("Could not extract artwork ID from transaction");const s=_.topics[3],l=BigInt(s);console.log("Created artwork ID:",l),U(l),P("generating");const y=await fetch(`${t}?prompt=${encodeURIComponent(g)}&tokenId=${l}&size=${D}`);if(!y.ok)throw new Error(`Error: ${y.status} ${y.statusText}`);const w=await y.json();console.log("Image generation completed",w);const A=w.image_url;h(A),P("idle");const n={name:`AI Generated Artwork #${l}`,description:`AI generated artwork based on the prompt: "${g}"`,image:A,external_url:w.metadata_url||"",attributes:[{trait_type:"Prompt",value:g},{trait_type:"Generation Method",value:"AI Generated"}]};m==null||m(l,A,n),setTimeout(()=>{b(""),k("1024x1024"),h(void 0),U(void 0),L(null)},3e3)}catch(d){console.error("Error:",d);const I=d instanceof Error?d.message:"An unknown error occurred";L(I),P("error"),r==null||r(I)}finally{v(!1)}};return e.jsx("div",{className:S.compactLayout,children:e.jsxs("div",{className:S.compactContainer,children:[e.jsxs("div",{className:S.compactHeader,children:[e.jsx("h3",{className:S.compactTitle,children:"🎨 Create Your Digital Artwork"}),e.jsx("span",{className:S.compactSubtitle,children:"Describe your vision and generate a unique AI artwork for ~10¢. Your creation will be minted as an NFT on the blockchain."})]}),e.jsxs("div",{className:S.compactForm,children:[e.jsx("textarea",{value:g,onChange:d=>b(d.target.value),placeholder:"Describe your image in detail... (e.g., 'A futuristic city skyline at sunset with neon lights reflecting in the water')",disabled:x||N!=="idle",className:S.compactTextarea}),e.jsxs("div",{className:S.compactFormRow,children:[e.jsxs("select",{id:"imageSizeSelect",value:D,onChange:d=>k(d.target.value),disabled:x||N!=="idle",className:S.compactSelect,"aria-label":"Select image format for your artwork",children:[e.jsx("option",{value:"1024x1024",children:"◼ Square"}),e.jsx("option",{value:"1792x1024",children:"▬ Wide"})]}),e.jsx("button",{onClick:H,disabled:x||!g.trim()||!$,className:`${S.compactButton} ${x||!g.trim()||!$?S.compactButtonDisabled:""}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:V}),N==="minting"?"Creating...":"Generating..."]}):"🎨 Create Artwork"})]})]}),N!=="idle"&&e.jsxs("div",{className:S.compactStatus,children:[e.jsx("div",{className:V}),e.jsx("span",{children:N==="minting"?"Creating your artwork...":"Generating image..."})]}),!$&&e.jsx("div",{className:S.compactError,children:"Connect your account to create artwork"}),G&&e.jsx("div",{className:S.compactError,children:G}),p&&j&&e.jsxs("div",{className:ce,children:[e.jsx("h4",{className:X({margin:0,fontSize:"sm"}),children:"✅ Artwork created successfully!"}),e.jsxs("p",{className:X({margin:"xs 0",fontSize:"sm"}),children:["ID: ",p.toString()," - Check your gallery below"]})]})]})})}function te({label:t,isActive:m,onClick:r}){return e.jsx("button",{className:`${z.tab} ${m?z.activeTab:""}`,onClick:r,children:t})}function Te({newlyCreatedNFT:t,onNewNFTDisplayed:m}={}){const{address:r,isConnected:c}=se(),j=ie(),h=Q(),[p,U]=i.useState("my"),[g,b]=i.useState([]),[D,k]=i.useState(!1),[x,v]=i.useState([]),[N,P]=i.useState(!1),[G,L]=i.useState(null),[W,$]=i.useState(null),{data:f,isLoading:F}=oe({...h,functionName:"balanceOf",args:r?[r]:void 0,chainId:j.id,query:{enabled:!!r&&c}}),M=async s=>{try{if(s.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",s),null;const l=await fetch(s);if(!l.ok)throw new Error(`Failed to fetch metadata: ${l.status}`);return await l.json()}catch(l){return console.error("Error fetching NFT metadata:",l),null}},H=async()=>{P(!0);try{const s=await q(O,{...h,functionName:"getAllPublicTokens"});if(!s||s.length===0){v([]);return}const l=s.map(n=>({tokenId:n,tokenURI:"",isLoading:!0,owner:""}));v(l);const y=s.map(async n=>{try{const a=await q(O,{...h,functionName:"ownerOf",args:[n]}),T=await q(O,{...h,functionName:"tokenURI",args:[n]}),Y=a,C=await M(T);return{tokenId:n,tokenURI:T,metadata:C||void 0,imageUrl:C==null?void 0:C.image,isLoading:!1,owner:Y}}catch(a){return console.error(`Error loading public NFT ${n}:`,a),{tokenId:n,tokenURI:"",isLoading:!1,error:`Failed to load NFT #${n}: ${a instanceof Error?a.message:"Unknown error"}`,owner:""}}}),A=(await Promise.all(y)).sort((n,a)=>n.error&&!a.error?1:!n.error&&a.error?-1:n.error&&a.error?0:a.tokenId>n.tokenId?1:a.tokenId<n.tokenId?-1:0);v(A)}catch(s){console.error("Error loading public NFTs:",s),v([])}finally{P(!1)}},d=async()=>{if(!c||!r){b([]);return}k(!0);try{const s=await q(O,{...h,functionName:"balanceOf",args:[r]});if(!s||s===0n){b([]);return}const l=Array.from({length:Number(s)},()=>({tokenId:0n,tokenURI:"",isLoading:!0}));b(l);const y=[];for(let n=0;n<Number(s);n++){const a=(async()=>{try{const T=await q(O,{...h,functionName:"tokenOfOwnerByIndex",args:[r,BigInt(n)]}),C=await q(O,{...h,functionName:"tokenURI",args:[T]}),le=await q(O,{...h,functionName:"isTokenListed",args:[T]}),Z=await M(C);return{tokenId:T,tokenURI:C,metadata:Z||void 0,imageUrl:Z==null?void 0:Z.image,isLoading:!1,isListed:le}}catch(u){return console.error(`Error loading NFT at index ${n}:`,u),{tokenId:0n,tokenURI:"",isLoading:!1,error:`Failed to load NFT #${n}: ${u instanceof Error?u.message:"Unknown error"}`}}})();y.push(a)}const A=(await Promise.all(y)).sort((n,a)=>n.error&&!a.error?1:!n.error&&a.error?-1:n.error&&a.error?0:a.tokenId>n.tokenId?1:a.tokenId<n.tokenId?-1:0);b(A)}catch(s){console.error("Error loading NFTs:",s),b([])}finally{k(!1)}},I=async(s,l)=>{b(y=>y.map(w=>w.tokenId===s?{...w,isListed:l}:w))};i.useEffect(()=>{p==="my"?c&&r&&d():p==="public"&&H()},[p,r,c,f]),i.useEffect(()=>{if(t){L(t.tokenId);const s={tokenId:t.tokenId,tokenURI:"",imageUrl:t.imageUrl,metadata:t.metadata,isLoading:!1,isListed:!1};b(l=>{const y=l.findIndex(w=>w.tokenId===t.tokenId);if(y!==-1){const w=[...l];return w[y]={...w[y],imageUrl:t.imageUrl,metadata:t.metadata},w}else return[s,...l]}),setTimeout(()=>{L(null),m==null||m()},5e3)}},[t,m]);const E=p==="my"&&(F||D),_=p==="public"&&N;return e.jsxs("div",{className:R.container,children:[e.jsx("div",{className:z.container,children:e.jsxs("div",{className:z.tabList,children:[e.jsx(te,{label:c?`My Artworks (${(f==null?void 0:f.toString())||"0"})`:"My Artworks",isActive:p==="my",onClick:()=>U("my")}),e.jsx(te,{label:"All Public Artworks",isActive:p==="public",onClick:()=>U("public")})]})}),e.jsx("div",{className:`${z.tabPanel} ${p==="my"?"":z.hiddenPanel}`,children:c?E&&g.length===0?e.jsxs("div",{className:R.loadingContainer,children:[e.jsx("div",{className:V}),e.jsx("p",{children:"Loading your artworks..."})]}):f===0n||!f?e.jsx("div",{className:R.emptyStateContainer,children:e.jsx("p",{className:R.emptyStateText,children:"You haven't created any artworks yet. Use the generator above to create your first one!"})}):e.jsx("div",{className:R.grid,children:g.map((s,l)=>e.jsx(ae,{nft:s,onImageClick:$,onNftBurned:()=>d(),onListedStatusChanged:I,isHighlighted:G===s.tokenId,isPublicView:!1},`my-${s.tokenId}-${l}`))}):e.jsxs("div",{className:R.walletPrompt,children:[e.jsx("h3",{children:"🔗 Connect Your Wallet"}),e.jsx("p",{children:"To view and manage your personal NFT artworks, please connect your wallet using the button above."}),e.jsx("p",{children:"Your artworks are stored on the blockchain and linked to your wallet address."}),e.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9em",opacity:.8},children:"💡 Tip: You can explore public artworks from other users in the “All Public Artworks” tab without connecting your wallet."})]})}),e.jsx("div",{className:`${z.tabPanel} ${p==="public"?"":z.hiddenPanel}`,children:_&&x.length===0?e.jsxs("div",{className:R.loadingContainer,children:[e.jsx("div",{className:V}),e.jsx("p",{children:"Loading public artworks..."})]}):x.length===0?e.jsx("div",{className:R.emptyStateContainer,children:e.jsx("p",{className:R.emptyStateText,children:"No public artworks available yet."})}):e.jsx("div",{className:R.grid,children:x.map((s,l)=>e.jsx(ae,{nft:s,onImageClick:$,onNftBurned:()=>{},isHighlighted:!1,isPublicView:!0,owner:s.owner},`public-${s.tokenId}-${l}`))})}),W&&e.jsx(ve,{image:W,onClose:()=>$(null)})]})}function ae({nft:t,onImageClick:m,onNftBurned:r,onListedStatusChanged:c,isHighlighted:j=!1,isPublicView:h=!1,owner:p}){var w,A,n;const{writeContract:U,isPending:g,data:b}=K(),{writeContract:D,isPending:k,data:x}=K(),v=Q(),[N,P]=i.useState(!1),[G,L]=i.useState(""),[W,$]=i.useState("success"),f=re.useRef(null),{isLoading:F,isSuccess:M}=ee({hash:b}),{isLoading:H,isSuccess:d}=ee({hash:x});i.useEffect(()=>{M&&setTimeout(()=>{r()},1e3)},[M,r]),i.useEffect(()=>{d&&c&&I("Listing status updated successfully!","success")},[d,c]),i.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const I=(a,u="error")=>{L(a),$(u),P(!0),f.current&&clearTimeout(f.current);const T=u==="error"?4e3:3e3;f.current=setTimeout(()=>{P(!1),f.current=null},T)},E=()=>{var a,u,T;t.imageUrl&&m({src:t.imageUrl,alt:((a=t.metadata)==null?void 0:a.name)||`Artwork #${t.tokenId}`,title:(u=t.metadata)==null?void 0:u.name,description:(T=t.metadata)==null?void 0:T.description})},_=async()=>{var a;if(t.imageUrl)try{const T=await(await fetch(t.imageUrl)).blob(),Y=window.URL.createObjectURL(T),C=document.createElement("a");C.href=Y,C.download=`${((a=t.metadata)==null?void 0:a.name)||`Artwork-${t.tokenId}`}.png`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(Y)}catch(u){console.error("Download failed:",u),I("Download failed. Please try again.")}},s=async()=>{const u=`https://opensea.io/item/optimism/${v.address}/${t.tokenId}`;try{await navigator.clipboard.writeText(u),I("OpenSea URL copied to clipboard!","success")}catch(T){console.error("Failed to copy URL:",T),window.open(u,"_blank","noopener,noreferrer")}},l=async()=>{var a;if(confirm(`Are you sure you want to permanently delete "${((a=t.metadata)==null?void 0:a.name)||`Artwork #${t.tokenId}`}"? This action cannot be undone.`))try{await U({...v,functionName:"burn",args:[t.tokenId]})}catch(u){console.error("Delete failed:",u),I("Failed to delete artwork. Please try again.")}},y=async()=>{if(!c)return;const a=!t.isListed,u=a?"public":"private";try{c(t.tokenId,a),await D({...v,functionName:"setTokenListed",args:[t.tokenId,a]})}catch(T){console.error("Failed to update listing status:",T),c(t.tokenId,!a),I(`Failed to set artwork as ${u}. Please try again.`)}};return e.jsxs("div",{className:`${o.container} ${j?o.highlighted:""}`,children:[t.isLoading?e.jsxs("div",{className:o.loadingContainer,children:[e.jsx("div",{className:V}),e.jsx("p",{className:o.loadingText,children:"Loading artwork..."})]}):t.error?e.jsxs("div",{className:o.errorContainer,children:[e.jsx("div",{className:o.errorBox,children:e.jsx("p",{className:o.errorText,children:t.error})}),e.jsxs("p",{className:o.tokenIdText,children:["ID: ",t.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[t.imageUrl?e.jsxs("div",{className:o.imageContainer,children:[e.jsx("img",{src:t.imageUrl,alt:((w=t.metadata)==null?void 0:w.name)||`Artwork #${t.tokenId}`,className:o.image,onClick:E,style:{cursor:"pointer"},onError:a=>{const u=a.target;u.style.display="none",u.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:o.imageError,style:{display:"none"},children:"Image not available"})]}):e.jsx("div",{className:o.imagePlaceholder,children:"No image available"}),e.jsx("h3",{className:o.title,children:((A=t.metadata)==null?void 0:A.name)||`Artwork #${t.tokenId}`}),((n=t.metadata)==null?void 0:n.description)&&e.jsx("p",{className:o.description,children:t.metadata.description}),e.jsxs("div",{className:o.footer,children:[e.jsxs("span",{children:["ID: ",t.tokenId.toString()]}),!h&&c&&t.isListed!==void 0&&e.jsxs("label",{className:o.checkboxLabel,title:`${t.isListed?"NFT is publicly listed":"NFT is private"}`,children:[e.jsx("input",{type:"checkbox",checked:t.isListed,onChange:y,disabled:k||H,className:o.checkbox}),"Listed"]}),h&&p&&e.jsxs("span",{title:`Owned by ${p}`,children:["Owner: ",p.slice(0,6),"...",p.slice(-4)]})]}),e.jsxs("div",{className:o.actions,children:[t.imageUrl&&e.jsx("button",{onClick:E,className:`${o.actionButton} ${J}`,title:"View full size",children:"🔍 Zoom"}),t.imageUrl&&e.jsx("button",{onClick:_,className:`${o.actionButton} ${ne}`,title:"Download image",children:"⬇️ Download"}),e.jsx("button",{onClick:s,className:`${o.actionButton} ${J}`,title:"Share your artwork on the marketplace",children:"📤 Share"}),!h&&e.jsx("button",{onClick:l,disabled:g||F,className:`${o.actionButton} ${g||F?J:de}`,title:"Delete artwork (permanent)",style:{opacity:g||F?.6:1},children:g?"🗑️ Deleting...":F?"⏳ Confirming...":"🗑️ Delete"})]})]}),N&&e.jsx("div",{className:B.container,children:e.jsxs("div",{className:B.content,children:[e.jsx("span",{className:B.icon,children:W==="success"?"✅":"❌"}),e.jsx("span",{className:B.message,children:G})]})})]})}function ve({image:t,onClose:m}){const[r,c]=i.useState(!1),[j,h]=i.useState(""),[p,U]=i.useState("success"),g=re.useRef(null);i.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]);const b=(k,x="error")=>{h(k),U(x),c(!0),g.current&&clearTimeout(g.current);const v=x==="error"?4e3:3e3;g.current=setTimeout(()=>{c(!1),g.current=null},v)};i.useEffect(()=>{const k=x=>{x.key==="Escape"&&m()};return document.addEventListener("keydown",k),()=>document.removeEventListener("keydown",k)},[m]);const D=async()=>{try{const x=await(await fetch(t.src)).blob(),v=window.URL.createObjectURL(x),N=document.createElement("a");N.href=v,N.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(v)}catch(k){console.error("Download failed:",k),b("Download failed. Please try again.")}};return e.jsxs("div",{className:o.modalOverlay,onClick:m,children:[e.jsxs("div",{className:o.modalContent,onClick:k=>k.stopPropagation(),children:[e.jsx("button",{className:o.modalClose,onClick:m,children:"✕"}),e.jsx("img",{src:t.src,alt:t.alt,className:o.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:o.modalInfo,children:[t.title&&e.jsx("h3",{className:o.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:o.modalDescription,children:t.description}),e.jsx("div",{className:o.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:D,className:`${o.actionButton} ${ne}`,children:"⬇️ Download Full Size"})})]})]}),r&&e.jsx("div",{className:B.container,children:e.jsxs("div",{className:B.content,children:[e.jsx("span",{className:B.icon,children:p==="success"?"✅":"❌"}),e.jsx("span",{className:B.message,children:j})]})})]})}function Ne(){const[t,m]=i.useState(null),r=(h,p,U)=>{console.log("Image generation succeeded:",{tokenId:h,imageUrl:p,metadata:U}),m({tokenId:h,imageUrl:p,metadata:U})},c=h=>{console.error("Image generation failed:",h)},j=()=>{m(null)};return e.jsxs("div",{className:ue,children:[e.jsx(ke,{onSuccess:r,onError:c}),e.jsx(Te,{newlyCreatedNFT:t??void 0,onNewNFTDisplayed:j})]})}const je=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"})),$e={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ye}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:xe}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:fe}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:je}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:ge}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:pe}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:he}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:me}}};export{$e as configValuesSerialized};
