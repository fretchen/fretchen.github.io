import{be as _t,bf as Ht,bg as Wt,$ as Ue,r as m,a0 as qt,g as u,j as e,u as Gt,bh as Kt,bi as Yt,bj as Jt,a4 as te,bb as ze,a5 as Qt,a2 as r,az as me,bk as M,bl as p,bm as ee,bn as Vt,bo as Xt,bp as K,bq as de,a1 as Le,br as ye,bs as W,f as Zt,F as ea,a as ta,W as aa,c as na,d as sa,e as ra,o as oa}from"../chunks/chunk-DXTPPVxN.js";import{a as ge,g as I,e as Ee}from"../chunks/chunk-DA2KhBe7.js";import{d as ia}from"../chunks/chunk-CT5atk_u.js";import{u as he,a as ue,b as we,r as Te}from"../chunks/chunk-6cMmeWEn.js";import{u as Be}from"../chunks/chunk-CB3odJ-6.js";/* empty css                      *//* empty css                      *//* empty css                      */import"../chunks/chunk-CPgkNqLt.js";import"../chunks/chunk-DZJvJoC1.js";let be=[];function Ae(t){const a=t.chains;return _t(be,a)?be:(be=a,a)}async function ca(t,a){const{addEthereumChainParameter:n,chainId:s}=a,c=t.state.connections.get(a.connector?.uid??t.state.current);if(c){const o=c.connector;if(!o.switchChain)throw new Ht({connector:o});return await o.switchChain({addEthereumChainParameter:n,chainId:s})}const i=t.chains.find(o=>o.id===s);if(!i)throw new Wt;return t.setState(o=>({...o,chainId:s})),i}function la(t,a){const{onChange:n}=a;return t._internal.chains.subscribe((s,c)=>{n(s,c)})}function da(t){return{mutationFn(a){return ca(t,a)},mutationKey:["switchChain"]}}function ma(t={}){const a=Ue(t);return m.useSyncExternalStore(n=>la(a,{onChange:n}),()=>Ae(a),()=>Ae(a))}function ua(t={}){const{mutation:a}=t,n=Ue(t),s=da(n),{mutate:c,mutateAsync:i,...o}=qt({...a,...s});return{...o,chains:ma({config:n}),switchChain:c,switchChainAsync:i}}function $e({size:t="sm",className:a}){const n={xs:u({fontSize:"xs",lineHeight:"1"}),sm:u({fontSize:"sm",lineHeight:"1"}),md:u({fontSize:"md",lineHeight:"1"})},s=u({display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1em",height:"1em",borderRadius:"50%",backgroundColor:"blue.100",color:"blue.600",fontWeight:"bold",cursor:"help"});return e.jsx("span",{className:`${s} ${n[t]} ${a||""}`,role:"img","aria-label":"Information",children:"i"})}function Fe({label:t,locale:a}){const s=Gt(),c=a??s.locale??ia,o=Kt(c==="de"?Yt:Jt,t);return e.jsx("span",{"data-locale":c,children:o})}const ga="https://mypersonaljscloudivnad9dy-genimgbfl.functions.fnc.fr-par.scw.cloud",ha=(t,a,n=1920)=>{const s=t/a;return t<=n&&a<=n?{width:t,height:a}:t>a?{width:n,height:Math.round(n/s)}:{width:Math.round(n*s),height:n}},pa=(t,a=1024)=>new Promise((n,s)=>{const c=document.createElement("canvas"),i=c.getContext("2d"),o=new Image;o.onload=()=>{const{width:f,height:h}=ha(o.width,o.height);if(c.width=f,c.height=h,!i){s(new Error("Could not get canvas context"));return}i.fillStyle="white",i.fillRect(0,0,f,h),i.drawImage(o,0,0,f,h);let x=.9;const w=()=>{const C=c.toDataURL("image/jpeg",x);C.length*.75/1024<=a||x<=.1?n({base64:C.split(",")[1],mimeType:"image/jpeg"}):(x-=.1,setTimeout(w,0))};w()},o.onerror=()=>s(new Error("Failed to load image")),o.src=URL.createObjectURL(t)}),fa=async t=>new Promise((a,n)=>{const s=async()=>{try{const c=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});c?a(c):setTimeout(s,2e3)}catch(c){n(c)}};s()});function xa({apiUrl:t=ga,onSuccess:a,onError:n}){const[s,c]=m.useState(),[i,o]=m.useState(),[f,h]=m.useState(),[x,w]=m.useState(null),[C,P]=m.useState("image/jpeg"),{address:B,isConnected:S}=te(),[v,l]=m.useState("empty"),[L,O]=m.useState(""),[y,T]=m.useState("1024x1024"),[E,_]=m.useState(!1),[N,F]=m.useState(!1),[A,q]=m.useState("idle"),[H,k]=m.useState(null),G=ge(),Y=ze(),{switchChain:J,isPending:z}=ua(),{connectors:ae,connect:pe}=Qt(),{data:ne}=he({...I,functionName:"mintPrice",args:[],...G?.id&&{chainId:G.id}}),{writeContractAsync:b}=ue(),j=async d=>new Promise((g,$)=>{const V=()=>{Y===d?g():setTimeout(V,100)};setTimeout(()=>{$(new Error(Ye))},1e4),V()}),R=()=>{ae.length>0&&pe({connector:ae[0]})},D=r({label:"imagegen.connectWalletButton"}),se=r({label:"imagegen.enterPrompt"}),re=r({label:"imagegen.switchingNetwork"}),oe=r({label:"imagegen.creating"}),U=r({label:"imagegen.generating"}),ve=r({label:"imagegen.createArtwork"}),_e=r({label:"imagegen.promptPlaceholder"}),He=r({label:"imagegen.editPromptPlaceholder"}),je=r({label:"imagegen.editImage"}),We=r({label:"imagegen.connectAccountFirst"}),qe=r({label:"imagegen.switchToOptimism"}),Ge=r({label:"imagegen.enterPromptError"}),Ke=r({label:"imagegen.loadMintPrice"}),Ye=r({label:"imagegen.chainSwitchTimeout"}),Je=r({label:"imagegen.extractTokenId"}),Qe=r({label:"imagegen.unknownError"}),Ve=r({label:"imagegen.uploadReferenceImage"}),Xe=r({label:"imagegen.dragDropHere"}),Ze=r({label:"imagegen.supportedFormats"}),et=r({label:"imagegen.referenceImageTitle"}),tt=r({label:"imagegen.generatedArtworkTitle"}),Ne=r({label:"imagegen.remove"}),at=r({label:"imagegen.referenceImageAlt"}),nt=r({label:"imagegen.generatedArtworkAlt"}),st=r({label:"imagegen.referenceImageHint"}),rt=r({label:"imagegen.invalidFileType"}),ot=r({label:"imagegen.fileTooLarge"}),it=r({label:"imagegen.compressionFailed"}),ct=r({label:"imagegen.failedToProcessImage"}),lt=r({label:"imagegen.creatingArtwork"}),dt=r({label:"imagegen.generatingImage"}),mt=r({label:"imagegen.title"}),ut=r({label:"imagegen.collapsedTitle"}),gt=r({label:"imagegen.collapsedDescription"}),ht=r({label:"imagegen.square"}),pt=r({label:"imagegen.wide"}),ft=r({label:"imagegen.mintingInfo"}),xt=r({label:"imagegen.artworkCreated"}),bt=r({label:"imagegen.checkGallery"}),yt=r({label:"imagegen.switchingToOptimism"}),wt=r({label:"imagegen.poweredBy"}),Tt=r({label:"imagegen.viewContract"}),vt=r({label:"imagegen.learnMoreOptimism"}),jt=r({label:"imagegen.viewContractEtherscan"}),Nt=()=>z?"switching":N?"loading":L.trim()?"ready":"needsPrompt",Ce=d=>{switch(d){case"switching":return re;case"loading":return A==="minting"?oe:U;case"connect":return D;case"needsPrompt":return se;case"ready":return v!=="empty"?je:ve;default:return v!=="empty"?je:ve}},Q=Nt(),Ct=()=>{const d=Q==="needsPrompt",g=Q==="loading"||Q==="switching";return e.jsx("button",{onClick:St,disabled:d,className:`${me} ${d?Xt:""}`,title:r({label:"imagegen.mintingInfo"}),"aria-describedby":"create-artwork-info",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:ee}),Ce(Q)]}):e.jsxs(e.Fragment,{children:["🎨 ",Ce(Q),e.jsx($e,{size:"xs",className:u({ml:"1",opacity:"0.7"})})]})})},St=async()=>{if(!S||!B){const g=We;k(g),n?.(g);return}const d=G?.id;if(d&&Y!==d)try{k(yt),await J({chainId:d}),await j(d),k(null)}catch(g){console.error("Failed to switch chain:",g);const $=g instanceof Error?g.message:qe;k($),n?.($);return}if(!L.trim()){const g=Ge;k(g),n?.(g);return}if(!ne){const g=Ke;k(g),n?.(g);return}F(!0),k(null),q("minting");try{const $=await b({...I,functionName:"safeMint",args:["",E],value:ne,...G?.id&&{chainId:G.id}});console.log("Minting transaction sent:",$);const fe=(await fa($))?.logs.find(ce=>ce.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!fe||fe.topics.length<4)throw new Error(Je);const Rt=fe.topics[3],X=BigInt(Rt);console.log("Created artwork ID:",X),o(X),q("generating");const Ie=x!==null,Ut=Ie?"edit":"generate",Pe={prompt:L,tokenId:X.toString(),size:y,mode:Ut};Ie&&x&&(Pe.referenceImage=x);const ie=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Pe)});if(!ie.ok)throw new Error(`Error: ${ie.status} ${ie.statusText}`);const xe=await ie.json();console.log("Image generation completed",xe);const Z=xe.image_url;c(Z),h(Z),l("generated"),q("idle");try{const Bt=await(await fetch(Z)).blob(),Dt=(await new Promise((Mt,Ot)=>{const le=new FileReader;le.onload=()=>Mt(le.result),le.onerror=Ot,le.readAsDataURL(Bt)})).split(",")[1];w(Dt)}catch(ce){console.warn("Failed to convert generated image to base64:",ce)}const zt={name:`AI Generated Artwork #${X}`,description:`AI generated artwork based on the prompt: "${L}"`,image:Z,external_url:xe.metadata_url||"",attributes:[{trait_type:"Prompt",value:L},{trait_type:"Generation Method",value:"AI Generated"}]};a?.(X,Z,zt),setTimeout(()=>{O(""),T("1024x1024"),c(void 0),o(void 0),k(null)},3e3)}catch(g){console.error("Error:",g);const $=g instanceof Error?g.message:Qe;k($),q("error"),n?.($)}finally{F(!1)}},kt=r({label:"imagegen.mintingInfo"}),It=d=>["image/jpeg","image/png"].includes(d.type)?d.size>10485760?(k(ot),!1):!0:(k(rt),!1),Se=async d=>{if(It(d)){k(null),F(!0);try{const g=await pa(d,1024);w(g.base64),P(g.mimeType),l("reference");const $=Math.round(d.size/1024),V=Math.round(g.base64.length*.75/1024);console.log(`Image compressed: ${$}KB → ${V}KB (${d.type} → ${g.mimeType})`)}catch(g){console.error("Image compression failed:",g);const $=g instanceof Error?g.message:ct;k(`${it}: ${$}`)}finally{F(!1)}}},Pt=d=>{d.preventDefault(),d.stopPropagation()},Lt=d=>{d.preventDefault(),d.stopPropagation()},Et=d=>{d.preventDefault(),d.stopPropagation();const g=Array.from(d.dataTransfer.files);g.length>0&&Se(g[0])},At=d=>{const g=d.target.files;g&&g.length>0&&Se(g[0])},$t=()=>{w(null),P("image/jpeg");const d=document.getElementById("reference-image-input");d&&(d.value=""),l(f?"generated":"empty")},ke=y==="1792x1024"?"wide":"square",Ft=()=>{R()};return e.jsx("div",{className:u({transition:"all 0.5s ease-in-out",overflow:"hidden"}),children:S?e.jsx("div",{className:M.compactLayout,children:e.jsxs("div",{className:M.compactContainer,children:[e.jsx("div",{className:M.compactHeader,children:e.jsxs("h3",{className:M.compactTitle,children:["🎨",e.jsx(Fe,{label:"imagegen.title"})]})}),e.jsxs("div",{className:M.compactForm,children:[e.jsxs("div",{"data-testid":"drop-zone",className:u({mb:"4",border:"1px solid",borderColor:v==="empty"?"gray.300":"gray.400",borderRadius:"md",bg:v==="empty"?"gray.50":"white",position:"relative",cursor:v==="empty"?"pointer":"default",overflow:"hidden",width:"100%",_hover:v==="empty"?{borderColor:"gray.400",bg:"gray.100"}:{}}),onDragOver:Pt,onDragEnter:Lt,onDrop:Et,onClick:()=>{v==="empty"&&document.getElementById("reference-image-input")?.click()},children:[e.jsx("input",{id:"reference-image-input","data-testid":"reference-image-input",type:"file",accept:"image/*",onChange:At,className:u({position:"absolute",opacity:0,width:0,height:0,pointerEvents:"none"})}),v==="empty"&&e.jsxs("div",{className:u({display:"flex",alignItems:"center",justifyContent:"center",py:"6",px:"4",gap:"3"}),children:[e.jsx("div",{className:u({fontSize:"xl",color:"gray.500"}),children:"📸"}),e.jsxs("div",{className:u({textAlign:"left"}),children:[e.jsx("h4",{className:u({fontSize:"sm",fontWeight:"medium",color:"gray.700",mb:"1"}),children:Ve}),e.jsxs("p",{className:u({fontSize:"xs",color:"gray.500",mb:"0"}),children:[Xe," • ",Ze]})]})]}),v==="reference"&&x&&e.jsxs("div",{className:u({p:"3"}),children:[e.jsxs("div",{className:u({display:"flex",justifyContent:"space-between",alignItems:"center",mb:"3"}),children:[e.jsx("h4",{className:u({fontSize:"sm",fontWeight:"medium",color:"gray.700",m:0}),children:et}),e.jsxs("button",{onClick:d=>{d.stopPropagation(),$t()},className:u({px:"2",py:"1",fontSize:"xs",bg:"gray.600",color:"white",border:"none",borderRadius:"sm",cursor:"pointer",_hover:{bg:"gray.700"}}),children:["✕ ",Ne]})]}),e.jsx("div",{className:u({position:"relative",width:"100%",height:ke==="wide"?"250px":"200px",overflow:"hidden",borderRadius:"sm",bg:"gray.100"}),children:e.jsx("img",{src:`data:${C};base64,${x}`,alt:at,className:u({width:"100%",height:"100%",objectFit:"contain",borderRadius:"sm"})})}),e.jsx("p",{className:u({fontSize:"xs",color:"gray.500",textAlign:"center",mt:"2",mb:"0"}),children:st})]}),v==="generated"&&f&&e.jsxs("div",{className:u({p:"3"}),children:[e.jsxs("div",{className:u({display:"flex",justifyContent:"space-between",alignItems:"center",mb:"3"}),children:[e.jsx("h4",{className:u({fontSize:"sm",fontWeight:"medium",color:"gray.700",m:0}),children:tt}),e.jsx("div",{className:u({display:"flex",gap:"2"}),children:e.jsxs("button",{onClick:()=>{w(null),P("image/jpeg"),h(void 0),l("empty");const d=document.getElementById("reference-image-input");d&&(d.value="")},className:u({px:"2",py:"1",fontSize:"xs",bg:"gray.600",color:"white",border:"none",borderRadius:"sm",cursor:"pointer",_hover:{bg:"gray.700"}}),disabled:N||A!=="idle",children:["✕ ",Ne]})})]}),e.jsx("div",{className:u({position:"relative",width:"100%",height:ke==="wide"?"250px":"200px",overflow:"hidden",borderRadius:"sm",bg:"gray.100"}),children:e.jsx("img",{src:f,alt:nt,className:u({width:"100%",height:"100%",objectFit:"contain",borderRadius:"sm"})})})]})]}),e.jsx("textarea",{value:L,onChange:d=>O(d.target.value),placeholder:v==="reference"?He:_e,disabled:N||A!=="idle"||z,className:M.compactTextarea}),e.jsxs("div",{className:M.controlBar,children:[e.jsxs("div",{className:M.optionsGroup,children:[e.jsxs("select",{id:"imageSizeSelect",value:y,onChange:d=>T(d.target.value),disabled:N||A!=="idle"||z,className:M.compactSelect,"aria-label":"Select image format for your artwork",children:[e.jsx("option",{value:"1024x1024",children:ht}),e.jsx("option",{value:"1792x1024",children:pt})]}),e.jsxs("label",{className:p.checkboxLabel,title:E?"NFT will be publicly visible in the 'All Public Artworks' gallery":"NFT will remain unlisted from the 'All Public Artworks' gallery",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:d=>_(d.target.checked),disabled:N||A!=="idle"||z,className:p.checkbox}),e.jsx(Fe,{label:"imagegen.listed"})]})]}),e.jsx(Ct,{})]})]}),e.jsxs("div",{className:u({mt:"2",fontSize:"xs",color:"gray.600",textAlign:"center"}),children:[wt," ",e.jsx("a",{href:"https://optimism.io",target:"_blank",rel:"noopener noreferrer","aria-label":vt,className:u({color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"}}),children:"Optimism"})," ","•"," ",e.jsxs("a",{href:`https://optimistic.etherscan.io/address/${I.address}`,target:"_blank",rel:"noopener noreferrer","aria-label":jt,className:u({color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"}}),children:[Tt," ↗"]})]}),e.jsx("span",{id:"create-artwork-info",className:u({position:"absolute",left:"-9999px",top:"auto",width:"1px",height:"1px",overflow:"hidden"}),children:ft}),e.jsxs("div",{className:u({display:{base:"block",md:"none"},mt:"2",fontSize:"xs",color:"gray.600",textAlign:"center"}),children:[e.jsx($e,{size:"xs",className:u({mr:"1"})}),kt]}),A!=="idle"&&e.jsxs("div",{className:M.compactStatus,children:[e.jsx("div",{className:ee}),e.jsx("span",{children:A==="minting"?lt:dt})]}),H&&e.jsx("div",{className:M.compactError,children:H}),i&&s&&e.jsxs("div",{className:Vt,children:[e.jsx("h4",{className:u({margin:0,fontSize:"sm"}),children:xt}),e.jsxs("p",{className:u({margin:"xs 0",fontSize:"sm"}),children:["ID: ",i.toString()," - ",bt]})]})]})}):e.jsxs("div",{className:u({maxWidth:"500px",margin:"0 auto",textAlign:"center"}),children:[e.jsxs("h3",{className:u({fontSize:"2xl",fontWeight:"semibold",marginBottom:"4",color:"gray.800"}),children:["🎨 ",mt]}),e.jsx("div",{className:u({fontSize:"md",fontWeight:"medium",color:"gray.800",mb:"3",textAlign:"center"}),children:ut}),e.jsx("p",{className:u({fontSize:"sm",color:"gray.600",mb:"lg",lineHeight:"1.5"}),children:gt}),e.jsx("div",{className:u({display:"flex",justifyContent:"center"}),children:e.jsx("button",{onClick:Ft,className:me,children:D})})]})})}function Re({label:t,isActive:a,onClick:n}){return e.jsx("button",{className:`${K.tab} ${a?K.activeTab:""}`,onClick:n,"aria-selected":a,children:t})}function ba({message:t,type:a,duration:n,onClose:s}){const c=m.useRef(null);m.useEffect(()=>{const f=n??(a==="error"?4e3:a==="warning"?5e3:3e3);return c.current=setTimeout(()=>{s()},f),()=>{c.current&&clearTimeout(c.current)}},[n,a,s]);const i=()=>{switch(a){case"success":return"✅";case"warning":return"⚠️";case"error":default:return"❌"}};return e.jsx("div",{className:de.container,children:e.jsxs("div",{className:de.content,"data-type":a,children:[e.jsx("span",{className:de.icon,children:i()}),e.jsx("span",{className:de.message,children:t})]})})}function De(){const[t,a]=m.useState(null),n=(i,o="error",f)=>{a({message:i,type:o,duration:f})},s=()=>{a(null)},c=t?e.jsx(ba,{message:t.message,type:t.type,duration:t.duration,onClose:s}):null;return{showToast:n,hideToast:s,ToastComponent:c}}function ya({genImTokenId:t}){const[a,n]=m.useState(!1),{isConnected:s}=te(),c=ze(),{writeContract:i,isPending:o,data:f,error:h}=ue(),{isLoading:x,isSuccess:w}=we({hash:f}),C=ge(),P=c===C.id,B=r({label:"imagegen.collect"}),{data:S,error:v,isPending:l,refetch:L}=he({...Ee,functionName:"getMintStats",args:[t],chainId:C.id}),O=async()=>{if(!s||!P||!S||!Array.isArray(S))return;n(!0);const[,E]=S;i({...Ee,functionName:"mintCollectorNFT",args:[t],value:E})};m.useEffect(()=>{w&&(n(!1),setTimeout(()=>{L()},2e3)),h&&n(!1)},[w,h,L]);const y=()=>{if(l)return"...";if(v||!S||!Array.isArray(S))return"0";const[E]=S;return E.toString()},T=()=>{if(l||v||!S||!Array.isArray(S))return"Price loading...";const[E,_]=S,N=Le(_),F=J=>{const z=parseFloat(J);return z>=.001?z.toFixed(3):z>=1e-4?z.toFixed(4):z.toFixed(6)},A=F(N),q=Number(E),H=Math.ceil((q+1)/5)*5,G=_/BigInt(2**Math.floor(q/5))*BigInt(2**Math.floor(H/5)),Y=F(Le(G));return`Current price: ${A} ETH | Price after ${H} mints: ${Y} ETH`};return e.jsx("button",{onClick:O,disabled:!s||a||o||x||!P,className:`${p.actionButton} ${me}`,title:`Collect this NFT (${y()} collected) | ${T()}`,children:a||o?"📦 Collecting...":w?"✅ Collected!":`📦 ${B} (${y()})`})}function Me({tokenId:t,onImageClick:a,onNftBurned:n,onListedStatusChanged:s,isHighlighted:c=!1,isPublicView:i=!1,preloadedImageUrl:o,preloadedMetadata:f}){const{writeContract:h,isPending:x,data:w}=ue(),{writeContract:C,isPending:P,data:B}=ue(),[S,v]=m.useState(!1),[l,L]=m.useState({tokenId:t,tokenURI:"",imageUrl:o,metadata:f,isLoading:!o}),[O,y]=m.useState(""),{showToast:T,ToastComponent:E}=De(),_=r({label:"imagegen.listed"}),N=r({label:"imagegen.download"}),F=r({label:"imagegen.delete"}),A=Be(),q=async b=>{try{if(b.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",b),null;const j=await fetch(b);if(!j.ok)throw new Error(`Failed to fetch metadata: ${j.status}`);return await j.json()}catch(j){return console.error("Error fetching NFT metadata:",j),null}};m.useEffect(()=>{(async()=>{try{L(U=>({...U,isLoading:!0,error:void 0}));const R=await A.readContract({address:I.address,abi:I.abi,functionName:"tokenURI",args:[t]});if(!R&&(o||f)){L(U=>({...U,tokenURI:"",isLoading:!1}));return}let D="";i&&(D=await A.readContract({address:I.address,abi:I.abi,functionName:"ownerOf",args:[t]}),y(D));let se;if(!i)try{se=await Te(ye,{...I,functionName:"isTokenListed",args:[t]})}catch(U){console.warn("Could not load listing status:",U)}let re=f,oe=o;if(R){const U=await q(R);U&&(re=U,oe=U.image)}L({tokenId:t,tokenURI:R,metadata:re,imageUrl:oe,isLoading:!1,isListed:se})}catch(j){console.error(`Error loading NFT ${t}:`,j),L({tokenId:t,tokenURI:"",imageUrl:o,metadata:f,isLoading:!1,error:`Failed to load NFT #${t}: ${j instanceof Error?j.message:"Unknown error"}`})}})()},[t,i,o,f,A]);const{isLoading:H,isSuccess:k}=we({hash:w}),{isLoading:G,isSuccess:Y}=we({hash:B});m.useEffect(()=>{k&&setTimeout(()=>{n()},1e3)},[k,n]),m.useEffect(()=>{Y&&s&&T("Listing status updated successfully!","success")},[Y,s,T]);const J=()=>{l.imageUrl&&a({src:l.imageUrl,alt:l.metadata?.name||`Artwork #${l.tokenId}`,title:l.metadata?.name,description:l.metadata?.description})},z=async()=>{if(l.imageUrl)try{const j=await(await fetch(l.imageUrl)).blob(),R=window.URL.createObjectURL(j),D=document.createElement("a");D.href=R,D.download=`${l.metadata?.name||`Artwork-${l.tokenId}`}.png`,document.body.appendChild(D),D.click(),document.body.removeChild(D),window.URL.revokeObjectURL(R)}catch(b){console.error("Download failed:",b),T("Download failed. Please try again.","error")}},ae=async()=>{const j=`https://opensea.io/item/optimism/${I.address}/${l.tokenId}`;try{await navigator.clipboard.writeText(j),T("OpenSea URL copied to clipboard!","success")}catch(R){console.error("Failed to copy URL:",R),window.open(j,"_blank","noopener,noreferrer")}},pe=async()=>{if(!S){v(!0),T(`⚠️ Click Delete again to permanently remove "${l.metadata?.name||`Artwork #${l.tokenId}`}"`,"warning"),setTimeout(()=>{v(!1)},5e3);return}v(!1);try{await h({...I,functionName:"burn",args:[l.tokenId]})}catch(b){console.error("Delete failed:",b),T("Failed to delete artwork. Please try again.","error")}},ne=async()=>{if(!s)return;const b=!l.isListed,j=b?"public":"private";try{s(l.tokenId,b),await C({...I,functionName:"setTokenListed",args:[l.tokenId,b]})}catch(R){console.error("Failed to update listing status:",R),s(l.tokenId,!b),T(`Failed to set artwork as ${j}. Please try again.`,"error")}};return e.jsxs("div",{className:`${p.container} ${c?p.highlighted:""} group`,onClick:J,children:[l.isLoading?e.jsxs("div",{className:p.loadingContainer,children:[e.jsx("div",{className:ee}),e.jsx("p",{className:p.loadingText,children:"Loading artwork..."})]}):l.error?e.jsxs("div",{className:p.errorContainer,children:[e.jsx("div",{className:p.errorBox,children:e.jsx("p",{className:p.errorText,children:l.error})}),e.jsxs("p",{className:p.tokenIdText,children:["ID: ",l.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[l.imageUrl?e.jsxs("div",{className:p.imageContainer,children:[e.jsx("img",{src:l.imageUrl,alt:l.metadata?.name||`Artwork #${l.tokenId}`,className:p.image,onError:b=>{const j=b.target;j.style.display="none",j.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:p.imageError,style:{display:"none"},children:"📷 Image not available"})]}):e.jsx("div",{className:p.imagePlaceholder,children:"📷 No image available"}),e.jsxs("div",{className:p.cornerBadge,children:["#",l.tokenId.toString()]}),!i&&l.isListed&&e.jsxs("div",{className:p.listedBadge,children:["✓ ",_]}),i&&O&&e.jsxs("div",{className:p.ownerBadge,children:["👤 ",O.slice(0,6),"...",O.slice(-4)]}),e.jsx("div",{className:p.actionsOverlay,children:e.jsxs("div",{className:p.actions,children:[l.imageUrl&&e.jsx("button",{onClick:b=>{b.stopPropagation(),z()},className:p.compactSecondaryButton,title:`${N} image`,children:"⬇️"}),l.imageUrl&&e.jsx("button",{onClick:b=>{b.stopPropagation(),J()},className:p.compactSecondaryButton,title:"View full size",children:"🔍"}),e.jsx("button",{onClick:b=>{b.stopPropagation(),ae()},className:p.compactSecondaryButton,title:"Share artwork",children:"📤"}),!i&&s&&l.isListed!==void 0&&e.jsx("button",{onClick:b=>{b.stopPropagation(),ne()},disabled:P||G,className:p.compactSecondaryButton,title:`${l.isListed?"Make private":"Make public"}`,children:l.isListed?"🔓":"🔒"}),i&&e.jsx(ya,{genImTokenId:l.tokenId}),!i&&e.jsx("button",{onClick:b=>{b.stopPropagation(),pe()},disabled:x||H,className:p.compactSecondaryButton,title:`${F} artwork (permanent)`,style:{backgroundColor:x||H?"rgba(0,0,0,0.3)":"rgba(220, 38, 38, 0.8)",opacity:x||H?.6:1},children:x||H?"⏳":"🗑️"})]})})]}),E]})}function Oe({image:t,onClose:a}){const{showToast:n,ToastComponent:s}=De();m.useEffect(()=>{const i=o=>{o.key==="Escape"&&a()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[a]);const c=async()=>{try{const o=await(await fetch(t.src)).blob(),f=window.URL.createObjectURL(o),h=document.createElement("a");h.href=f,h.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(f)}catch(i){console.error("Download failed:",i),n("Download failed. Please try again.","error")}};return e.jsxs("div",{className:p.modalOverlay,onClick:a,children:[e.jsxs("div",{className:p.modalContent,onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:p.modalClose,onClick:a,children:"✕"}),e.jsx("img",{src:t.src,alt:t.alt,className:p.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:p.modalInfo,children:[t.title&&e.jsx("h3",{className:p.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:p.modalDescription,children:t.description}),e.jsx("div",{className:p.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:c,className:`${p.actionButton} ${me}`,children:"⬇️ Download Full Size"})})]})]}),s]})}function wa({newlyCreatedNFT:t,onNewNFTDisplayed:a}){const{address:n,isConnected:s}=te(),c=ge(),[i,o]=m.useState([]),[f,h]=m.useState(!1),[x,w]=m.useState(null),[C,P]=m.useState(null),{data:B,isLoading:S}=he({...I,functionName:"balanceOf",args:n?[n]:void 0,chainId:c.id,query:{enabled:!!n&&s}}),v=m.useCallback(async()=>{if(!s||!n){o([]);return}h(!0);try{const y=await Te(ye,{...I,functionName:"balanceOf",args:[n]});if(!y||y===0n){o([]);return}const T=[];for(let N=0;N<Number(y);N++){const F=(async()=>{try{return await Te(ye,{...I,functionName:"tokenOfOwnerByIndex",args:[n,BigInt(N)]})}catch(A){return console.error(`Error loading token ID at index ${N}:`,A),0n}})();T.push(F)}const _=(await Promise.all(T)).filter(N=>N>0n).sort((N,F)=>F>N?1:F<N?-1:0);o(_)}catch(y){console.error("Error loading token IDs:",y),o([])}finally{h(!1)}},[s,n]),l=m.useCallback(y=>{w(y),o(T=>T.includes(y)?T:[y,...T]),setTimeout(()=>{w(null),a?.()},5e3)},[a]),L=m.useCallback((y,T)=>{console.log(`NFT ${y} listing status changed to: ${T}`)},[]);m.useEffect(()=>{s&&n&&v()},[n,s,v]),m.useEffect(()=>{t&&l(t.tokenId)},[t,l]);const O=S||f;return s?O&&i.length===0?e.jsxs("div",{className:W.loadingContainer,children:[e.jsx("div",{className:ee}),e.jsx("p",{children:"Loading your artworks..."})]}):B===0n||!B?e.jsx("div",{className:W.emptyStateContainer,children:e.jsx("p",{className:W.emptyStateText,children:"You haven't created any artworks yet. Use the generator above to create your first one!"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:W.grid,children:i.map((y,T)=>{const E=t?.tokenId===y,_=E?t.imageUrl:void 0,N=E?t.metadata:void 0;return e.jsx(Me,{tokenId:y,onImageClick:P,onNftBurned:()=>v(),onListedStatusChanged:L,isHighlighted:x===y,isPublicView:!1,preloadedImageUrl:_,preloadedMetadata:N},`my-${y}-${T}`)})}),C&&e.jsx(Oe,{image:C,onClose:()=>P(null)})]}):e.jsxs("div",{className:W.walletPrompt,children:[e.jsx("h3",{children:"🔗 Connect Your Wallet"}),e.jsx("p",{children:"To view and manage your personal NFT artworks, please connect your wallet using the button above."}),e.jsx("p",{children:"Your artworks are stored on the blockchain and linked to your wallet address."}),e.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9em",opacity:.8},children:"💡 Tip: You can explore public artworks from other users in the “All Public Artworks” tab without connecting your wallet."})]})}function Ta(){const[t,a]=m.useState([]),[n,s]=m.useState(!1),[c,i]=m.useState(null),o=Be(),f=m.useCallback(async()=>{s(!0);try{const h=await o.readContract({address:I.address,abi:I.abi,functionName:"getAllPublicTokens"});if(!h||h.length===0){a([]);return}const x=h.sort((w,C)=>C>w?1:C<w?-1:0);a(x)}catch(h){console.error("Error loading public token IDs:",h),a([])}finally{s(!1)}},[o]);return m.useEffect(()=>{f()},[f]),n&&t.length===0?e.jsxs("div",{className:W.loadingContainer,children:[e.jsx("div",{className:ee}),e.jsx("p",{children:"Loading public artworks..."})]}):t.length===0?e.jsx("div",{className:W.emptyStateContainer,children:e.jsx("p",{className:W.emptyStateText,children:"No public artworks available yet."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:W.grid,children:t.map((h,x)=>e.jsx(Me,{tokenId:h,onImageClick:i,onNftBurned:()=>{},isHighlighted:!1,isPublicView:!0},`public-${h}-${x}`))}),c&&e.jsx(Oe,{image:c,onClose:()=>i(null)})]})}function va({newlyCreatedNFT:t,onNewNFTDisplayed:a,activeTab:n,onTabChange:s}={}){const{address:c,isConnected:i}=te(),[o,f]=m.useState(()=>i?"my":"public"),h=n??o,x=s??f,w=he({...I,functionName:"balanceOf",args:c?[c]:void 0,chainId:ge().id,query:{enabled:!!c&&i}}),{data:C,refetch:P}=w;m.useEffect(()=>{t&&P&&P()},[t,P]);const B=r({label:"imagegen.myArtworks"}),S=r({label:"imagegen.allPublicArtworks"});return e.jsxs("div",{className:W.container,children:[e.jsx("div",{className:K.container,children:e.jsxs("div",{className:K.tabList,children:[e.jsx(Re,{label:i?`${B} (${C?.toString()||"0"})`:B,isActive:h==="my",onClick:()=>x("my")}),e.jsx(Re,{label:S,isActive:h==="public",onClick:()=>x("public")})]})}),e.jsx("div",{className:`${K.tabPanel} ${h==="my"?"":K.hiddenPanel}`,children:e.jsx(wa,{newlyCreatedNFT:t,onNewNFTDisplayed:a})}),e.jsx("div",{className:`${K.tabPanel} ${h==="public"?"":K.hiddenPanel}`,children:e.jsx(Ta,{})})]})}function ja(){const{isConnected:t}=te(),[a,n]=m.useState(null),[s,c]=m.useState(()=>t?"my":"public"),i=(x,w,C)=>{console.log("Image generation succeeded:",{tokenId:x,imageUrl:w,metadata:C}),n({tokenId:x,imageUrl:w,metadata:C}),t&&c("my")},o=x=>{console.error("Image generation failed:",x)},f=()=>{n(null)},h=x=>{c(x)};return e.jsxs("div",{className:Zt,children:[e.jsx(xa,{onSuccess:i,onError:o}),e.jsx(va,{newlyCreatedNFT:a??void 0,onNewNFTDisplayed:f,activeTab:s,onTabChange:h})]})}const Na=Object.freeze(Object.defineProperty({__proto__:null,default:ja},Symbol.toStringTag,{value:"Module"}));function Ca(){return"AI Image Generator | fretchen.eu"}const Sa=Object.freeze(Object.defineProperty({__proto__:null,title:Ca},Symbol.toStringTag,{value:"Module"})),Ba={serverOnlyHooks:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:oa}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ra}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:sa}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Na}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:na}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Sa}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:aa}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ta}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ea}}};export{Ba as configValuesSerialized};
