import{r as g,e as O,j as e,f as y,s as F,g as Y,h as M,n as L,k as R,l as n,m as _,q,t as Z,c as J,v as K,F as Q,i as X,W as ee,L as te,a as ae,b as ne,o as oe}from"../chunks/chunk-CoH0I7y2.js";import{u as G,g as W,a as B,b as H,r as z,c as re}from"../chunks/chunk-BqQ6Il-Z.js";/* empty css                      */import"../chunks/chunk-DQ3hQvvF.js";/* empty css                      *//* empty css                      */const se=async t=>new Promise((l,a)=>{const o=async()=>{try{const u=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});u?l(u):setTimeout(o,2e3)}catch(u){a(u)}};o()});function ie({apiUrl:t="https://mypersonaljscloudivnad9dy-readnftv2.functions.fnc.fr-par.scw.cloud",onSuccess:l,onError:a}){const o=B(),[u,c]=g.useState(),[m,v]=g.useState(),[x,I]=g.useState(""),[N,U]=g.useState(!1),[S,j]=g.useState("idle"),[w,k]=g.useState(null),{address:p,isConnected:d}=O(),h=W(),{data:s}=G({...o,functionName:"mintPrice",args:[],...(h==null?void 0:h.id)&&{chainId:h.id}}),{writeContractAsync:i}=H(),C=async()=>{if(!d||!p){const r="Please connect your account first";k(r),a==null||a(r);return}if(!x.trim()){const r="Please enter a prompt";k(r),a==null||a(r);return}if(!s){const r="Could not load creation fee from system";k(r),a==null||a(r);return}U(!0),k(null),j("minting");try{const r=`ipfs://tempURI/${Date.now()}`,b=await i({...o,functionName:"safeMint",args:[r],value:s,...(h==null?void 0:h.id)&&{chainId:h.id}});console.log("Minting transaction sent:",b);const f=await se(b),T=f==null?void 0:f.logs.find(V=>V.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!T||T.topics.length<4)throw new Error("Could not extract artwork ID from transaction");const D=T.topics[3],P=BigInt(D);console.log("Created artwork ID:",P),v(P),j("generating");const $=await fetch(`${t}?prompt=${encodeURIComponent(x)}&tokenId=${P}`);if(!$.ok)throw new Error(`Error: ${$.status} ${$.statusText}`);const E=await $.json();console.log("Image generation completed",E);const A=E.image_url;c(A),j("idle"),l==null||l(P,A),setTimeout(()=>{I(""),c(void 0),v(void 0),k(null)},3e3)}catch(r){console.error("Error:",r);const b=r instanceof Error?r.message:"An unknown error occurred";k(b),j("error"),a==null||a(b)}finally{U(!1)}};return e.jsx("div",{className:y.compactLayout,children:e.jsxs("div",{className:y.compactContainer,children:[e.jsxs("div",{className:y.compactHeader,children:[e.jsx("h3",{className:y.compactTitle,children:"Create Your Art"}),e.jsx("span",{className:y.compactSubtitle,children:"Describe what you want and generate your unique digital artwork (~10Â¢)"})]}),e.jsxs("div",{className:y.compactForm,children:[e.jsx("textarea",{value:x,onChange:r=>I(r.target.value),placeholder:"Describe your image in detail... (e.g., 'A futuristic city skyline at sunset')",disabled:N||S!=="idle",className:y.compactTextarea}),e.jsx("button",{onClick:C,disabled:N||!x.trim()||!d,className:`${y.compactButton} ${N||!x.trim()||!d?y.compactButtonDisabled:""}`,children:N?S==="minting"?"Creating...":"Generating...":"ðŸŽ¨ Create Art"})]}),S!=="idle"&&e.jsxs("div",{className:y.compactStatus,children:[e.jsx("div",{className:F}),e.jsx("span",{children:S==="minting"?"Creating your artwork...":"Generating image..."})]}),!d&&e.jsx("div",{className:y.compactError,children:"Connect your account to create artwork"}),w&&e.jsx("div",{className:y.compactError,children:w}),m&&u&&e.jsxs("div",{className:Y,children:[e.jsx("h4",{className:M({margin:0,fontSize:"sm"}),children:"âœ… Artwork created successfully!"}),e.jsxs("p",{className:M({margin:"xs 0",fontSize:"sm"}),children:["ID: ",m.toString()," - Check your gallery below"]})]})]})})}function le({newlyCreatedNFT:t,onNewNFTDisplayed:l}={}){const{address:a,isConnected:o}=O(),u=W(),c=B(),[m,v]=g.useState([]),[x,I]=g.useState(!1),[N,U]=g.useState(null),[S,j]=g.useState(null),{data:w,isLoading:k}=G({...c,functionName:"balanceOf",args:a?[a]:void 0,chainId:u.id,query:{enabled:!!a&&o}}),p=async s=>{try{if(s.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",s),null;const i=await fetch(s);if(!i.ok)throw new Error(`Failed to fetch metadata: ${i.status}`);return await i.json()}catch(i){return console.error("Error fetching NFT metadata:",i),null}},d=async()=>{if(!o||!a){v([]);return}I(!0);try{const s=await z(R,{...c,functionName:"balanceOf",args:[a]});if(!s||s===0n){v([]);return}const i=Array.from({length:Number(s)},()=>({tokenId:0n,tokenURI:"",isLoading:!0}));v(i);const C=[];for(let f=0;f<Number(s);f++){const T=(async()=>{try{const P=await z(R,{...c,functionName:"tokenOfOwnerByIndex",args:[a,BigInt(f)]}),E=await z(R,{...c,functionName:"tokenURI",args:[P]}),A=await p(E);return{tokenId:P,tokenURI:E,metadata:A||void 0,imageUrl:A==null?void 0:A.image,isLoading:!1}}catch(D){return console.error(`Error loading NFT at index ${f}:`,D),{tokenId:0n,tokenURI:"",isLoading:!1,error:`Failed to load NFT #${f}: ${D instanceof Error?D.message:"Unknown error"}`}}})();C.push(T)}const b=(await Promise.all(C)).sort((f,T)=>f.error&&!T.error?1:!f.error&&T.error?-1:f.error&&T.error?0:Number(T.tokenId-f.tokenId));v(b)}catch(s){console.error("Error loading NFTs:",s),v([])}finally{I(!1)}};if(g.useEffect(()=>{o&&a&&d()},[a,o,w]),g.useEffect(()=>{if(t){U(t.tokenId);const s={tokenId:t.tokenId,tokenURI:"",imageUrl:t.imageUrl,isLoading:!1};v(i=>{const C=i.findIndex(r=>r.tokenId===t.tokenId);if(C!==-1){const r=[...i];return r[C]={...r[C],imageUrl:t.imageUrl},r}else return[s,...i]}),setTimeout(()=>{U(null),l==null||l()},5e3)}},[t,l]),!o)return e.jsx("div",{className:L.walletPrompt,children:e.jsx("p",{children:"Connect your account to view your artworks"})});const h=k||x;return e.jsxs("div",{className:L.container,children:[e.jsx("div",{className:L.heading,children:e.jsxs("h2",{className:y.columnHeading,children:["Your Digital Artworks (",(w==null?void 0:w.toString())||"0",")"]})}),h&&m.length===0?e.jsxs("div",{className:L.loadingContainer,children:[e.jsx("div",{className:F}),e.jsx("p",{children:"Loading your artworks..."})]}):w===0n||!w?e.jsx("div",{className:L.emptyStateContainer,children:e.jsx("p",{className:L.emptyStateText,children:"You haven't created any artworks yet. Use the generator above to create your first one!"})}):e.jsx("div",{className:L.grid,children:m.map((s,i)=>e.jsx(ce,{nft:s,onImageClick:j,onNftBurned:()=>d(),isHighlighted:N===s.tokenId},`${s.tokenId}-${i}`))}),S&&e.jsx(de,{image:S,onClose:()=>j(null)})]})}function ce({nft:t,onImageClick:l,onNftBurned:a,isHighlighted:o=!1}){var j,w,k;const{writeContract:u,isPending:c,data:m}=H(),v=B(),{isLoading:x,isSuccess:I}=re({hash:m});g.useEffect(()=>{I&&setTimeout(()=>{a()},1e3)},[I,a]);const N=()=>{var p,d,h;t.imageUrl&&l({src:t.imageUrl,alt:((p=t.metadata)==null?void 0:p.name)||`Artwork #${t.tokenId}`,title:(d=t.metadata)==null?void 0:d.name,description:(h=t.metadata)==null?void 0:h.description})},U=async()=>{var p;if(t.imageUrl)try{const h=await(await fetch(t.imageUrl)).blob(),s=window.URL.createObjectURL(h),i=document.createElement("a");i.href=s,i.download=`${((p=t.metadata)==null?void 0:p.name)||`Artwork-${t.tokenId}`}.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}catch(d){console.error("Download failed:",d),alert("Download failed. Please try again.")}},S=async()=>{var p;if(confirm(`Are you sure you want to permanently delete "${((p=t.metadata)==null?void 0:p.name)||`Artwork #${t.tokenId}`}"? This action cannot be undone.`))try{await u({...v,functionName:"burn",args:[t.tokenId]})}catch(d){console.error("Delete failed:",d),alert("Failed to delete artwork. Please try again.")}};return e.jsx("div",{className:`${n.container} ${o?n.highlighted:""}`,children:t.isLoading?e.jsxs("div",{className:n.loadingContainer,children:[e.jsx("div",{className:F}),e.jsx("p",{className:n.loadingText,children:"Loading artwork..."})]}):t.error?e.jsxs("div",{className:n.errorContainer,children:[e.jsx("div",{className:n.errorBox,children:e.jsx("p",{className:n.errorText,children:t.error})}),e.jsxs("p",{className:n.tokenIdText,children:["ID: ",t.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[t.imageUrl?e.jsxs("div",{className:n.imageContainer,children:[e.jsx("img",{src:t.imageUrl,alt:((j=t.metadata)==null?void 0:j.name)||`Artwork #${t.tokenId}`,className:n.image,onClick:N,style:{cursor:"pointer"},onError:p=>{const d=p.target;d.style.display="none",d.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:n.imageError,style:{display:"none"},children:"Image not available"})]}):e.jsx("div",{className:n.imagePlaceholder,children:"No image available"}),e.jsx("h3",{className:n.title,children:((w=t.metadata)==null?void 0:w.name)||`Artwork #${t.tokenId}`}),((k=t.metadata)==null?void 0:k.description)&&e.jsx("p",{className:n.description,children:t.metadata.description}),e.jsx("div",{className:n.footer,children:e.jsxs("span",{children:["ID: ",t.tokenId.toString()]})}),e.jsxs("div",{className:n.actions,children:[t.imageUrl&&e.jsx("button",{onClick:N,className:`${n.actionButton} ${_}`,title:"View full size",children:"ðŸ” Zoom"}),t.imageUrl&&e.jsx("button",{onClick:U,className:`${n.actionButton} ${q}`,title:"Download image",children:"â¬‡ï¸ Download"}),e.jsx("button",{onClick:S,disabled:c||x,className:`${n.actionButton} ${c||x?_:Z}`,title:"Delete artwork (permanent)",style:{opacity:c||x?.6:1},children:c?"ðŸ—‘ï¸ Deleting...":x?"â³ Confirming...":"ðŸ—‘ï¸ Delete"})]})]})})}function de({image:t,onClose:l}){g.useEffect(()=>{const o=u=>{u.key==="Escape"&&l()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[l]);const a=async()=>{try{const u=await(await fetch(t.src)).blob(),c=window.URL.createObjectURL(u),m=document.createElement("a");m.href=c,m.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(c)}catch(o){console.error("Download failed:",o),alert("Download failed. Please try again.")}};return e.jsx("div",{className:n.modalOverlay,onClick:l,children:e.jsxs("div",{className:n.modalContent,onClick:o=>o.stopPropagation(),children:[e.jsx("button",{className:n.modalClose,onClick:l,children:"âœ•"}),e.jsx("img",{src:t.src,alt:t.alt,className:n.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:n.modalInfo,children:[t.title&&e.jsx("h3",{className:n.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:n.modalDescription,children:t.description}),e.jsx("div",{className:n.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:a,className:`${n.actionButton} ${q}`,children:"â¬‡ï¸ Download Full Size"})})]})]})})}function ue(){const[t,l]=g.useState(null),a=(c,m)=>{console.log("Image generation succeeded:",{tokenId:c,imageUrl:m}),l({tokenId:c,imageUrl:m})},o=c=>{console.error("Image generation failed:",c)},u=()=>{l(null)};return e.jsxs("div",{className:J,children:[e.jsx("h1",{className:K,children:"AI Image Creator"}),e.jsx(ie,{onSuccess:a,onError:o}),e.jsx(le,{newlyCreatedNFT:t??void 0,onNewNFTDisplayed:u})]})}const me=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),we={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:oe}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ne}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ae}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:me}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:te}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","title"]},valueSerialized:{type:"js-serialized",value:"Notes by fretchen"}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:ee}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:X}},queryClientConfig:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/config",fileExportPathToShowToUser:["default","queryClientConfig"]},valueSerialized:{type:"js-serialized",value:"!undefined"}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Q}}};export{we as configValuesSerialized};
