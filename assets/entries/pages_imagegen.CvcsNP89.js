import{aP as Ut,aQ as Rt,aR as Dt,O as De,r as d,P as zt,c as p,j as e,u as Bt,aS as Mt,aT as Ot,aU as _t,T as ae,aV as ze,U as Ht,S as o,aW as O,aX as h,aY as te,aZ as Wt,an as me,a_ as Gt,a$ as q,b0 as de,Q as Ee,b1 as qt,b2 as Te,b3 as H,g as Kt,F as Yt,a as Qt,W as Vt,d as Zt,e as Jt,f as Xt,o as ea}from"../chunks/chunk-iubO7ElD.js";import{u as ge,a as he,d as L,b as ue,c as ve,e as Ae,r as je}from"../chunks/chunk-_vEiFYHB.js";import{d as ta}from"../chunks/chunk-CT5atk_u.js";import{u as Be}from"../chunks/chunk-C-KNxlXY.js";/* empty css                      *//* empty css                      *//* empty css                      */import"../chunks/chunk-Bba-Woac.js";import"../chunks/chunk-BwHQL2DQ.js";let ye=[];function $e(t){const a=t.chains;return Ut(ye,a)?ye:(ye=a,a)}async function aa(t,a){const{addEthereumChainParameter:n,chainId:s}=a,c=t.state.connections.get(a.connector?.uid??t.state.current);if(c){const r=c.connector;if(!r.switchChain)throw new Rt({connector:r});return await r.switchChain({addEthereumChainParameter:n,chainId:s})}const i=t.chains.find(r=>r.id===s);if(!i)throw new Dt;return t.setState(r=>({...r,chainId:s})),i}function na(t,a){const{onChange:n}=a;return t._internal.chains.subscribe((s,c)=>{n(s,c)})}function sa(t){return{mutationFn(a){return aa(t,a)},mutationKey:["switchChain"]}}function ra(t={}){const a=De(t);return d.useSyncExternalStore(n=>na(a,{onChange:n}),()=>$e(a),()=>$e(a))}function oa(t={}){const{mutation:a}=t,n=De(t),s=sa(n),{mutate:c,mutateAsync:i,...r}=zt({...a,...s});return{...r,chains:ra({config:n}),switchChain:c,switchChainAsync:i}}function Fe({size:t="sm",className:a}){const n={xs:p({fontSize:"xs",lineHeight:"1"}),sm:p({fontSize:"sm",lineHeight:"1"}),md:p({fontSize:"md",lineHeight:"1"})},s=p({display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1em",height:"1em",borderRadius:"50%",backgroundColor:"blue.100",color:"blue.600",fontWeight:"bold",cursor:"help"});return e.jsx("span",{className:`${s} ${n[t]} ${a||""}`,role:"img","aria-label":"Information",children:"i"})}function Ue({label:t,locale:a}){const s=Bt(),c=a??s.locale??ta,r=Mt(c==="de"?Ot:_t,t);return e.jsx("span",{"data-locale":c,children:r})}const ia="https://mypersonaljscloudivnad9dy-genimgbfl.functions.fnc.fr-par.scw.cloud",ca=(t,a,n=1920)=>{const s=t/a;return t<=n&&a<=n?{width:t,height:a}:t>a?{width:n,height:Math.round(n/s)}:{width:Math.round(n*s),height:n}},la=(t,a=1024)=>new Promise((n,s)=>{const c=document.createElement("canvas"),i=c.getContext("2d"),r=new Image;r.onload=()=>{const{width:b,height:g}=ca(r.width,r.height);if(c.width=b,c.height=g,!i){s(new Error("Could not get canvas context"));return}i.fillStyle="white",i.fillRect(0,0,b,g),i.drawImage(r,0,0,b,g);let f=.9;const w=()=>{const C=c.toDataURL("image/jpeg",f);C.length*.75/1024<=a||f<=.1?n({base64:C.split(",")[1],mimeType:"image/jpeg"}):(f-=.1,setTimeout(w,0))};w()},r.onerror=()=>s(new Error("Failed to load image")),r.src=URL.createObjectURL(t)}),da=async t=>new Promise((a,n)=>{const s=async()=>{try{const c=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[t]});c?a(c):setTimeout(s,2e3)}catch(c){n(c)}};s()});function ma({apiUrl:t=ia,onSuccess:a,onError:n}){const[s,c]=d.useState(),[i,r]=d.useState(),[b,g]=d.useState(),[f,w]=d.useState(null),[C,E]=d.useState("image/jpeg"),[j,k]=d.useState("empty"),[P,l]=d.useState(""),[z,M]=d.useState("1024x1024"),[x,v]=d.useState(!1),[N,R]=d.useState(!1),[y,$]=d.useState("idle"),[W,I]=d.useState(null),{address:G,isConnected:Q}=ae(),B=he(),K=ze(),{switchChain:V,isPending:D}=oa(),{connectors:Z,connect:fe}=Ht(),{data:ne}=ge({...L,functionName:"mintPrice",args:[],...B?.id&&{chainId:B.id}}),{writeContractAsync:pe}=ue(),be=async m=>new Promise((u,A)=>{const J=()=>{K===m?u():setTimeout(J,100)};setTimeout(()=>{A(new Error(Ye))},1e4),J()}),S=()=>{Z.length>0&&fe({connector:Z[0]})},T=o({label:"imagegen.connectWalletButton"}),F=o({label:"imagegen.connectWalletTitle"}),_=o({label:"imagegen.enterPrompt"}),se=o({label:"imagegen.switchingNetwork"}),re=o({label:"imagegen.creating"}),oe=o({label:"imagegen.generating"}),U=o({label:"imagegen.createArtwork"}),He=o({label:"imagegen.promptPlaceholder"}),Ce=o({label:"imagegen.editImage"}),We=o({label:"imagegen.connectAccountFirst"}),Ge=o({label:"imagegen.switchToOptimism"}),qe=o({label:"imagegen.enterPromptError"}),Ke=o({label:"imagegen.loadMintPrice"}),Ye=o({label:"imagegen.chainSwitchTimeout"}),Qe=o({label:"imagegen.extractTokenId"}),Ve=o({label:"imagegen.unknownError"}),Ze=o({label:"imagegen.uploadReferenceImage"}),Je=o({label:"imagegen.dragDropHere"}),Xe=o({label:"imagegen.supportedFormats"}),et=o({label:"imagegen.referenceImageTitle"}),tt=o({label:"imagegen.generatedArtworkTitle"}),ke=o({label:"imagegen.remove"}),at=o({label:"imagegen.referenceImageAlt"}),nt=o({label:"imagegen.generatedArtworkAlt"}),st=o({label:"imagegen.referenceImageHint"}),rt=o({label:"imagegen.invalidFileType"}),ot=o({label:"imagegen.fileTooLarge"}),it=o({label:"imagegen.compressionFailed"}),ct=o({label:"imagegen.failedToProcessImage"}),lt=o({label:"imagegen.creatingArtwork"}),dt=o({label:"imagegen.generatingImage"}),mt=o({label:"imagegen.artworkCreated"}),ut=o({label:"imagegen.checkGallery"}),gt=o({label:"imagegen.switchingToOptimism"}),ht=o({label:"imagegen.poweredBy"}),ft=o({label:"imagegen.viewContract"}),pt=o({label:"imagegen.learnMoreOptimism"}),bt=o({label:"imagegen.viewContractEtherscan"}),xt=()=>D?"switching":N?"loading":Q?P.trim()?"ready":"needsPrompt":"connect",Se=m=>{switch(m){case"switching":return se;case"loading":return y==="minting"?re:oe;case"connect":return T;case"needsPrompt":return _;case"ready":return j!=="empty"?Ce:U;default:return j!=="empty"?Ce:U}},Y=xt(),wt=()=>e.jsxs("button",{onClick:S,className:`${me}`,title:F,"aria-describedby":"create-artwork-info",children:["🔗 ",T]}),yt=()=>{const m=Y==="needsPrompt",u=Y==="loading"||Y==="switching";return e.jsx("button",{onClick:Tt,disabled:m,className:`${me} ${m?Gt:""}`,title:o({label:"imagegen.mintingInfo"}),"aria-describedby":"create-artwork-info",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:te}),Se(Y)]}):e.jsxs(e.Fragment,{children:["🎨 ",Se(Y),e.jsx(Fe,{size:"xs",className:p({ml:"1",opacity:"0.7"})})]})})},Tt=async()=>{if(!Q||!G){const u=We;I(u),n?.(u);return}const m=B?.id;if(m&&K!==m)try{I(gt),await V({chainId:m}),await be(m),I(null)}catch(u){console.error("Failed to switch chain:",u);const A=u instanceof Error?u.message:Ge;I(A),n?.(A);return}if(!P.trim()){const u=qe;I(u),n?.(u);return}if(!ne){const u=Ke;I(u),n?.(u);return}R(!0),I(null),$("minting");try{const A=await pe({...L,functionName:"safeMint",args:["",x],value:ne,...B?.id&&{chainId:B.id}});console.log("Minting transaction sent:",A);const xe=(await da(A))?.logs.find(ce=>ce.topics[0]==="0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef");if(!xe||xe.topics.length<4)throw new Error(Qe);const It=xe.topics[3],X=BigInt(It);console.log("Created artwork ID:",X),r(X),$("generating");const Pe=f!==null,Pt=Pe?"edit":"generate",Le={prompt:P,tokenId:X.toString(),size:z,mode:Pt};Pe&&f&&(Le.referenceImage=f);const ie=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Le)});if(!ie.ok)throw new Error(`Error: ${ie.status} ${ie.statusText}`);const we=await ie.json();console.log("Image generation completed",we);const ee=we.image_url;c(ee),g(ee),k("generated"),$("idle");try{const Et=await(await fetch(ee)).blob(),At=(await new Promise(($t,Ft)=>{const le=new FileReader;le.onload=()=>$t(le.result),le.onerror=Ft,le.readAsDataURL(Et)})).split(",")[1];w(At)}catch(ce){console.warn("Failed to convert generated image to base64:",ce)}const Lt={name:`AI Generated Artwork #${X}`,description:`AI generated artwork based on the prompt: "${P}"`,image:ee,external_url:we.metadata_url||"",attributes:[{trait_type:"Prompt",value:P},{trait_type:"Generation Method",value:"AI Generated"}]};a?.(X,ee,Lt),setTimeout(()=>{l(""),M("1024x1024"),c(void 0),r(void 0),I(null)},3e3)}catch(u){console.error("Error:",u);const A=u instanceof Error?u.message:Ve;I(A),$("error"),n?.(A)}finally{R(!1)}},vt=o({label:"imagegen.mintingInfo"}),jt=m=>["image/jpeg","image/png"].includes(m.type)?m.size>10485760?(I(ot),!1):!0:(I(rt),!1),Ne=async m=>{if(jt(m)){I(null),R(!0);try{const u=await la(m,1024);w(u.base64),E(u.mimeType),k("reference");const A=Math.round(m.size/1024),J=Math.round(u.base64.length*.75/1024);console.log(`Image compressed: ${A}KB → ${J}KB (${m.type} → ${u.mimeType})`)}catch(u){console.error("Image compression failed:",u);const A=u instanceof Error?u.message:ct;I(`${it}: ${A}`)}finally{R(!1)}}},Ct=m=>{m.preventDefault(),m.stopPropagation()},kt=m=>{m.preventDefault(),m.stopPropagation()},St=m=>{m.preventDefault(),m.stopPropagation();const u=Array.from(m.dataTransfer.files);u.length>0&&Ne(u[0])},Nt=m=>{const u=m.target.files;u&&u.length>0&&Ne(u[0])},Ie=()=>{w(null),E("image/jpeg"),k("empty");const m=document.getElementById("reference-image-input");m&&(m.value="")};return e.jsx("div",{className:O.compactLayout,children:e.jsxs("div",{className:O.compactContainer,children:[e.jsx("div",{className:O.compactHeader,children:e.jsxs("h3",{className:O.compactTitle,children:["🎨",e.jsx(Ue,{label:"imagegen.title"})]})}),e.jsxs("div",{className:O.compactForm,children:[e.jsxs("div",{"data-testid":"drop-zone",className:p({mb:"4",p:"6",border:"2px dashed",borderColor:j==="empty"?"gray.300":"blue.400",borderRadius:"lg",bg:j==="empty"?"gray.50":"blue.50",position:"relative",transition:"all 0.2s ease",cursor:j==="empty"?"pointer":"default",_hover:{borderColor:j==="empty"?"blue.400":void 0,bg:j==="empty"?"blue.50":void 0}}),onDragOver:Ct,onDragEnter:kt,onDrop:St,onClick:()=>{j==="empty"&&document.getElementById("reference-image-input")?.click()},children:[e.jsx("input",{id:"reference-image-input","data-testid":"reference-image-input",type:"file",accept:"image/*",onChange:Nt,className:p({position:"absolute",opacity:0,width:0,height:0,pointerEvents:"none"})}),j==="empty"&&e.jsxs("div",{className:p({textAlign:"center",py:"8"}),children:[e.jsx("div",{className:p({fontSize:"3xl",mb:"2"}),children:"📸"}),e.jsx("h4",{className:p({fontSize:"lg",fontWeight:"semibold",color:"gray.700",mb:"2"}),children:Ze}),e.jsx("p",{className:p({fontSize:"sm",color:"gray.600",mb:"4"}),children:Je}),e.jsx("p",{className:p({fontSize:"xs",color:"gray.500"}),children:Xe})]}),j==="reference"&&f&&e.jsxs("div",{children:[e.jsxs("div",{className:p({display:"flex",justifyContent:"space-between",alignItems:"center",mb:"3"}),children:[e.jsx("h4",{className:p({fontSize:"sm",fontWeight:"semibold",color:"gray.700",m:0}),children:et}),e.jsxs("button",{onClick:m=>{m.stopPropagation(),Ie()},className:p({px:"2",py:"1",fontSize:"xs",bg:"red.500",color:"white",border:"none",borderRadius:"sm",cursor:"pointer",_hover:{bg:"red.600"}}),children:["✕ ",ke]})]}),e.jsx("div",{className:p({display:"flex",justifyContent:"center",maxHeight:"250px",overflow:"hidden",borderRadius:"md"}),children:e.jsx("img",{src:`data:${C};base64,${f}`,alt:at,className:p({maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:"md",boxShadow:"sm"})})}),e.jsx("p",{className:p({fontSize:"xs",color:"blue.600",textAlign:"center",mt:"2"}),children:st})]}),j==="generated"&&b&&e.jsxs("div",{children:[e.jsxs("div",{className:p({display:"flex",justifyContent:"space-between",alignItems:"center",mb:"3"}),children:[e.jsx("h4",{className:p({fontSize:"sm",fontWeight:"semibold",color:"gray.700",m:0}),children:tt}),e.jsx("div",{className:p({display:"flex",gap:"2"}),children:e.jsxs("button",{onClick:Ie,className:p({px:"2",py:"1",fontSize:"xs",bg:"red.500",color:"white",border:"none",borderRadius:"sm",cursor:"pointer",_hover:{bg:"red.600"}}),disabled:N||y!=="idle",children:["✕ ",ke]})})]}),e.jsx("div",{className:p({display:"flex",justifyContent:"center",maxHeight:"250px",overflow:"hidden",borderRadius:"md"}),children:e.jsx("img",{src:b,alt:nt,className:p({maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:"md",boxShadow:"sm"})})})]})]}),e.jsx("textarea",{value:P,onChange:m=>l(m.target.value),placeholder:He,disabled:N||y!=="idle"||D,className:O.compactTextarea}),e.jsxs("div",{className:O.controlBar,children:[e.jsxs("div",{className:O.optionsGroup,children:[e.jsxs("select",{id:"imageSizeSelect",value:z,onChange:m=>M(m.target.value),disabled:N||y!=="idle"||D,className:O.compactSelect,"aria-label":"Select image format for your artwork",children:[e.jsx("option",{value:"1024x1024",children:o({label:"imagegen.square"})}),e.jsx("option",{value:"1792x1024",children:o({label:"imagegen.wide"})})]}),e.jsxs("label",{className:h.checkboxLabel,title:x?"NFT will be publicly visible in the 'All Public Artworks' gallery":"NFT will remain unlisted from the 'All Public Artworks' gallery",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:m=>v(m.target.checked),disabled:N||y!=="idle"||D,className:h.checkbox}),e.jsx(Ue,{label:"imagegen.listed"})]})]}),Y==="connect"?e.jsx(wt,{}):e.jsx(yt,{})]})]}),e.jsxs("div",{className:p({mt:"2",fontSize:"xs",color:"gray.600",textAlign:"center"}),children:[ht," ",e.jsx("a",{href:"https://optimism.io",target:"_blank",rel:"noopener noreferrer","aria-label":pt,className:p({color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"}}),children:"Optimism"})," ","•"," ",e.jsxs("a",{href:`https://optimistic.etherscan.io/address/${L.address}`,target:"_blank",rel:"noopener noreferrer","aria-label":bt,className:p({color:"blue.600",textDecoration:"underline",_hover:{color:"blue.800"}}),children:[ft," ↗"]})]}),e.jsx("span",{id:"create-artwork-info",className:p({position:"absolute",left:"-9999px",top:"auto",width:"1px",height:"1px",overflow:"hidden"}),children:o({label:"imagegen.mintingInfo"})}),e.jsxs("div",{className:p({display:{base:"block",md:"none"},mt:"2",fontSize:"xs",color:"gray.600",textAlign:"center"}),children:[e.jsx(Fe,{size:"xs",className:p({mr:"1"})}),vt]}),y!=="idle"&&e.jsxs("div",{className:O.compactStatus,children:[e.jsx("div",{className:te}),e.jsx("span",{children:y==="minting"?lt:dt})]}),W&&e.jsx("div",{className:O.compactError,children:W}),i&&s&&e.jsxs("div",{className:Wt,children:[e.jsx("h4",{className:p({margin:0,fontSize:"sm"}),children:mt}),e.jsxs("p",{className:p({margin:"xs 0",fontSize:"sm"}),children:["ID: ",i.toString()," - ",ut]})]})]})})}function Re({label:t,isActive:a,onClick:n}){return e.jsx("button",{className:`${q.tab} ${a?q.activeTab:""}`,onClick:n,"aria-selected":a,children:t})}function ua({message:t,type:a,duration:n,onClose:s}){const c=d.useRef(null);d.useEffect(()=>{const b=n??(a==="error"?4e3:a==="warning"?5e3:3e3);return c.current=setTimeout(()=>{s()},b),()=>{c.current&&clearTimeout(c.current)}},[n,a,s]);const i=()=>{switch(a){case"success":return"✅";case"warning":return"⚠️";case"error":default:return"❌"}};return e.jsx("div",{className:de.container,children:e.jsxs("div",{className:de.content,"data-type":a,children:[e.jsx("span",{className:de.icon,children:i()}),e.jsx("span",{className:de.message,children:t})]})})}function Me(){const[t,a]=d.useState(null),n=(i,r="error",b)=>{a({message:i,type:r,duration:b})},s=()=>{a(null)},c=t?e.jsx(ua,{message:t.message,type:t.type,duration:t.duration,onClose:s}):null;return{showToast:n,hideToast:s,ToastComponent:c}}function ga({genImTokenId:t}){const[a,n]=d.useState(!1),{isConnected:s}=ae(),c=ze(),{writeContract:i,isPending:r,data:b,error:g}=ue(),{isLoading:f,isSuccess:w}=ve({hash:b}),C=he(),E=c===C.id,j=o({label:"imagegen.collect"}),{data:k,error:P,isPending:l,refetch:z}=ge({...Ae,functionName:"getMintStats",args:[t],chainId:C.id}),M=async()=>{if(!s||!E||!k||!Array.isArray(k))return;n(!0);const[,N]=k;i({...Ae,functionName:"mintCollectorNFT",args:[t],value:N})};d.useEffect(()=>{w&&(n(!1),setTimeout(()=>{z()},2e3)),g&&n(!1)},[w,g,z]);const x=()=>{if(l)return"...";if(P||!k||!Array.isArray(k))return"0";const[N]=k;return N.toString()},v=()=>{if(l||P||!k||!Array.isArray(k))return"Price loading...";const[N,R]=k,y=Ee(R),$=V=>{const D=parseFloat(V);return D>=.001?D.toFixed(3):D>=1e-4?D.toFixed(4):D.toFixed(6)},W=$(y),I=Number(N),G=Math.ceil((I+1)/5)*5,B=R/BigInt(2**Math.floor(I/5))*BigInt(2**Math.floor(G/5)),K=$(Ee(B));return`Current price: ${W} ETH | Price after ${G} mints: ${K} ETH`};return e.jsx("button",{onClick:M,disabled:!s||a||r||f||!E,className:`${h.actionButton} ${me}`,title:`Collect this NFT (${x()} collected) | ${v()}`,children:a||r?"📦 Collecting...":w?"✅ Collected!":`📦 ${j} (${x()})`})}function Oe({tokenId:t,onImageClick:a,onNftBurned:n,onListedStatusChanged:s,isHighlighted:c=!1,isPublicView:i=!1,preloadedImageUrl:r,preloadedMetadata:b}){const{writeContract:g,isPending:f,data:w}=ue(),{writeContract:C,isPending:E,data:j}=ue(),[k,P]=d.useState(!1),[l,z]=d.useState({tokenId:t,tokenURI:"",imageUrl:r,metadata:b,isLoading:!r}),[M,x]=d.useState(""),{showToast:v,ToastComponent:N}=Me(),R=o({label:"imagegen.artwork"}),y=o({label:"imagegen.listed"}),$=o({label:"imagegen.download"}),W=o({label:"imagegen.share"}),I=o({label:"imagegen.delete"}),G=Be(),Q=async S=>{try{if(S.startsWith("file://"))return console.warn("Cannot fetch file:// URLs in browser. Metadata:",S),null;const T=await fetch(S);if(!T.ok)throw new Error(`Failed to fetch metadata: ${T.status}`);return await T.json()}catch(T){return console.error("Error fetching NFT metadata:",T),null}};d.useEffect(()=>{(async()=>{try{z(U=>({...U,isLoading:!0,error:void 0}));const F=await G.readContract({address:L.address,abi:L.abi,functionName:"tokenURI",args:[t]});if(!F&&(r||b)){z(U=>({...U,tokenURI:"",isLoading:!1}));return}let _="";i&&(_=await G.readContract({address:L.address,abi:L.abi,functionName:"ownerOf",args:[t]}),x(_));let se;if(!i)try{se=await je(Te,{...L,functionName:"isTokenListed",args:[t]})}catch(U){console.warn("Could not load listing status:",U)}let re=b,oe=r;if(F){const U=await Q(F);U&&(re=U,oe=U.image)}z({tokenId:t,tokenURI:F,metadata:re,imageUrl:oe,isLoading:!1,isListed:se})}catch(T){console.error(`Error loading NFT ${t}:`,T),z({tokenId:t,tokenURI:"",imageUrl:r,metadata:b,isLoading:!1,error:`Failed to load NFT #${t}: ${T instanceof Error?T.message:"Unknown error"}`})}})()},[t,i,r,b,G]);const{isLoading:B,isSuccess:K}=ve({hash:w}),{isLoading:V,isSuccess:D}=ve({hash:j});d.useEffect(()=>{K&&setTimeout(()=>{n()},1e3)},[K,n]),d.useEffect(()=>{D&&s&&v("Listing status updated successfully!","success")},[D,s,v]);const Z=()=>{l.imageUrl&&a({src:l.imageUrl,alt:l.metadata?.name||`Artwork #${l.tokenId}`,title:l.metadata?.name,description:l.metadata?.description})},fe=async()=>{if(l.imageUrl)try{const T=await(await fetch(l.imageUrl)).blob(),F=window.URL.createObjectURL(T),_=document.createElement("a");_.href=F,_.download=`${l.metadata?.name||`Artwork-${l.tokenId}`}.png`,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(F)}catch(S){console.error("Download failed:",S),v("Download failed. Please try again.","error")}},ne=async()=>{const T=`https://opensea.io/item/optimism/${L.address}/${l.tokenId}`;try{await navigator.clipboard.writeText(T),v("OpenSea URL copied to clipboard!","success")}catch(F){console.error("Failed to copy URL:",F),window.open(T,"_blank","noopener,noreferrer")}},pe=async()=>{if(!k){P(!0),v(`⚠️ Click Delete again to permanently remove "${l.metadata?.name||`Artwork #${l.tokenId}`}"`,"warning"),setTimeout(()=>{P(!1)},5e3);return}P(!1);try{await g({...L,functionName:"burn",args:[l.tokenId]})}catch(S){console.error("Delete failed:",S),v("Failed to delete artwork. Please try again.","error")}},be=async()=>{if(!s)return;const S=!l.isListed,T=S?"public":"private";try{s(l.tokenId,S),await C({...L,functionName:"setTokenListed",args:[l.tokenId,S]})}catch(F){console.error("Failed to update listing status:",F),s(l.tokenId,!S),v(`Failed to set artwork as ${T}. Please try again.`,"error")}};return e.jsxs("div",{className:`${h.container} ${c?h.highlighted:""}`,children:[l.isLoading?e.jsxs("div",{className:h.loadingContainer,children:[e.jsx("div",{className:te}),e.jsx("p",{className:h.loadingText,children:"Loading artwork..."})]}):l.error?e.jsxs("div",{className:h.errorContainer,children:[e.jsx("div",{className:h.errorBox,children:e.jsx("p",{className:h.errorText,children:l.error})}),e.jsxs("p",{className:h.tokenIdText,children:["ID: ",l.tokenId.toString()]})]}):e.jsxs(e.Fragment,{children:[l.imageUrl?e.jsxs("div",{className:h.imageContainer,children:[e.jsx("img",{src:l.imageUrl,alt:l.metadata?.name||`${R} #${l.tokenId}`,className:h.image,onClick:Z,style:{cursor:"pointer"},onError:S=>{const T=S.target;T.style.display="none",T.nextElementSibling.classList.remove("hidden")}}),e.jsx("div",{className:h.imageError,style:{display:"none"},children:"Image not available"})]}):e.jsx("div",{className:h.imagePlaceholder,children:"No image available"}),e.jsx("h3",{className:h.title,children:l.metadata?.name||`Artwork #${l.tokenId}`}),l.metadata?.description&&e.jsx("p",{className:h.description,children:l.metadata.description}),e.jsxs("div",{className:h.footer,children:[e.jsxs("span",{children:["ID: ",l.tokenId.toString()]}),!i&&s&&l.isListed!==void 0&&e.jsxs("label",{className:h.checkboxLabel,title:`${l.isListed?"NFT is publicly listed":"NFT is private"}`,children:[e.jsx("input",{type:"checkbox",checked:l.isListed,onChange:be,disabled:E||V,className:h.checkbox}),y]}),i&&M&&e.jsxs("span",{title:`Owned by ${M}`,children:["Owner: ",M.slice(0,6),"...",M.slice(-4)]})]}),e.jsxs("div",{className:h.actions,children:[l.imageUrl&&e.jsx("button",{onClick:Z,className:h.compactSecondaryButton,title:"View full size",children:"🔍 Zoom"}),l.imageUrl&&e.jsxs("button",{onClick:fe,className:h.compactPrimaryButton,title:"Download image",children:["⬇️ ",$]}),e.jsxs("button",{onClick:ne,className:h.compactSecondaryButton,title:"Share your artwork on the marketplace",children:["📤 ",W]}),i&&e.jsx(ga,{genImTokenId:l.tokenId}),!i&&e.jsx("button",{onClick:pe,disabled:f||B,className:`${h.compactSecondaryButton} ${f||B?"":qt}`,title:"Delete artwork (permanent)",style:{opacity:f||B?.6:1},children:f?"🗑️ Deleting...":B?"⏳ Confirming...":`🗑️ ${I}`})]})]}),N]})}function _e({image:t,onClose:a}){const{showToast:n,ToastComponent:s}=Me();d.useEffect(()=>{const i=r=>{r.key==="Escape"&&a()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[a]);const c=async()=>{try{const r=await(await fetch(t.src)).blob(),b=window.URL.createObjectURL(r),g=document.createElement("a");g.href=b,g.download=`${t.title||"NFT-image"}.png`,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(b)}catch(i){console.error("Download failed:",i),n("Download failed. Please try again.","error")}};return e.jsxs("div",{className:h.modalOverlay,onClick:a,children:[e.jsxs("div",{className:h.modalContent,onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:h.modalClose,onClick:a,children:"✕"}),e.jsx("img",{src:t.src,alt:t.alt,className:h.modalImage}),(t.title||t.description)&&e.jsxs("div",{className:h.modalInfo,children:[t.title&&e.jsx("h3",{className:h.modalTitle,children:t.title}),t.description&&e.jsx("p",{className:h.modalDescription,children:t.description}),e.jsx("div",{className:h.actions,style:{justifyContent:"center",marginTop:"12px"},children:e.jsx("button",{onClick:c,className:`${h.actionButton} ${me}`,children:"⬇️ Download Full Size"})})]})]}),s]})}function ha({newlyCreatedNFT:t,onNewNFTDisplayed:a}){const{address:n,isConnected:s}=ae(),c=he(),[i,r]=d.useState([]),[b,g]=d.useState(!1),[f,w]=d.useState(null),[C,E]=d.useState(null),{data:j,isLoading:k}=ge({...L,functionName:"balanceOf",args:n?[n]:void 0,chainId:c.id,query:{enabled:!!n&&s}}),P=d.useCallback(async()=>{if(!s||!n){r([]);return}g(!0);try{const x=await je(Te,{...L,functionName:"balanceOf",args:[n]});if(!x||x===0n){r([]);return}const v=[];for(let y=0;y<Number(x);y++){const $=(async()=>{try{return await je(Te,{...L,functionName:"tokenOfOwnerByIndex",args:[n,BigInt(y)]})}catch(W){return console.error(`Error loading token ID at index ${y}:`,W),0n}})();v.push($)}const R=(await Promise.all(v)).filter(y=>y>0n).sort((y,$)=>$>y?1:$<y?-1:0);r(R)}catch(x){console.error("Error loading token IDs:",x),r([])}finally{g(!1)}},[s,n]),l=d.useCallback(x=>{w(x),r(v=>v.includes(x)?v:[x,...v]),setTimeout(()=>{w(null),a?.()},5e3)},[a]),z=d.useCallback((x,v)=>{console.log(`NFT ${x} listing status changed to: ${v}`)},[]);d.useEffect(()=>{s&&n&&P()},[n,s,P]),d.useEffect(()=>{t&&l(t.tokenId)},[t,l]);const M=k||b;return s?M&&i.length===0?e.jsxs("div",{className:H.loadingContainer,children:[e.jsx("div",{className:te}),e.jsx("p",{children:"Loading your artworks..."})]}):j===0n||!j?e.jsx("div",{className:H.emptyStateContainer,children:e.jsx("p",{className:H.emptyStateText,children:"You haven't created any artworks yet. Use the generator above to create your first one!"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.grid,children:i.map((x,v)=>{const N=t?.tokenId===x,R=N?t.imageUrl:void 0,y=N?t.metadata:void 0;return e.jsx(Oe,{tokenId:x,onImageClick:E,onNftBurned:()=>P(),onListedStatusChanged:z,isHighlighted:f===x,isPublicView:!1,preloadedImageUrl:R,preloadedMetadata:y},`my-${x}-${v}`)})}),C&&e.jsx(_e,{image:C,onClose:()=>E(null)})]}):e.jsxs("div",{className:H.walletPrompt,children:[e.jsx("h3",{children:"🔗 Connect Your Wallet"}),e.jsx("p",{children:"To view and manage your personal NFT artworks, please connect your wallet using the button above."}),e.jsx("p",{children:"Your artworks are stored on the blockchain and linked to your wallet address."}),e.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9em",opacity:.8},children:"💡 Tip: You can explore public artworks from other users in the “All Public Artworks” tab without connecting your wallet."})]})}function fa(){const[t,a]=d.useState([]),[n,s]=d.useState(!1),[c,i]=d.useState(null),r=Be(),b=d.useCallback(async()=>{s(!0);try{const g=await r.readContract({address:L.address,abi:L.abi,functionName:"getAllPublicTokens"});if(!g||g.length===0){a([]);return}const f=g.sort((w,C)=>C>w?1:C<w?-1:0);a(f)}catch(g){console.error("Error loading public token IDs:",g),a([])}finally{s(!1)}},[r]);return d.useEffect(()=>{b()},[b]),n&&t.length===0?e.jsxs("div",{className:H.loadingContainer,children:[e.jsx("div",{className:te}),e.jsx("p",{children:"Loading public artworks..."})]}):t.length===0?e.jsx("div",{className:H.emptyStateContainer,children:e.jsx("p",{className:H.emptyStateText,children:"No public artworks available yet."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:H.grid,children:t.map((g,f)=>e.jsx(Oe,{tokenId:g,onImageClick:i,onNftBurned:()=>{},isHighlighted:!1,isPublicView:!0},`public-${g}-${f}`))}),c&&e.jsx(_e,{image:c,onClose:()=>i(null)})]})}function pa({newlyCreatedNFT:t,onNewNFTDisplayed:a,activeTab:n,onTabChange:s}={}){const{address:c,isConnected:i}=ae(),[r,b]=d.useState(()=>i?"my":"public"),g=n??r,f=s??b,w=ge({...L,functionName:"balanceOf",args:c?[c]:void 0,chainId:he().id,query:{enabled:!!c&&i}}),{data:C,refetch:E}=w;d.useEffect(()=>{t&&E&&E()},[t,E]);const j=o({label:"imagegen.myArtworks"}),k=o({label:"imagegen.allPublicArtworks"});return e.jsxs("div",{className:H.container,children:[e.jsx("div",{className:q.container,children:e.jsxs("div",{className:q.tabList,children:[e.jsx(Re,{label:i?`${j} (${C?.toString()||"0"})`:j,isActive:g==="my",onClick:()=>f("my")}),e.jsx(Re,{label:k,isActive:g==="public",onClick:()=>f("public")})]})}),e.jsx("div",{className:`${q.tabPanel} ${g==="my"?"":q.hiddenPanel}`,children:e.jsx(ha,{newlyCreatedNFT:t,onNewNFTDisplayed:a})}),e.jsx("div",{className:`${q.tabPanel} ${g==="public"?"":q.hiddenPanel}`,children:e.jsx(fa,{})})]})}function ba(){const{isConnected:t}=ae(),[a,n]=d.useState(null),[s,c]=d.useState(()=>t?"my":"public"),i=(f,w,C)=>{console.log("Image generation succeeded:",{tokenId:f,imageUrl:w,metadata:C}),n({tokenId:f,imageUrl:w,metadata:C}),t&&c("my")},r=f=>{console.error("Image generation failed:",f)},b=()=>{n(null)},g=f=>{c(f)};return e.jsxs("div",{className:Kt,children:[e.jsx(ma,{onSuccess:i,onError:r}),e.jsx(pa,{newlyCreatedNFT:a??void 0,onNewNFTDisplayed:b,activeTab:s,onTabChange:g})]})}const xa=Object.freeze(Object.defineProperty({__proto__:null,default:ba},Symbol.toStringTag,{value:"Module"}));function wa(){return"AI Image Generator"}const ya=Object.freeze(Object.defineProperty({__proto__:null,title:wa},Symbol.toStringTag,{value:"Module"})),Ea={serverOnlyHooks:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!1}},isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:ea}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Xt}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Jt}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:xa}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/config",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:Zt}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/imagegen/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ya}},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-query/__internal/integration/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:Vt}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Qt}},FallbackErrorBoundary:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react-query/__internal/integration/FallbackErrorBoundary",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Yt}}};export{Ea as configValuesSerialized};
