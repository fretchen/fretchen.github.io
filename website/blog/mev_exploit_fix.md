---
publishing_date: 2025-12-02
title: "How bots exploited my ImageGen contract - and how I fixed it"
category: "blockchain"
description: "A bot network exploited a vulnerability in my GenImNFT contract, extracting over 80 cents. Here's how did it, how I fixed it, and what the forensic analysis revealed about the bot network that seemingly extracts substantial sums."
tokenID: 161
---

Early last week, I discovered that my [image generation](/imagegen) smart contract had been exploited by a sophisticated bot network. The bots found a vulnerability that allowed them to steal the rewards meant for my backend service. In this post, I'll explain the exploit, the fix, and share some of the surprising findings from my forensic analysis of the bot network.

## The Exploit: CVE-2025-11-26

The vulnerability was embarrassingly simple. In my `GenImNFT` contract, I had a function called `requestImageUpdate()` that was supposed to:

1. Update the NFT with a generated image URL
2. Pay the caller (my backend service) the mint price as compensation

The problem? **Anyone could call this function**, not just my authorized backend service.

```solidity
// VULNERABLE CODE (v3)
function requestImageUpdate(uint256 tokenId, string memory imageUrl) public {
    require(_exists(tokenId), "Token does not exist");
    require(!_imageUpdated[tokenId], "Image already updated");
    // NO AUTHORIZATION CHECK! ❌
    
    _imageUpdated[tokenId] = true;
    _setTokenURI(tokenId, imageUrl);
    
    // Pay the caller - but anyone can be the caller!
    (bool success, ) = payable(msg.sender).call{value: mintPrice}("");
}
```

Some bots discovered this and started front-running legitimate image update requests. When my backend tried to update an NFT, the bots would:

1. See the pending transaction in the mempool
2. Submit their own `requestImageUpdate()` with higher gas
3. Claim the payment before my transaction executed
4. Leave the NFT with an empty image URL

## The Fix: Agent Whitelist (v4)

The fix was straightforward - implement a whitelist of authorized agent wallets that can call `requestImageUpdate()`. This follows the [EIP-8004](https://eips.ethereum.org/EIPS/eip-8004) pattern for trustless agents:

```solidity
// FIXED CODE (v4)
mapping(address => bool) private _whitelistedAgentWallets;

function authorizeAgentWallet(address agentWallet) public onlyOwner {
    _whitelistedAgentWallets[agentWallet] = true;
}

function requestImageUpdate(uint256 tokenId, string memory imageUrl) public {
    require(_exists(tokenId), "Token does not exist");
    require(!_imageUpdated[tokenId], "Image already updated");
    require(_whitelistedAgentWallets[msg.sender], "Not authorized agent"); // ✅
    
    // ... rest of the function
}
```

After upgrading to v4, I called `authorizeAgentWallet()` with my backend service's address. Now only whitelisted addresses can claim the rewards.

## The Bot Network: A Forensic Analysis

What started as fixing a bug turned into a fascinating forensic investigation. Using Etherscan data and on-chain analysis, I traced the bot network's structure:

### Scale of the Operation

- **67 potential bot wallets** identified on Optimism
- **Roughly 100,679 USDC** extracted (80cents just from my contract)
- **Active since May 2023** - over 2.5 years of operation

### Network Hierarchy

The bots operate in a clear hierarchy:

```text
Central Treasury
    │
    ├── Wallet Farm Funder 1
    │       └── 67 bot wallets funded
    │
    └── Wallet Farm Funder 2
            └── roughly 100 bot wallets funded
```

The central wallet  has been active for 893 days with 4,800+ transactions. It funds the "Wallet Farm Funders" who then distribute small amounts of ETH to a lot of individual bot wallets.

### How the Bots Operate

1. **Funding**: The central treasury sends ETH to wallet farm funders on Mainnet
2. **Distribution**: Farm funders send roughly 0.2 ETH to bot wallets
3. **Bridging**: Bots bridge funds to target chains (Optimism, Arbitrum, etc.)
4. **Exploitation**: Bots monitor mempools and front-run vulnerable transactions
5. **Extraction**: Profits are bridged back via Stargate, Orbiter, deBridge, LiFi

### Professionalism

This clearly looks like a professional operation:

- Uses multiple parallel bot infrastructures
- Rotates wallets regularly
- Leverages multiple bridges to obscure fund flows
- Has been operating undetected for years

## My Lessons Learned

1. **Always implement access control** - Even "internal" functions that seem safe can be exploited. And even tiny amounts are exploited by bots.
2. **Use established patterns** - EIP-8004 agent authorization exists are important for everyone, not just large protocols.
3. **Bots are everywhere** - If there's value to extract, bots will find it

## What's Next

I've filed reports on [Chainabuse](https://chainabuse.com/) to help warn others about these wallet addresses.  

The image generator is back online with the fixed contract. Feel free to try it at [/imagegen](/imagegen) - now with proper security!
