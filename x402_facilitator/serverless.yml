service: x402-facilitator

# Read environment variables from a .env file
useDotenv: true

configValidationMode: off
provider:
  name: scaleway
  runtime: node22
  # Environment variables for production
  env:
    NODE_ENV: production
    LOG_LEVEL: info
    # Whitelist configuration
    WHITELIST_SOURCES: genimg_v4
    # GenImNFTv4 contract addresses
    GENIMG_V4_MAINNET_ADDRESS: ""
    GENIMG_V4_SEPOLIA_ADDRESS: ""
    # LLMv1 contract addresses (optional)
    LLMV1_MAINNET_ADDRESS: ""
    LLMV1_SEPOLIA_ADDRESS: ""
    # Test wallets (testnet only, comma-separated)
    TEST_WALLETS: ""
  # Secrets (set via Scaleway Console or CLI)
  secret:
    FACILITATOR_WALLET_PRIVATE_KEY: ${env:FACILITATOR_WALLET_PRIVATE_KEY}
    OPTIMISM_RPC_URL: ${env:OPTIMISM_RPC_URL, "https://mainnet.optimism.io"}
    OPTIMISM_SEPOLIA_RPC_URL: ${env:OPTIMISM_SEPOLIA_RPC_URL, "https://sepolia.optimism.io"}

plugins:
  - serverless-scaleway-functions

package:
  patterns:
    - "!.gitignore"
    - "!.git/**"
    - "!test/**"
    - "!coverage/**"
    - "!.prettierrc"
    - "!eslint.config.js"
    - "!vitest.config.js"
    - "!README.md"
    - "!EIP712_VERIFICATION.md"

functions:
  # Single function with path-based routing
  # Handles /verify, /settle, and /supported endpoints
  facilitator:
    handler: x402_facilitator.handle
    description: x402 v2 payment facilitator with path-based routing
    # Memory and timeout for the combined function
    memoryLimit: 512
    timeout: 60s
    # Custom domain for x402 standard compliance
    custom_domains:
      - facilitator.fretchen.eu